# 📋 단계별 요구사항 - 팀원별 할당 (V4 - 통합)

## 🎯 개발 단계별 목표

### Week 1 (MVP) - AI 여행 계획 채팅 서비스
**목표**: 로그인 + 기본 채팅 + Gemini 연동 + **AI 여행 계획 생성** 기능 구현

### Week 2 (1차 고도화) - Multi-LLM + Lambda MCP
**목표**: 의도별 LLM 라우팅 + Redis 캐싱 + Lambda MCP 구현 (Tour/Weather/Hotel)

### Week 3 (2차 고도화) - 개인화 + 에이전트 패턴
**목표**: 개인화 추천 시스템 + Multi-Agent System + 성능 최적화

---

## 👥 팀 구성 (5명)
- **USER**: 인증/인가, Redis JWT 관리
- **TRIP1**: 여행 계획 기본 기능, 선호도 관리, 개인화 알고리즘
- **CHAT1**: 채팅 기본 기능, 인텐트 라우팅
- **CHAT2+TRIP2** (통합 담당): LLM 통합, 프롬프트 엔지니어링, RAG 개인화, AI 여행 계획 생성
- **MEDIA**: 이미지 업로드, S3 저장, OCR 처리

---

## 📝 팀원별 요구사항 할당

### 🔐 USER (인증 + Redis JWT)

#### MVP (Week 1) - 6개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|--------|------|---------|
| REQ-SYS-001 | Spring Boot 프로젝트 초기 설정 | PostgreSQL, JPA 설정, 패키지 구조 | 1 |
|  |  | → application.yml 설정, DB 연결, 기본 패키지 생성 (domain/controller/service/repository) |  |
| REQ-SYS-002 | 핵심 테이블 생성 | users, chat_threads, messages 테이블 | 1 |
|  |  | → JPA 엔티티 클래스 작성, @Table/@Column 매핑, 관계 설정 (@OneToMany/@ManyToOne) |  |
| REQ-AUTH-001 | 회원가입 API | POST /api/auth/signup, BCrypt 암호화 | 2 |
|  |  | → UserDto 생성, 중복 이메일 체크, BCryptPasswordEncoder로 비밀번호 해싱 후 DB 저장 |  |
| REQ-AUTH-002 | 로그인 API | POST /api/auth/login, JWT 토큰 발급 | 2 |
|  |  | → 이메일/비밀번호 검증, JWT 액세스/리프레시 토큰 생성, 응답 헤더에 토큰 포함 |  |
| REQ-AUTH-003 | JWT 인증 필터 | Spring Security 토큰 검증 | 3 |
|  |  | → OncePerRequestFilter 구현, Authorization 헤더에서 토큰 추출 및 검증, SecurityContext 설정 |  |
| REQ-AUTH-004 | 로그아웃 API | POST /api/auth/logout, Redis 블랙리스트 | 3 |
|  |  | → 현재 토큰을 Redis 블랙리스트에 추가, TTL을 토큰 만료시간까지 설정 |  |

#### 1차 고도화 (Week 2) - 5개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-AUTH-005 | 토큰 갱신 API | POST /api/auth/refresh, rotation | 1 |
|  |  | → 리프레시 토큰 검증, 새로운 액세스/리프레시 토큰 쌍 발급, 기존 토큰 무효화 |  |
| REQ-AUTH-006 | Redis 화이트리스트 | 활성 토큰 관리 | 2 |
|  |  | → 발급된 모든 유효 토큰을 Redis에 저장, 검증 시 화이트리스트 확인 로직 추가 |  |
| REQ-AUTH-007 | 동시 접속 제한 | 디바이스별 토큰 관리 | 2 |
|  |  | → 디바이스 식별자 기반 토큰 매핑, 동일 계정 최대 3개 디바이스 제한 구현 |  |
| REQ-AUTH-008 | 토큰 만료 관리 | TTL 자동 관리 | 3 |
|  |  | → Redis EXPIRE 설정, 만료된 토큰 자동 삭제, 스케줄러로 주기적 정리 |  |
| REQ-USER-001 | 회원 탈퇴 API | DELETE /api/users/account | 3 |
|  |  | → 사용자 데이터 소프트 삭제, 관련 토큰 모두 무효화, 탈퇴 사유 기록 |  |

#### 2차 고도화 (Week 3) - 미정
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| - | 미정 | - | 추후 필요에 따라 추가 기능 결정 |

---

### 🗺️ TRIP1 (여행 계획 + 선호도 관리)

#### MVP (Week 1) - 5개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-TRIP-000 | Trip 테이블 설계 | trips, trip_details 테이블 생성 | 1 |
|  |  | → trips 테이블 (기본정보), trip_details (일차별 상세일정 JSONB), 인덱스 생성 |  |
| REQ-TRIP-001 | 여행 계획 생성 API | POST /api/trips - AI 기반 여행 계획 생성 | 1 |
|  |  | → TripDto 받아서 Trip 엔티티 생성, AI 생성 일정을 JSONB로 저장, 응답 반환 |  |
| REQ-TRIP-002 | 여행 계획 조회 API | GET /api/trips/{id} | 2 |
|  |  | → tripId로 조회, 권한 체크, trip_details JSONB 파싱하여 구조화된 응답 반환 |  |
| REQ-PREF-001 | 여행 스타일 설정 | 휴양/관광/액티비티 선호도 저장 | 2 |
|  |  | → user_preferences 테이블에 ENUM 타입으로 저장, 각 스타일별 가중치 관리 |  |
| REQ-PREF-002 | 예산 수준 설정 | BUDGET/STANDARD/LUXURY 설정 | 3 |
|  |  | → 예산 레벨 ENUM 저장, 레벨별 일일 예산 범위 매핑 (5만/10만/20만+) |  |

#### 1차 고도화 (Week 2) - 6개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-TRIP-003 | 내 여행 목록 조회 | GET /api/trips, 페이징 | 1 |
|  |  | → 현재 사용자의 모든 여행 조회, Pageable 구현, 최신순 정렬 기본값 |  |
| REQ-TRIP-004 | 여행 계획 수정 API | PUT /api/trips/{id} | 2 |
|  |  | → 일정 부분 수정 지원, JSONB 병합 로직, 수정 이력 관리 |  |
| REQ-PREF-003 | 선호도 조회 API | GET /api/users/preferences | 1 |
|  |  | → 현재 사용자의 모든 선호도 설정 조회, 기본값 포함하여 응답 |  |
| REQ-PREF-004 | 선호도 업데이트 API | PUT /api/users/preferences | 2 |
|  |  | → 부분 업데이트 지원, 변경된 필드만 수정, 검증 로직 포함 |  |
| REQ-PREF-005 | 관심 카테고리 설정 | 최대 3개 카테고리 선택 | 3 |
|  |  | → 문화/역사/음식/쇼핑/자연 등 카테고리 중 최대 3개 선택, 우선순위 설정 |  |
| REQ-TRIP-014 | 상세 일정 추가 | 관광지, 식당, 숙박 상세 정보 | 3 |
|  |  | → 각 일정 항목에 장소명, 주소, 영업시간, 예상비용 등 메타데이터 추가 |  |

#### 2차 고도화 (Week 3) - 7개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-TRIP-016 | 사용자 선호도 반영 | Spring AI RAG 활용 개인화 | 1 |
|  |  | → 선호도 벡터 임베딩, 유사도 검색으로 맞춤 일정 생성, 가중치 적용 |  |
| REQ-TRIP-017 | 선호 활동 매칭 | 시간대별 최적화 | 1 |
|  |  | → 오전/오후/저녁별 선호 활동 타입 매칭, 이동 시간 최소화 알고리즘 |  |
| REQ-TRIP-013 | 예산 기반 최적화 | 예산별 조정 | 2 |
|  |  | → 총 예산 내에서 일정 조정, 우선순위 기반 활동 선택, 대안 제시 |  |
| REQ-TRIP-018 | 시간대별 선호 반영 | 아침/저녁형 반영 | 3 |
|  |  | → 사용자 활동 패턴 분석, 시작/종료 시간 자동 조정, 휴식 시간 배치 |  |
| REQ-TRIP-021 | 음식 선호 반영 | 맛집 추천 통합 | 3 |
|  |  | → 선호 음식 종류별 맛집 추천, 식사 시간대 자동 배치, 리뷰 평점 반영 |  |
| REQ-TRIP-024 | 계절별 최적화 | 시즌 활동 추천 | 3 |
|  |  | → 여행 날짜의 계절/날씨 고려, 실내/실외 활동 비율 조정, 대체 일정 제공 |  |
| REQ-TRIP-029 | 꼬리질문 생성 | 정보 수집 질문 | 2 |
|  |  | → 부족한 정보 감지, 맥락 기반 추가 질문 생성, 선택지 제공 |  |

---


---

### 💬 CHAT1 (채팅 기본 + 인텐트 라우팅)

#### MVP (Week 1) - 5개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-CHAT-001 | 채팅방 생성 API | POST /api/chat/threads, UUID 생성 | 1 |
|  |  | → 새 채팅 스레드 생성, UUID 발급, user_id 연결, 생성 시간 기록 |  |
| REQ-CHAT-002 | 채팅 목록 조회 | GET /api/chat/threads, 페이징 처리 | 2 |
|  |  | → 사용자의 모든 채팅 스레드 목록, 최근 메시지 미리보기, 시간순 정렬 |  |
| REQ-CHAT-003 | 메시지 전송 API | POST /api/chat/threads/{id}/messages | 1 |
|  |  | → 사용자 메시지 저장, LLM 호출 트리거, AI 응답 저장, 타임스탬프 기록 |  |
| REQ-CHAT-004 | 대화 조회 API | GET /api/chat/threads/{id}/messages | 2 |
|  |  | → 특정 스레드의 모든 메시지 조회, 페이징/커서 기반 페이지네이션, 순서 보장 |  |
| REQ-CHAT-006 | 메시지 입력 검증 | @Valid, 최대 1000자 제한 | 3 |
|  |  | → 빈 메시지 방지, 길이 제한 검증, XSS 방지 새니타이징, SQL 인젝션 방어 |  |

#### 1차 고도화 (Week 2) - 5개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-CHAT-005 | 채팅 삭제 API | DELETE /api/chat/threads/{id} | 3 |
|  |  | → 소프트 삭제 처리, 관련 메시지 모두 비활성화, 삭제 이력 기록 |  |
| REQ-CHAT-007 | 채팅 제목 자동 생성 | 첫 메시지 기반 제목 | 2 |
|  |  | → 첫 50자 추출하거나 AI 요약 사용, 의미 있는 제목 생성, 자동 저장 |  |
| REQ-INTENT-001 | 의도 분류 기능 | 여행계획/추천/정보 분류 | 1 |
|  |  | → 메시지 의도 분석, 3가지 카테고리로 분류, 확률 기반 라우팅 결정 |  |
| REQ-INTENT-002 | 키워드 매칭 | 키워드 사전 관리 | 2 |
|  |  | → 도메인별 키워드 사전 구축, 패턴 매칭 알고리즘, 동적 업데이트 지원 |  |
| REQ-INTENT-003 | 의도별 프롬프트 | 템플릿 선택 로직 | 2 |
|  |  | → 의도별 최적화된 프롬프트 템플릿, 변수 치환 로직, 동적 생성 |  |

#### 2차 고도화 (Week 3) - 10개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-CHAT-008 | 채팅 제목 수정 API | PUT /api/chat/threads/{id}/title | 3 |
|  |  | → 사용자가 직접 제목 수정, 길이 제한 50자, 수정 이력 보관 |  |
| REQ-CHAT-009 | 메시지 검색 기능 | 전문 검색 구현 | 2 |
|  |  | → 키워드 기반 메시지 검색, 날짜 범위 필터, 하이라이트 표시 |  |
| REQ-CHAT-010 | 채팅 내보내기 | CSV/JSON 형식 다운로드 | 2 |
|  |  | → 대화 내용 포맷팅, 파일 생성 및 스트리밍, 대용량 처리 지원 |  |
| REQ-INTENT-004 | 라우터 에이전트 | 에이전트 패턴 구현 | 1 |
|  |  | → 의도 분석 전문 에이전트, 다른 에이전트로 라우팅, 체인 패턴 구현 |  |
| REQ-INTENT-005 | 라우터 꼬리질문 | 의도 명확화 질문 | 2 |
|  |  | → 모호한 요청 감지, 명확화 질문 생성, 선택지 제공으로 의도 파악 |  |
| REQ-INTENT-006 | 플래너 에이전트 | 여행 계획 전문 에이전트 | 1 |
|  |  | → 여행 계획 생성 전문화, Function Calling 통해 일정 생성, 상태 관리 |  |
| REQ-INTENT-007 | 플래너 꼬리질문 | 세부사항 수집 | 2 |
|  |  | → 날짜/예산/인원/선호도 등 필수 정보 수집, 단계별 질문 유도 |  |
| REQ-INTENT-008 | 추천 에이전트 | 개인화 추천 에이전트 | 1 |
|  |  | → 선호도 기반 맞춤 추천, RAG 파이프라인 연동, 콘텐츠 필터링 |  |
| REQ-INTENT-009 | 추천 꼬리질문 | 선호도 파악 질문 | 2 |
|  |  | → 암묵적 선호도 추출, 추가 선호 정보 수집, 추천 품질 개선 |  |
| REQ-INTENT-010 | 정보 알리미 에이전트 | 날씨/환율 정보 제공 | 1 |
|  |  | → 실시간 API 연동, 정형화된 정보 제공, 캐싱 전략 적용 |  |

---

### 🤖 CHAT2+TRIP2 (LLM 통합 + 프롬프트 엔지니어링 + 개인화)

#### MVP (Week 1) - 11개 작업 (독립 개발 가능 우선)
| 요구사항ID | 기능명 | 세부 설명 | 우선순위 | 의존성 | 상태 |
|------------|---------|---------|------|--------|------|
| REQ-LLM-001 | Spring AI 설정 | Spring AI 1.0.0-M5 의존성 추가, ChatClient/EmbeddingClient 빈 설정 | 1 | 독립 | ✅ 완료 |
|  |  | → build.gradle 의존성 추가, application.yml AI 설정, 빈 초기화 및 테스트 |  |  |  |
| REQ-LLM-002 | Gemini 연동 | Vertex AI Gemini 2.0 Flash 모델 연결, us-central1 리전 | 1 | 독립 | ✅ 완료 |
|  |  | → Google Cloud 인증 설정, Vertex AI 클라이언트 초기화, 연결 테스트 |  |  |  |
| REQ-AI-003 | 기본 일정 템플릿 | 당일치기, 1박2일, 2박3일, 3박4일 JSON 템플릿, 시간대별 기본 일정 | 1 | 독립 | |
|  |  | → 여행 기간별 표준 템플릿 JSON 파일 생성 (당일치기 포함), 시간대별 활동 매핑, 로드 로직 |  |  |  |
| REQ-PROMPT-001 | 프롬프트 엔지니어링 서비스 | PromptEngineeringService 구현, 템플릿 관리 | 1 | 독립 | |
|  |  | → 프롬프트 템플릿 시스템 구축, 동적 컨텍스트 주입, 개인화 변수 처리 |  |  |  |
| REQ-PROMPT-002 | 키워드 감지 시스템 | SimpleKeywordDetector 구현, 템플릿 추천 | 1 | 독립 | |
|  |  | → 간단한 키워드 매칭으로 적절한 템플릿 선택, 의도 파악 지원 |  |  |  |
| REQ-PROMPT-003 | 개인화 컨텍스트 로더 | DB 기반 사용자 컨텍스트 주입 | 2 | 독립 | |
|  |  | → UserPreference, UserContext, TravelHistory 테이블 조회, 프롬프트에 통합 |  |  |  |
| REQ-LLM-004 | 프롬프트 템플릿 라이브러리 | 20+ 여행 시나리오별 템플릿 | 2 | TRIP1 | |
|  |  | → 가족/커플/비즈니스/배낭여행 등 상황별 템플릿, 동적 변수 치환, 개인화 지원 |  |  |  |
| REQ-LLM-006 | 대화 컨텍스트 관리 | 최근 10개 메시지 유지, 토큰 제한 관리 | 2 | CHAT1 | |
|  |  | → 대화 이력 큐 관리, 8K 토큰 제한 체크, 오래된 메시지 자동 제거 |  |  |  |
| REQ-PERS-007 | 콜드 스타트 해결 | 신규 사용자 온보딩 메시지, 초기 선호도 수집 | 3 | 독립 | |
|  |  | → 첫 사용자 환영 메시지, 기본 선호도 수집 폼, 예시 질문 제공 |  |  |  |
| REQ-MON-001 | API 호출 로깅 | Logback 설정, LLM 호출 로깅 (모델, 토큰, 응답시간) | 3 | 독립 | |
|  |  | → 모든 LLM API 호출 로깅, 성공/실패율 추적, 비용 분석 데이터 수집 |  |  |  |
| REQ-MON-002 | 에러 로깅 | 예외 처리 및 스택 트레이스 로깅 | 3 | 독립 | |
|  |  | → LLM 에러 분류, 재시도 가능 여부 판단, 사용자 친화적 에러 메시지 |  |  |  |

#### 1차 고도화 (Week 2) - 15개 작업 (개인화 DB + 최소 Function Calling)
| 요구사항ID | 기능명 | 세부 설명 | 우선순위 | 의존성 | 상태 |
|------------|---------|---------|------|--------|------|
| REQ-DB-001 | UserPreference 테이블 | 사용자 여행 선호도 저장 | 1 | 독립 | |
|  |  | → 여행 스타일, 예산 수준, 관심 카테고리, 음식 선호, JSONB 구조 |  |  |  |
| REQ-DB-002 | UserContext 테이블 | 사용자 컨텍스트 정보 | 1 | 독립 | |
|  |  | → 나이대, 동행 유형, 신체 조건, 특별 요구사항, 과거 피드백 |  |  |  |
| REQ-DB-003 | TravelHistory 테이블 | 여행 이력 및 학습 데이터 | 1 | 독립 | |
|  |  | → 방문 장소, 만족도 평점, 재방문 의향, 키워드 추출, 패턴 분석 |  |  |  |
| REQ-FC-001 | 최소 Function Calling | 날씨/호텔 검색만 구현 | 1 | 독립 | |
|  |  | → getCurrentWeather(), searchHotels() 2개 함수만 구현, 실시간 정보 제공 |  |  |  |
| REQ-PROMPT-004 | 프롬프트 학습 시스템 | A/B 테스트 및 개선 | 2 | 독립 | |
|  |  | → 템플릿 성능 측정, 사용자 만족도 추적, 자동 개선 제안 |  |  |  |
| REQ-LLM-003 | OpenAI 연동 | GPT-4o-mini 모델 설정, 스트리밍 응답 | 1 | 독립 | |
|  |  | → OpenAI API 키 설정, 스트리밍 처리, 청크 병합, 타임아웃 처리 |  |  |  |
| REQ-LLM-007 | 토큰 사용량 추적 | 모델별 사용량 집계, 일일/월별 리포트 | 2 | 독립 | |
|  |  | → 요청/응답 토큰 카운팅, DB 저장, 비용 계산, 대시보드 데이터 |  |  |  |
| REQ-PROMPT-005 | 동적 템플릿 선택 | 컨텍스트 기반 템플릿 매칭 | 1 | 독립 | |
|  |  | → 사용자 입력 + DB 컨텍스트로 최적 템플릿 자동 선택, 신뢰도 점수 |  |  |  |
| REQ-PROMPT-006 | 템플릿 변수 주입 | 개인화 변수 처리 시스템 | 1 | 독립 | |
|  |  | → {{변수}} 형식 파싱, DB 데이터 매핑, 기본값 처리, 검증 로직 |  |  |  |
| REQ-LLM-008 | LLM 폴백 처리 | 의도별 모델 라우팅, exponential backoff | 2 | CHAT1 | |
|  |  | → 모델 실패 시 대체 모델 사용, 재시도 로직, 서킷 브레이커 패턴 |  |  |  |
| REQ-CTX-001 | 사용자 프로필 로드 | 선호도 기반 프롬프트 커스터마이징 | 2 | TRIP1 | |
|  |  | → 사용자 선호도 API 호출, 프롬프트에 주입, 개인화된 응답 생성 |  |  |  |
| REQ-CTX-002 | 대화 컨텍스트 저장 | HttpSession + Redis 하이브리드 | 2 | 독립 | |
|  |  | → 세션에 단기 컨텍스트, Redis에 장기 저장, 자동 동기화 로직 |  |  |  |
| REQ-CTX-003 | Redis 캐싱 | 30분 TTL 컨텍스트 자동 관리 | 1 | 독립 | |
|  |  | → 대화 컨텍스트 Redis 저장, TTL 자동 갱신, LRU 정책 적용 |  |  |  |
| REQ-CTX-004 | 컨텍스트 병합 | 프로필 + 대화 통합 알고리즘 | 2 | TRIP1 | |
|  |  | → 사용자 프로필 + 대화 이력 결합, 우선순위 관리, 프롬프트 최적화 |  |  |  |
| REQ-PERS-008 | 암묵적 선호도 수집 | 키워드 추출, 백그라운드 업데이트 큐 | 3 | TRIP1 | |
|  |  | → 대화에서 선호 키워드 감지, 비동기 업데이트, 학습 루프 구현 |  |  |  |

#### 2차 고도화 (Week 3) - 27개 작업 (고급 개인화 + RAG 파이프라인)

##### 개인화 시스템 (14개)
| 요구사항ID | 기능명 | 세부 설명 | 우선순위 | 의존성 | 상태 |
|------------|---------|---------|------|--------|------|
| REQ-PERS-001 | 선호도 벡터 저장 | Redis Vector Store, OpenAI ada-002 임베딩 | 1 | 독립 | |
|  |  | → 선호도 텍스트를 벡터로 변환, Redis에 저장, 유사도 검색 기능 구현 |  |  |  |
| REQ-PERS-002 | 키워드 빈도 계산 | TF-IDF 알고리즘, 시간 가중치 적용 | 1 | 독립 | |
|  |  | → 대화에서 키워드 추출, 빈도 및 중요도 계산, 최근 데이터 더 높은 가중치 |  |  |  |
| REQ-PERS-009 | Perplexity API 통합 | 실시간 웹 검색, 최신 정보 업데이트 | 1 | 독립 | |
|  |  | → Perplexity API 연동, 실시간 여행 정보 검색, Spring AI 어댑터 구현 |  |  |  |
| REQ-LLM-009 | 응답 캐싱 | Redis FAQ 캐싱, 24시간 TTL | 2 | 독립 | |
|  |  | → 빈번한 질문 감지, 응답 캐싱, 캐시 히트율 추적, 자동 갱신 |  |  |  |
| REQ-LLM-010 | 컨텍스트 요약 | 20개 이상 메시지 자동 요약 | 2 | 독립 | |
|  |  | → 긴 대화 자동 요약, 핵심 정보 보존, 토큰 효율화, 요약 품질 검증 |  |  |  |
| REQ-LLM-011 | 이미지 텍스트 추출 | OpenAI Vision API OCR 통합 | 2 | 독립 | |
|  |  | → 이미지에서 텍스트 추출, 구조화된 데이터 파싱, 여행 관련 정보 추출 |  |  |  |
| REQ-PERS-003 | RAG 기반 개인화 추천 | 3단계 파이프라인 (Retrieval-Augmentation-Generation) | 1 | CHAT1 | |
|  |  | → 관련 컨텐츠 검색, 프롬프트 보강, 개인화된 응답 생성, 학습 루프 |  |  |  |
| REQ-CTX-005 | 키워드 추출 | NER 기반 엔티티 추출 | 2 | 독립 | |
|  |  | → 대화에서 명사 추출, 여행 관련 엔티티 분류, 선호도 업데이트에 활용 |  |  |  |
| REQ-CTX-006 | 선호도 업데이트 | 비동기 백그라운드 처리 | 2 | TRIP1 | |
|  |  | → 선호도 비동기 업데이트 큐, 배치 처리, 충돌 방지, DB 반영 |  |  |  |
| REQ-CTX-007 | 컨텍스트 요약 | 8K 토큰 제한 관리 | 2 | 독립 | |
|  |  | → 토큰 수 계산, 초과 시 자동 요약, 중요 정보 우선 보존, 품질 검증 |  |  |  |
| REQ-CTX-008 | 개인화 프롬프트 | 맞춤형 프롬프트 생성기 | 2 | TRIP1 | |
|  |  | → 사용자별 맞춤 프롬프트 템플릿, 변수 주입, 동적 생성, A/B 테스트 |  |  |  |
| REQ-PERS-004 | 부정 선호 제외 | 블랙리스트 필터링 | 3 | 독립 | |
|  |  | → 사용자가 싫어하는 항목 관리, 추천에서 제외, 학습 루프 반영 |  |  |  |
| REQ-PERS-005 | 추천 카드 표시 | UI 데이터 생성 | 3 | 독립 | |
|  |  | → 추천 카드 JSON 생성, 이미지 URL, 설명 텍스트, 태그 포함 |  |  |  |
| REQ-PERS-006 | 추천 피드백 | 좋아요/싫어요 수집 및 학습 | 3 | 독립 | |
|  |  | → 사용자 피드백 API, 선호도 업데이트, 추천 알고리즘 개선 |  |  |  |

##### 여행 관리 기능 (7개)
| 요구사항ID | 기능명 | 세부 설명 | 우선순위 | 의존성 | 상태 |
|------------|---------|---------|------|--------|------|
| REQ-TRIP-006 | 일정별 상세 정보 | JSONB 구조 최적화 | 1 | TRIP1 | |
|  |  | → 일자별 상세 정보 JSONB 저장, 효율적 쿼리, 인덱싱, 부분 업데이트 |  |  |  |
| REQ-TRIP-007 | 여행 공유 기능 | UUID 기반 공유 링크 생성 | 2 | TRIP1 | |
|  |  | → 공유용 UUID 생성, 읽기 전용 접근, 만료 시간 설정, 공유 통계 |  |  |  |
| REQ-TRIP-008 | 여행 복사 기능 | 템플릿 복사 및 커스터마이징 | 2 | TRIP1 | |
|  |  | → 기존 여행 복사, 사용자 소유권 이전, 부분 수정 가능, 템플릿화 |  |  |  |
| REQ-TRIP-030 | 개인화 템플릿 | 유형별 템플릿 관리 | 2 | TRIP1 | |
|  |  | → 여행 유형별 템플릿 저장, 사용 빈도 추적, AI 학습 데이터 |  |  |  |
| REQ-TRIP-005 | 여행 계획 삭제 | 소프트 삭제 구현 | 3 | TRIP1 | |
|  |  | → 삭제 플래그 설정, 30일 후 완전 삭제, 복구 기능, 관련 데이터 정리 |  |  |  |
| REQ-TRIP-009 | 여행 상태 관리 | 계획/진행/완료 상태 전환 | 3 | TRIP1 | |
|  |  | → 여행 상태 ENUM 관리, 자동 상태 전환, 알림 기능, 통계 수집 |  |  |  |
| REQ-TRIP-010 | 여행 체크리스트 | 준비물 관리 기능 | 3 | TRIP1 | |
|  |  | → 여행 준비물 리스트, 체크 상태 관리, 기본 템플릿 제공, 알림 |  |  |  |

##### 프롬프트 고도화 (6개)
| 요구사항ID | 기능명 | 세부 설명 | 우선순위 | 의존성 | 상태 |
|------------|---------|---------|------|--------|------|
| REQ-PROMPT-007 | 멀티턴 대화 지원 | 대화 컨텍스트 유지 및 진화 | 1 | 독립 | |
|  |  | → 이전 대화 요약, 컨텍스트 진화, 장기 기억, 일관성 유지 |  |  |  |
| REQ-PROMPT-008 | 감정 인식 프롬프트 | 사용자 감정 상태 반영 | 1 | 독립 | |
|  |  | → 텍스트 감정 분석, 톤 조절, 공감적 응답, 맞춤형 제안 |  |  |  |
| REQ-PROMPT-009 | 다국어 템플릿 | 한/영/일/중 프롬프트 지원 | 1 | 독립 | |
|  |  | → 언어별 템플릿 관리, 문화적 뉘앙스 반영, 자동 번역 폴백 |  |  |  |
| REQ-PROMPT-010 | 프롬프트 체이닝 | 복잡한 요청 단계별 처리 | 2 | 독립 | |
|  |  | → 요청 분해, 순차 처리, 중간 결과 활용, 최종 통합 |  |  |  |
| REQ-PROMPT-011 | 프롬프트 버전 관리 | 템플릿 버전 및 롤백 | 2 | 독립 | |
|  |  | → Git 기반 버전 관리, A/B 테스트, 성능 비교, 자동 롤백 |  |  |  |
| REQ-PROMPT-012 | 프롬프트 최적화 | 토큰 효율성 개선 | 3 | 독립 | |
|  |  | → 압축 기법, 중복 제거, 핵심 정보 추출, 비용 최적화 |  |  |  |


---

### 🖼️ MEDIA (이미지 처리 + OCR)

#### MVP (Week 1) - 5개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-MEDIA-001 | 파일 업로드 설정 | MultipartFile, 10MB 제한 | 1 |
|  |  | → Spring 파일 업로드 설정, 크기 제한, 파일 타입 검증, 임시 저장소 관리 |  |
| REQ-MEDIA-002 | S3 연동 설정 | AWS SDK, 버킷 설정 | 1 |
|  |  | → S3 클라이언트 설정, 버킷 생성/권한, 자격증명 관리, 지역 설정 |  |
| REQ-MEDIA-003 | 이미지 업로드 API | POST /api/media/upload | 2 |
|  |  | → 파일 수신, S3 업로드, URL 생성, DB 메타데이터 저장, 응답 반환 |  |
| REQ-MEDIA-004 | 이미지 조회 API | GET /api/media/{id} | 2 |
|  |  | → S3 URL 생성, 서명된 URL 발급, 캐싱 헤더, 권한 체크 |  |
| REQ-MEDIA-005 | 파일 유효성 검증 | 이미지 포맷/크기 검증 | 3 |
|  |  | → MIME 타입 체크, 파일 헤더 검증, 악성 코드 검사, 크기 제한 |  |

#### 1차 고도화 (Week 2) - 6개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-MEDIA-006 | OpenAI Vision API 연동 | OCR 텍스트 추출 | 1 |
|  |  | → Vision API 호출, 이미지 전송, 텍스트 추출, 구조화된 데이터 반환 |  |
| REQ-MEDIA-007 | OCR 결과 저장 | 추출 텍스트 DB 저장 | 1 |
|  |  | → OCR 결과 테이블 저장, 이미지 ID 연결, 검색 인덱스, 타임스탬프 |  |
| REQ-MEDIA-008 | 이미지 메타데이터 추출 | EXIF, 크기, 포맷 | 2 |
|  |  | → EXIF 데이터 파싱, GPS 위치 추출, 촬영 시간, 카메라 정보 저장 |  |
| REQ-MEDIA-009 | 썸네일 생성 | 리사이징, S3 저장 | 2 |
|  |  | → 이미지 리사이징 (200x200, 400x400), 품질 최적화, S3 저장, URL 관리 |  |
| REQ-MEDIA-010 | 이미지 삭제 API | DELETE /api/media/{id} | 3 |
|  |  | → S3 파일 삭제, DB 레코드 삭제, 썸네일 삭제, 관련 데이터 정리 |  |
| REQ-MEDIA-011 | 배치 업로드 | 다중 파일 동시 처리 | 3 |
|  |  | → 최대 10개 파일 동시 처리, 병렬 업로드, 진행률 반환, 에러 처리 |  |

#### 2차 고도화 (Week 3) - 7개 작업
| 요구사항ID | 기능명 | 설명 | 우선순위 |
|------------|------------|--------|------|
| REQ-MEDIA-012 | OCR 정확도 개선 | 전처리 알고리즘 적용 | 1 |
|  |  | → 이미지 전처리(회전/목사 보정/대비 향상), 노이즈 제거, OCR 재시도 |  |
| REQ-MEDIA-013 | 다국어 OCR 지원 | 한/영/중/일 텍스트 추출 | 2 |
|  |  | → 언어 자동 감지, 다국어 동시 처리, 언어별 정확도 최적화 |  |
| REQ-MEDIA-014 | 구조화된 데이터 추출 | 표, 리스트 파싱 | 2 |
|  |  | → 테이블 구조 인식, 리스트 항목 추출, JSON 변환, 레이아웃 분석 |  |
| REQ-MEDIA-015 | OCR 결과 검색 API | GET /api/media/search | 2 |
|  |  | → 텍스트 검색, 전문검색 지원, 페이징, 하이라이트 표시 |  |
| REQ-MEDIA-016 | 이미지 태깅 | 자동 태그 생성 | 3 |
|  |  | → AI 기반 태그 생성, 사용자 태그 추가, 태그 기반 검색, 태그 클라우드 |  |
| REQ-MEDIA-017 | 중복 이미지 감지 | 해시 기반 중복 체크 | 3 |
|  |  | → 이미지 해시 생성, 중복 검사, 유사 이미지 감지, 병합 제안 |  |
| REQ-MEDIA-018 | OCR 결과 수정 API | PUT /api/media/{id}/ocr | 3 |
|  |  | → OCR 결과 수동 수정, 이력 관리, 학습 데이터 생성, 정확도 개선 |  |

---

## 📊 요약 통계

### 팀원별 작업량

| 팀원 | MVP | 1차 고도화 | 2차 고도화 | 총계 |
|------|-----|------------|------------|------|
| USER | 6개 | 5개 | 미정 | **11+개** |
| TRIP1 | 5개 | 6개 | 7개 | **18개** |
| CHAT1 | 5개 | 5개 | 10개 | **20개** |
| CHAT2+TRIP2 | 11개 | 15개 | 27개 | **53개** |
| MEDIA | 5개 | 6개 | 7개 | **18개** |
| **합계** | **32개** | **37개** | **51+개** | **120+개** |

### 난이도별 분포

| 난이도 | MVP | 1차 고도화 | 2차 고도화 | 총계 |
|--------|-----|------------|------------|------|
| 낮음 | 17개 | 9개 | 7개 | 33개 |
| 중간 | 14개 | 20개 | 32개 | 66개 |
| 높음 | 3개 | 8개 | 13개 | 24개 |

### 주요 완료 항목 (✅)
- **Spring AI 설정**: Gemini 2.0 Flash 연동 완료
- **Vertex AI**: us-central1 region 설정 완료
- **Docker 환경**: 전체 시스템 통합 테스트 완료

### MVP 핵심 기능 - AI 여행 계획 생성 Flow

```
사용자 입력 → CHAT2 (LLM 처리) → TRIP2 (입력 파싱/AI 함수)
           → TRIP1 (계획 저장) → 사용자 응답
```

### 주요 구현 예정
- **Week 1 (MVP)**: AI 여행 계획 생성 기능
- **Week 2 (1차)**: Lambda MCP 3개 API 구현
- **Week 3 (2차)**: Multi-Agent System + 개인화

## 🏗️ 기술 스택 및 통합 구조

### CHAT2+TRIP2 통합 담당
#### AI Architecture
- **Primary**: Gemini 2.0 Flash (Vertex AI) - 프롬프트 엔지니어링
- **Secondary**: GPT-4o-mini (OpenAI) - 폴백 처리
- **Framework**: Spring AI with Prompt Engineering (80%) + Minimal Function Calling (20%)

#### Personalization System
- **UserPreference**: 여행 스타일, 예산, 관심사
- **UserContext**: 나이대, 동행 유형, 특별 요구사항
- **TravelHistory**: 과거 여행 패턴 학습
- **Template Library**: 20+ 시나리오별 프롬프트 템플릿

### 협업 구조
```
CHAT2+TRIP2 (통합 AI 모듈)
  ├── 프롬프트 엔지니어링
  │   ├── PromptEngineeringService
  │   ├── 템플릿 라이브러리 (20+ templates)
  │   └── SimpleKeywordDetector
  ├── 개인화 시스템
  │   ├── UserPreference 관리
  │   ├── UserContext 로딩
  │   └── TravelHistory 학습
  └── 최소 Function Calling
      ├── getCurrentWeather()
      └── searchHotels()
          ↓
TRIP1 (여행 API)
  ├── POST /api/trips (여행 계획 저장)
  ├── GET /api/trips/{id} (계획 조회)
  └── 선호도 관리 API
          ↓
CHAT1 (채팅 관리)
  ├── 채팅 스레드 관리
  ├── 메시지 저장/조회
  └── 의도 분류 및 라우팅
```