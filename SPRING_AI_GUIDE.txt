================================================================================
                    Spring AI ì‹¤ì „ ê°€ì´ë“œë¶ for Compass í”„ë¡œì íŠ¸
================================================================================

ì‘ì„±ì¼: 2025ë…„ 1ì›”
í”„ë¡œì íŠ¸: Compass - AI ê¸°ë°˜ ê°œì¸í™” ì—¬í–‰ ê³„íš ì„œë¹„ìŠ¤
ë²„ì „: Spring AI 1.0.0-M5
ì°¸ê³ : Context7 Documentation ê¸°ë°˜ ì‘ì„±

================================================================================
ëª©ì°¨
================================================================================
1. Spring AIë€ ë¬´ì—‡ì¸ê°€?
2. ì™œ Spring AIë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?
3. ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ
4. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì´í•´í•˜ê¸°
5. Compass í”„ë¡œì íŠ¸ ì‹¤ì „ ì˜ˆì œ
6. RAG (Retrieval-Augmented Generation) êµ¬í˜„
7. ì½œë“œ ìŠ¤íƒ€íŠ¸ ë¬¸ì œ í•´ê²°
8. ë©€í‹° LLM ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
9. ë²¡í„° ìŠ¤í† ì–´ í™œìš©
10. ë©€í‹°ëª¨ë‹¬ ê¸°ëŠ¥ (ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì²˜ë¦¬)
11. ë¬¸ì œ í•´ê²° ë° íŒ

================================================================================
1. Spring AIë€ ë¬´ì—‡ì¸ê°€?
================================================================================

Spring AIëŠ” Spring ìƒíƒœê³„ì—ì„œ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” 
í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. LangChainì˜ Java ë²„ì „ì´ë¼ê³  ìƒê°í•˜ë©´ ì´í•´í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

í•µì‹¬ íŠ¹ì§•:
- Spring Bootì™€ ì™„ë²½í•œ í†µí•©
- ìë™ êµ¬ì„±(Auto-configuration) ì§€ì›
- ë‹¤ì–‘í•œ AI ëª¨ë¸ ì§€ì› (OpenAI, Gemini, Claude ë“±)
- ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ í†µí•©
- RAG íŒ¨í„´ ë‚´ì¥ ì§€ì›

================================================================================
2. ì™œ Spring AIë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?
================================================================================

ìš°ë¦¬ Compass í”„ë¡œì íŠ¸ì—ì„œ Spring AIë¥¼ ì„ íƒí•œ ì´ìœ :

1) Spring ë„¤ì´í‹°ë¸Œ
   - ì´ë¯¸ Spring Bootë¥¼ ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í†µí•©
   - ìµìˆ™í•œ ì–´ë…¸í…Œì´ì…˜ê³¼ íŒ¨í„´ ì‚¬ìš©

2) ë²¡í„° ìŠ¤í† ì–´ ì§€ì›
   - Redis Vector Storeë¥¼ í†µí•œ RAG êµ¬í˜„
   - ê°œì¸í™” ì¶”ì²œì„ ìœ„í•œ ìœ ì‚¬ë„ ê²€ìƒ‰

3) ë©€í‹° LLM ì§€ì›
   - Gemini 2.5 Flash (ì¼ë°˜ ëŒ€í™”)
   - GPT-4o-mini (ë³µì¡í•œ ê³„íš)
   - ì‰¬ìš´ ëª¨ë¸ ì „í™˜

4) Function Calling
   - Tour API, Weather API (AWS Lambda MCP)
   - Perplexity API (Spring AI ë‚´ë¶€)
   - 17ê°œ í•¨ìˆ˜ ìë™ ì‹¤í–‰

================================================================================
3. ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ
================================================================================

### Step 1: ì˜ì¡´ì„± ì¶”ê°€ (pom.xml)

<dependencies>
    <!-- Spring AI OpenAI -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
        <version>1.0.0-M5</version>
    </dependency>
    
    <!-- Spring AI Vertex AI Gemini -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-vertex-ai-gemini-spring-boot-starter</artifactId>
        <version>1.0.0-M5</version>
    </dependency>
    
    <!-- Spring AI Redis Vector Store -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-redis-spring-boot-starter</artifactId>
        <version>1.0.0-M5</version>
    </dependency>
</dependencies>

### Step 2: application.yml ì„¤ì •

spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: gpt-4o-mini
          temperature: 0.7
    vertex:
      ai:
        gemini:
          project-id: ${GOOGLE_CLOUD_PROJECT_ID}
          location: asia-northeast3
          chat:
            options:
              model: gemini-2.5-flash
              temperature: 0.7
    vectorstore:
      redis:
        index-name: compass-vector-index
        embedding-dimension: 1536

### Step 3: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

export OPENAI_API_KEY=sk-...
export GOOGLE_CLOUD_PROJECT_ID=your-project-id
export GOOGLE_CLOUD_LOCATION=asia-northeast3

================================================================================
4. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì´í•´í•˜ê¸°
================================================================================

### 4.1 ChatModel - AI ëŒ€í™” ì¸í„°í˜ì´ìŠ¤

ChatModelì€ AI ëª¨ë¸ê³¼ ëŒ€í™”í•˜ëŠ” í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.

@Service
public class ChatService {
    private final OpenAiChatModel openAiChatModel;
    private final VertexAiGeminiChatModel geminiChatModel;
    
    // ê°„ë‹¨í•œ ëŒ€í™”
    public String chat(String message) {
        ChatResponse response = geminiChatModel.call(
            new Prompt(message)
        );
        return response.getResult().getOutput().getContent();
    }
}

### 4.2 EmbeddingModel - í…ìŠ¤íŠ¸ ë²¡í„°í™”

í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜í•˜ì—¬ ìœ ì‚¬ë„ ê²€ìƒ‰ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

@Service
public class EmbeddingService {
    private final EmbeddingModel embeddingModel;
    
    public float[] embedText(String text) {
        return embeddingModel.embed(text);
    }
}

### 4.3 VectorStore - ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤

ë²¡í„°í™”ëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•©ë‹ˆë‹¤.

@Service
public class VectorService {
    private final VectorStore vectorStore;
    
    public void saveDocument(String content, Map<String, Object> metadata) {
        Document doc = new Document(content, metadata);
        vectorStore.add(List.of(doc));
    }
    
    public List<Document> search(String query) {
        return vectorStore.similaritySearch(
            SearchRequest.builder()
                .query(query)
                .topK(5)
                .similarityThreshold(0.7)
                .build()
        );
    }
}

================================================================================
5. Compass í”„ë¡œì íŠ¸ ì‹¤ì „ ì˜ˆì œ
================================================================================

### 5.1 ë©€í‹° LLM ë¼ìš°íŒ… êµ¬í˜„

@Service
@RequiredArgsConstructor
public class LlmService {
    private final OpenAiChatModel openAiChatModel;
    private final VertexAiGeminiChatModel geminiChatModel;
    
    public String processMessage(String message, MessageType type) {
        // ë©”ì‹œì§€ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ëª¨ë¸ ì„ íƒ
        ChatModel selectedModel = switch(type) {
            case SIMPLE_CHAT -> geminiChatModel;      // Gemini for ì¼ë°˜ ëŒ€í™”
            case TRIP_PLANNING -> openAiChatModel;     // GPT-4 for ë³µì¡í•œ ê³„íš
            default -> geminiChatModel;
        };
        
        // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì¶”ê°€
        var systemMessage = new SystemMessage(
            "ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì—¬í–‰ ê°€ì´ë“œì…ë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ ë„ì›€ì´ ë˜ëŠ” ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”."
        );
        
        var userMessage = new UserMessage(message);
        
        ChatResponse response = selectedModel.call(
            new Prompt(List.of(systemMessage, userMessage))
        );
        
        return response.getResult().getOutput().getContent();
    }
}

### 5.2 OCR ê¸°ëŠ¥ êµ¬í˜„ (Vision API)

@Service
@RequiredArgsConstructor
public class OcrService {
    private final OpenAiChatModel openAiChatModel;
    
    public String extractTextFromImage(MultipartFile image) throws IOException {
        byte[] imageBytes = image.getBytes();
        
        // ì´ë¯¸ì§€ì™€ í•¨ê»˜ ë©”ì‹œì§€ ìƒì„±
        var userMessage = new UserMessage(
            "ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”. ì—¬í–‰ ê´€ë ¨ ì •ë³´(ë‚ ì§œ, ì¥ì†Œ, ê°€ê²© ë“±)ë¥¼ ì¤‘ì ì ìœ¼ë¡œ íŒŒì•…í•´ì£¼ì„¸ìš”.",
            List.of(new Media(MimeTypeUtils.IMAGE_PNG, imageBytes))
        );
        
        // Vision ëª¨ë¸ ì‚¬ìš©
        ChatResponse response = openAiChatModel.call(
            new Prompt(
                List.of(userMessage),
                OpenAiChatOptions.builder()
                    .withModel("gpt-4-vision-preview")
                    .withMaxTokens(500)
                    .build()
            )
        );
        
        return response.getResult().getOutput().getContent();
    }
}

### 5.3 Function Calling êµ¬í˜„ (í•˜ì´ë¸Œë¦¬ë“œ MCP)

// Lambda MCP í˜¸ì¶œ Function
@Bean
@Description("í‚¤ì›Œë“œë¡œ ê´€ê´‘ì§€ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤")
public Function<TourKeywordSearchRequest, TourKeywordSearchResponse> searchTourByKeyword() {
    return request -> {
        // Lambda MCP ì„œë²„ í˜¸ì¶œ
        TourSearchResult result = tourMCPService.searchByKeyword(
            request.keyword, request.pageNo, request.numOfRows
        );
        return TourKeywordSearchResponse.builder()
            .success(true)
            .places(result.getPlaces())
            .build();
    };
}

// Spring AI ë‚´ë¶€ Perplexity Function
@Bean
@Description("í˜„ì¬ íŠ¸ë Œë”©í•˜ëŠ” ì¸ê¸° ì—¬í–‰ì§€ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤")
public Function<TrendingSearchRequest, TrendingSearchResponse> searchTrendingDestinations() {
    return request -> {
        // Perplexity API ì§ì ‘ í˜¸ì¶œ (Spring ë‚´ë¶€)
        TrendingSearchResult result = perplexityService.searchTrendingDestinations(
            request.region, request.season, request.category
        );
        return TrendingSearchResponse.builder()
            .success(true)
            .destinations(result.getDestinations())
            .build();
    };
}

================================================================================
6. RAG (Retrieval-Augmented Generation) êµ¬í˜„
================================================================================

RAGëŠ” ë²¡í„° DBì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•œ í›„, ê·¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ AIê°€ ë‹µë³€í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

### 6.1 ë°ì´í„° ì €ì¥ (Embedding)

@Service
@RequiredArgsConstructor
public class DataIngestionService {
    private final VectorStore vectorStore;
    private final EmbeddingModel embeddingModel;
    
    public void saveUserPreference(Long userId, String preference) {
        // ë¬¸ì„œ ìƒì„± (ë©”íƒ€ë°ì´í„° í¬í•¨)
        Document doc = new Document(
            preference,
            Map.of(
                "userId", userId.toString(),
                "type", "preference",
                "timestamp", LocalDateTime.now().toString()
            )
        );
        
        // ë²¡í„° ìŠ¤í† ì–´ì— ì €ì¥ (ìë™ìœ¼ë¡œ ì„ë² ë”©ë¨)
        vectorStore.add(List.of(doc));
    }
}

### 6.2 RAG ê¸°ë°˜ ì¶”ì²œ êµ¬í˜„

@Service
@RequiredArgsConstructor
public class RagRecommendationService {
    private final VectorStore vectorStore;
    private final OpenAiChatModel chatModel;
    
    public String generateRecommendation(Long userId, String query) {
        // 1. ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ê´€ë ¨ ë¬¸ì„œ ì°¾ê¸°
        List<Document> relevantDocs = vectorStore.similaritySearch(
            SearchRequest.builder()
                .query(query)
                .topK(5)
                .filterExpression("userId == '" + userId + "'")  // ë©”íƒ€ë°ì´í„° í•„í„°
                .similarityThreshold(0.7)
                .build()
        );
        
        // 2. ê²€ìƒ‰ëœ ë¬¸ì„œë¡œ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
        String context = relevantDocs.stream()
            .map(Document::getContent)
            .collect(Collectors.joining("\n"));
        
        // 3. LLMì— ì»¨í…ìŠ¤íŠ¸ì™€ í•¨ê»˜ ì§ˆë¬¸
        var systemMessage = new SystemMessage(
            "ë‹¤ìŒ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë§ì¶¤í˜• ì—¬í–‰ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”:\n" + context
        );
        
        var userMessage = new UserMessage(query);
        
        ChatResponse response = chatModel.call(
            new Prompt(List.of(systemMessage, userMessage))
        );
        
        return response.getResult().getOutput().getContent();
    }
}

### 6.3 Spring AIì˜ RetrievalAugmentationAdvisor ì‚¬ìš©

ë” ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ Spring AIì˜ ë‚´ì¥ RAG ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

@Service
@RequiredArgsConstructor
public class SimpleRagService {
    private final ChatClient chatClient;
    private final VectorStore vectorStore;
    
    public String askWithRag(String question) {
        // RAG Advisor ìƒì„±
        var ragAdvisor = RetrievalAugmentationAdvisor.builder()
            .documentRetriever(VectorStoreDocumentRetriever.builder()
                .vectorStore(vectorStore)
                .similarityThreshold(0.7)
                .topK(5)
                .build())
            .build();
        
        // ChatClientì™€ í•¨ê»˜ ì‚¬ìš©
        return chatClient.prompt()
            .advisors(ragAdvisor)
            .user(question)
            .call()
            .content();
    }
}

================================================================================
7. ì½œë“œ ìŠ¤íƒ€íŠ¸ ë¬¸ì œ í•´ê²°
================================================================================

ì‹ ê·œ ì‚¬ìš©ìì—ê²Œë„ ì¢‹ì€ ì¶”ì²œì„ ì œê³µí•˜ëŠ” ë°©ë²•:

### 7.1 ì‹ ê·œ ì‚¬ìš©ì ê°ì§€

@Service
public class ColdStartService {
    private final VectorStore vectorStore;
    
    public boolean isNewUser(Long userId) {
        List<Document> userDocs = vectorStore.similaritySearch(
            SearchRequest.builder()
                .query("user preferences")
                .topK(1)
                .filterExpression("userId == '" + userId + "'")
                .build()
        );
        return userDocs.isEmpty();
    }
}

### 7.2 ì˜¨ë³´ë”© ì§ˆë¬¸ ìƒì„±

@Service
public class OnboardingService {
    
    public OnboardingQuestions createQuestions() {
        return OnboardingQuestions.builder()
            .questions(List.of(
                "ì–´ë–¤ ìŠ¤íƒ€ì¼ì˜ ì—¬í–‰ì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”? (íœ´ì–‘/ê´€ê´‘/ì•¡í‹°ë¹„í‹°)",
                "ì—¬í–‰ ì˜ˆì‚°ì€ ì–´ëŠ ì •ë„ë¡œ ìƒê°í•˜ê³  ê³„ì‹ ê°€ìš”?",
                "ì„ í˜¸í•˜ëŠ” ì—¬í–‰ ê¸°ê°„ì€ ë©°ì¹  ì •ë„ì¸ê°€ìš”?",
                "íŠ¹ë³„íˆ ê°€ë³´ê³  ì‹¶ì€ ë‚˜ë¼ë‚˜ ë„ì‹œê°€ ìˆìœ¼ì‹ ê°€ìš”?",
                "ì—¬í–‰ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
            ))
            .build();
    }
}

### 7.3 ì•”ë¬µì  ì„ í˜¸ë„ ì¶”ì¶œ

@Service
public class ImplicitPreferenceExtractor {
    private final VectorStore vectorStore;
    
    public void extractFromMessage(Long userId, String message) {
        Set<String> keywords = extractKeywords(message);
        
        StringBuilder preferences = new StringBuilder();
        
        if (keywords.contains("í•´ë³€") || keywords.contains("ë°”ë‹¤")) {
            preferences.append("í•´ë³€/ë°”ë‹¤ ì„ í˜¸ ");
        }
        if (keywords.contains("ì‚°") || keywords.contains("ë“±ì‚°")) {
            preferences.append("ì‚°/ìì—° ì„ í˜¸ ");
        }
        if (keywords.contains("ë„ì‹œ") || keywords.contains("ì‡¼í•‘")) {
            preferences.append("ë„ì‹œ/ì‡¼í•‘ ì„ í˜¸ ");
        }
        
        if (preferences.length() > 0) {
            Document doc = new Document(
                preferences.toString(),
                Map.of("userId", userId.toString(), "type", "implicit_preference")
            );
            vectorStore.add(List.of(doc));
        }
    }
}

================================================================================
8. ë©€í‹° LLM ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
================================================================================

### 8.1 ëª¨ë¸ë³„ íŠ¹ì„± í™œìš©

@Configuration
public class LlmConfig {
    
    @Bean
    public LlmRouter llmRouter(
            OpenAiChatModel openAi,
            VertexAiGeminiChatModel gemini) {
        
        return LlmRouter.builder()
            // Gemini: ë¹ ë¥¸ ì‘ë‹µ, ì¼ë°˜ ëŒ€í™”
            .addRoute("simple_chat", gemini)
            .addRoute("greeting", gemini)
            .addRoute("weather_info", gemini)
            
            // GPT-4: ë³µì¡í•œ ì¶”ë¡ , ê³„íš ìˆ˜ë¦½
            .addRoute("trip_planning", openAi)
            .addRoute("itinerary_creation", openAi)
            .addRoute("complex_analysis", openAi)
            
            .defaultModel(gemini)
            .build();
    }
}

### 8.2 ì˜ë„ ë¶„ë¥˜ ê¸°ë°˜ ë¼ìš°íŒ…

@Service
public class IntentBasedRouter {
    private final Map<Intent, ChatModel> modelMap;
    
    public String route(String message) {
        Intent intent = classifyIntent(message);
        ChatModel model = modelMap.getOrDefault(intent, defaultModel);
        
        return model.call(new Prompt(message))
            .getResult().getOutput().getContent();
    }
    
    private Intent classifyIntent(String message) {
        // í‚¤ì›Œë“œ ê¸°ë°˜ ê°„ë‹¨í•œ ë¶„ë¥˜
        if (message.contains("ì—¬í–‰ ê³„íš") || message.contains("ì¼ì •")) {
            return Intent.TRIP_PLANNING;
        }
        if (message.contains("ë‚ ì”¨") || message.contains("ê¸°ì˜¨")) {
            return Intent.WEATHER;
        }
        return Intent.GENERAL_CHAT;
    }
}

================================================================================
9. ë²¡í„° ìŠ¤í† ì–´ í™œìš©
================================================================================

### 9.1 Redis Vector Store ì„¤ì •

@Configuration
public class VectorStoreConfig {
    
    @Bean
    public VectorStore redisVectorStore(
            JedisConnectionFactory jedis,
            EmbeddingModel embeddingModel) {
        
        return RedisVectorStore.builder()
            .jedisConnectionFactory(jedis)
            .embeddingModel(embeddingModel)
            .indexName("compass-vectors")
            .prefix("doc:")
            .metadataFields(List.of(
                MetadataField.text("userId"),
                MetadataField.text("type"),
                MetadataField.numeric("rating")
            ))
            .build();
    }
}

### 9.2 ë©”íƒ€ë°ì´í„° í•„í„°ë§ í™œìš©

@Service
public class FilteredSearchService {
    private final VectorStore vectorStore;
    
    public List<Document> searchWithFilters(String query, Long userId, String type) {
        // ë³µì¡í•œ í•„í„° í‘œí˜„ì‹
        String filter = String.format(
            "userId == '%s' && type == '%s' && rating >= 4",
            userId, type
        );
        
        return vectorStore.similaritySearch(
            SearchRequest.builder()
                .query(query)
                .topK(10)
                .filterExpression(filter)
                .similarityThreshold(0.6)
                .build()
        );
    }
}

### 9.3 ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”

@Service
public class BatchVectorService {
    private final VectorStore vectorStore;
    private final BatchingStrategy batchingStrategy;
    
    public void saveDocumentsBatch(List<String> contents) {
        // ë¬¸ì„œ ìƒì„±
        List<Document> documents = contents.stream()
            .map(content -> new Document(content, Map.of()))
            .toList();
        
        // ë°°ì¹˜ ì „ëµ ì ìš© (í† í° ì œí•œ ê³ ë ¤)
        List<List<Document>> batches = batchingStrategy.batch(documents);
        
        // ë°°ì¹˜ë³„ë¡œ ì €ì¥
        for (List<Document> batch : batches) {
            vectorStore.add(batch);
        }
    }
}

================================================================================
10. ë©€í‹°ëª¨ë‹¬ ê¸°ëŠ¥ (ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì²˜ë¦¬)
================================================================================

Spring AIëŠ” í…ìŠ¤íŠ¸ë¿ë§Œ ì•„ë‹ˆë¼ ì´ë¯¸ì§€, ë¹„ë””ì˜¤, ì˜¤ë””ì˜¤ ë“± ë‹¤ì–‘í•œ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 10.1 ì´ë¯¸ì§€ ì²˜ë¦¬ (Vision API)

@Service
@RequiredArgsConstructor
public class MultimodalService {
    private final OpenAiChatModel openAiChatModel;
    
    // ì´ë¯¸ì§€ íŒŒì¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì²˜ë¦¬
    public String analyzeImage(byte[] imageData, String question) {
        var userMessage = new UserMessage(
            question,
            new Media(MimeTypeUtils.IMAGE_PNG, imageData)
        );
        
        ChatResponse response = openAiChatModel.call(
            new Prompt(userMessage,
                OpenAiChatOptions.builder()
                    .model("gpt-4o")  // GPT-4 Vision ëª¨ë¸
                    .build()
            )
        );
        
        return response.getResult().getOutput().getContent();
    }
    
    // URLë¡œë¶€í„° ì´ë¯¸ì§€ ì²˜ë¦¬
    public String analyzeImageFromUrl(String imageUrl, String question) {
        var userMessage = new UserMessage(
            question,
            new Media(MimeTypeUtils.IMAGE_PNG, URI.create(imageUrl))
        );
        
        return openAiChatModel.call(new Prompt(userMessage))
            .getResult().getOutput().getContent();
    }
}

### 10.2 Vertex AI ë©€í‹°ëª¨ë‹¬ ì„ë² ë”©

Vertex AIëŠ” ì´ë¯¸ì§€, í…ìŠ¤íŠ¸, ë¹„ë””ì˜¤ë¥¼ ë™ì¼í•œ ë²¡í„° ê³µê°„ì— ì„ë² ë”©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

@Service
@RequiredArgsConstructor
public class MultimodalEmbeddingService {
    private final VertexAiMultimodalEmbeddingModel embeddingModel;
    
    public void embedMultimodal() {
        // ì´ë¯¸ì§€ì™€ ë¹„ë””ì˜¤ ë¯¸ë””ì–´ ìƒì„±
        Media imageMedia = new Media(
            MimeTypeUtils.IMAGE_PNG, 
            new ClassPathResource("/travel-photo.png")
        );
        
        Media videoMedia = new Media(
            new MimeType("video", "mp4"),
            new ClassPathResource("/travel-video.mp4")
        );
        
        // ë©€í‹°ëª¨ë‹¬ ë¬¸ì„œ ìƒì„±
        Document document = new Document(
            "ì´ ì—¬í–‰ ì‚¬ì§„ê³¼ ë¹„ë””ì˜¤ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”",
            List.of(imageMedia, videoMedia),
            Map.of("type", "travel_content")
        );
        
        // ì„ë² ë”© ìƒì„±
        DocumentEmbeddingRequest request = new DocumentEmbeddingRequest(
            List.of(document),
            EmbeddingOptions.EMPTY
        );
        
        EmbeddingResponse response = embeddingModel.call(request);
        
        // ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ê°€ ê°™ì€ ë²¡í„° ê³µê°„ì— ìˆì–´ ìƒí˜¸ ê²€ìƒ‰ ê°€ëŠ¥
        // ì˜ˆ: í…ìŠ¤íŠ¸ë¡œ ì´ë¯¸ì§€ ê²€ìƒ‰, ì´ë¯¸ì§€ë¡œ ë¹„ë””ì˜¤ ê²€ìƒ‰
    }
}

### 10.3 Compass í”„ë¡œì íŠ¸ì—ì„œì˜ í™œìš©

@Service
public class TravelDocumentProcessor {
    private final OpenAiChatModel visionModel;
    private final VectorStore vectorStore;
    
    // ì—¬í–‰ í‹°ì¼“, ë©”ë‰´, ì•ˆë‚´íŒ ë“±ì˜ ì´ë¯¸ì§€ ì²˜ë¦¬
    public void processTravelDocument(MultipartFile image, Long userId) {
        byte[] imageBytes = image.getBytes();
        
        // 1. OCR ë° ì •ë³´ ì¶”ì¶œ
        String extractedInfo = visionModel.call(
            new Prompt(
                new UserMessage(
                    "ì´ë¯¸ì§€ì—ì„œ ë‚ ì§œ, ì¥ì†Œ, ê°€ê²© ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”",
                    new Media(MimeTypeUtils.IMAGE_PNG, imageBytes)
                ),
                OpenAiChatOptions.builder()
                    .model("gpt-4o")
                    .build()
            )
        ).getResult().getOutput().getContent();
        
        // 2. ì¶”ì¶œëœ ì •ë³´ë¥¼ ë²¡í„°í™”í•˜ì—¬ ì €ì¥
        Document doc = new Document(
            extractedInfo,
            Map.of(
                "userId", userId.toString(),
                "type", "travel_document",
                "originalFilename", image.getOriginalFilename()
            )
        );
        
        vectorStore.add(List.of(doc));
    }
}

================================================================================
11. í•˜ì´ë¸Œë¦¬ë“œ MCP ì•„í‚¤í…ì²˜ êµ¬í˜„
================================================================================

### 11.1 Lambda MCP ì„œë²„ êµ¬ì¡°

// Tour API Lambda Function (tour-mcp/index.js)
exports.handler = async (event) => {
    const { method, params } = JSON.parse(event.body);
    
    switch (method) {
        case 'tour/searchKeyword':
            return await searchByKeyword(params);
        case 'tour/searchArea':
            return await searchByArea(params);
        // ... 8ê°œ ë©”ì„œë“œ
    }
};

// Springì—ì„œ Lambda MCP í˜¸ì¶œ
@Service
public class TourMCPService {
    public TourSearchResult searchByKeyword(String keyword) {
        MCPRequest request = MCPRequest.builder()
            .method("tour/searchKeyword")
            .params(Map.of("keyword", keyword))
            .build();
        
        return callLambdaMCP(request, TourSearchResult.class);
    }
}

### 11.2 Perplexity ë‚´ë¶€ í†µí•©

@Service
public class PerplexityService {
    // Spring AI ë‚´ë¶€ì—ì„œ ì§ì ‘ í˜¸ì¶œ
    public TrendingSearchResult searchTrendingDestinations(
            String region, String season, String category) {
        
        // Perplexity API ì§ì ‘ í˜¸ì¶œ
        PerplexityResponse response = callPerplexityAPI(
            buildTrendingPrompt(region, season, category),
            "pplx-70b-online",
            0.2
        );
        
        return parseTrendingResponse(response);
    }
}

### 11.3 ë‹¤ë‹¨ê³„ ê°œì¸í™” íŒŒì´í”„ë¼ì¸

@Service
public class MultiStagePersonalizationService {
    
    public PersonalizedRecommendationResult getPersonalizedRecommendations(
            String userId, RecommendationContext context) {
        
        // Stage 1: Redis Vector Store
        PersonalizationResult stage1 = filterByPersonalization(userId, context);
        
        // Stage 2: Perplexity (Spring AI ë‚´ë¶€)
        TrendingResult stage2 = filterByTrending(stage1, context);
        
        // Stage 3: Tour API (Lambda MCP)
        List<EnrichedRecommendation> stage3 = enrichWithTourAPI(stage2, context);
        
        return buildFinalResult(stage3);
    }
}

================================================================================
12. ë¬¸ì œ í•´ê²° ë° íŒ
================================================================================

### 11.1 ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²°ì±…

ë¬¸ì œ: "í† í° í•œë„ ì´ˆê³¼ ì—ëŸ¬"
í•´ê²°: 
- í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ì œí•œ
- ì»¨í…ìŠ¤íŠ¸ ìš”ì•½ ì‚¬ìš©
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ í™œìš©

@Service
public class TokenOptimizer {
    
    public String optimizePrompt(String longContext) {
        // ê¸´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìš”ì•½
        if (longContext.length() > 3000) {
            return summarize(longContext);
        }
        return longContext;
    }
}

ë¬¸ì œ: "ì‘ë‹µ ì†ë„ê°€ ëŠë¦¼"
í•´ê²°:
- Gemini ì‚¬ìš© (GPT-4ë³´ë‹¤ ë¹ ë¦„)
- ìºì‹± ì ìš©
- ë¹„ë™ê¸° ì²˜ë¦¬

@Service
public class CachedLlmService {
    @Cacheable(value = "llm-responses", key = "#message")
    public String getCachedResponse(String message) {
        return llmService.process(message);
    }
}

ë¬¸ì œ: "ë²¡í„° ê²€ìƒ‰ ì •í™•ë„ê°€ ë‚®ìŒ"
í•´ê²°:
- ì„ë² ë”© ëª¨ë¸ ê°œì„ 
- ë©”íƒ€ë°ì´í„° í•„í„° ì¶”ê°€
- ìœ ì‚¬ë„ ì„ê³„ê°’ ì¡°ì •

### 11.2 ì„±ëŠ¥ ìµœì í™” íŒ

1. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì‚¬ìš©
@RestController
public class StreamController {
    
    @GetMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<String> stream(@RequestParam String message) {
        return chatModel.stream(new Prompt(message))
            .map(response -> response.getResult().getOutput().getContent());
    }
}

2. ë³‘ë ¬ ì²˜ë¦¬
@Service
public class ParallelLlmService {
    
    @Async
    public CompletableFuture<String> processAsync(String message) {
        return CompletableFuture.completedFuture(
            chatModel.call(new Prompt(message))
                .getResult().getOutput().getContent()
        );
    }
}

3. ì—°ê²° í’€ ì„¤ì •
spring:
  ai:
    openai:
      connection:
        timeout: 30s
        max-connections: 100

### 11.3 ë””ë²„ê¹… íŒ

1. ë¡œê¹… í™œì„±í™”
logging:
  level:
    org.springframework.ai: DEBUG

2. ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§
@Component
public class LlmMetrics {
    private final MeterRegistry meterRegistry;
    
    public void recordLatency(long latency) {
        meterRegistry.timer("llm.latency").record(latency, TimeUnit.MILLISECONDS);
    }
}

### 11.4 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. API í‚¤ ê´€ë¦¬
- ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê¸°
- í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ì‹œí¬ë¦¿ ë§¤ë‹ˆì € ì‚¬ìš©

2. ì…ë ¥ ê²€ì¦
@Service
public class InputValidator {
    
    public String sanitizeInput(String input) {
        // ì•…ì˜ì ì¸ í”„ë¡¬í”„íŠ¸ í•„í„°ë§
        return input.replaceAll("[<>\"']", "");
    }
}

3. ì‚¬ìš©ëŸ‰ ì œí•œ
@Component
public class RateLimiter {
    
    @RateLimited(limit = 100, duration = 1, unit = TimeUnit.HOURS)
    public String processWithLimit(String message) {
        return llmService.process(message);
    }
}

================================================================================
ë§ˆë¬´ë¦¬
================================================================================

Spring AIëŠ” Spring ê°œë°œìê°€ AI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” 
ê°•ë ¥í•œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. 

ìš°ë¦¬ Compass í”„ë¡œì íŠ¸ì—ì„œëŠ”:
- Gemini 2.5 Flashë¡œ ë¹ ë¥¸ ì‘ë‹µ
- GPT-4o-minië¡œ ì •í™•í•œ ê³„íš
- Redis Vector Storeë¡œ ê°œì¸í™”
- RAGë¡œ ë§ì¶¤í˜• ì¶”ì²œ
- ì½œë“œ ìŠ¤íƒ€íŠ¸ í•´ê²°ë¡œ ì‹ ê·œ ì‚¬ìš©ì ëŒ€ì‘

ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ í•™ìŠµ ìë£Œ:
- ê³µì‹ ë¬¸ì„œ: https://docs.spring.io/spring-ai/reference/
- GitHub: https://github.com/spring-projects/spring-ai
- ì˜ˆì œ í”„ë¡œì íŠ¸: https://github.com/spring-projects/spring-ai-examples

ì§ˆë¬¸ì´ ìˆìœ¼ë©´ íŒ€ ìŠ¬ë™ ì±„ë„ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”!

Happy Coding! ğŸš€