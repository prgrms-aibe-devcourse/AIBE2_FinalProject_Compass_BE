# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with this repository.

## ⚠️ 최우선 준수사항 - 반드시 읽고 따를 것

### 🔴 Git 관련 절대 금지사항
1. **CLAUDE.md 파일은 절대 Git에 올라가면 안됨** (이미 .gitignore에 포함)
2. **Claude가 생성한 문서는 절대 커밋하지 않음**
3. **AI가 작성했다는 흔적이 있는 파일은 절대 커밋 금지**
4. **"Generated by", "Created by AI", "Claude" 등의 단어가 포함된 코드/주석/문서 절대 금지**

### 🔴 코드 통일성 - 가장 중요
1. **팀원이 작성한 것처럼 보여야 함** - AI 흔적 완전 제거
2. **기존 코드 스타일과 100% 일치** - 다른 파일들과 비교하여 동일한 패턴 사용
3. **너무 완벽한 코드 금지** - 인간적인 실수나 점진적 개선이 자연스러움
4. **일관된 주석 스타일** - // 한국어 주석만, 간결하게
5. **동일한 네이밍 규칙** - 기존 코드베이스의 네이밍 패턴 엄격히 준수

## Project Overview

Compass is an AI-powered personalized travel planning service built with Spring Boot and Spring AI. The backend provides REST APIs for authentication, chat functionality, and personalized travel recommendations using LLM integration.

### Technology Stack
- **Framework**: Spring Boot 3.x, Java 17
- **AI/ML**: Spring AI 1.0.0-M5 (Gemini 2.0 Flash, GPT-4o-mini)
- **Database**: AWS RDS PostgreSQL, Redis 7
- **Security**: JWT 인증
- **Deployment**: Docker, AWS

## Configuration

### 환경 변수
```bash
# 필수 파일 (프로젝트 루트에 위치)
.env  # API 키 및 설정값
/Users/kmj/Documents/GitHub/AIBE2_FinalProject_Compass_BE/travelagent-468611-1ae0c9d4e187.json  # Google Cloud 인증
```

**주의**: `.env` 파일은 절대 커밋하지 마세요 (`.gitignore`에 포함됨)

### Spring Profiles
- **docker-rds**: Docker 컨테이너 + AWS RDS (권장)
- **test**: 테스트 환경
- **test-no-redis**: Redis 없는 단위 테스트

## 🎯 코드 작성 핵심 원칙

### AI 코드 생성시 필수 준수 사항
1. **AI 코딩 흔적 완전 제거**: 인간이 작성한 것처럼 자연스럽고 점진적인 코드
2. **팀 일관성 최우선**: 기존 코드베이스와 완벽하게 동일한 스타일
3. **클린코드 원칙**: 읽기 쉽고, 수정하기 쉽고, 테스트하기 쉬운 코드

### 작업 단위 규칙
- **한 번 작성량**: 150-200줄 (최대 300줄)
- **PR 규칙**: 실제 로직 ~150줄 + 테스트 ~100줄 + 설정/문서 ~50줄
- **단일 책임**: 한 번에 하나의 기능만 구현

## ✅ Java 17 & Lombok 필수 사용

### 1. DTO → Record 사용
```java
// DTO는 무조건 Record
public record TravelRequest(
    String destination,
    LocalDate startDate,
    LocalDate endDate,
    Integer budget
) {}
```

### 2. Entity → Lombok 사용
```java
@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Travel {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String destination;
    private LocalDate startDate;
}
```

### 3. Service → @RequiredArgsConstructor
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class TravelService {
    private final TravelRepository repository;
    // 생성자 자동 생성
}
```

## 📝 주석 스타일 (필수)

### ✅ // 주석만 사용 (한국어, 간결)
```java
// 여행 서비스
@Service
public class TravelService {

    // 여행 정보 처리
    public TravelResponse processTravel(TravelRequest request) {
        // 요청 검증
        validateRequest(request);

        // 예산 계산: 1인당 * 인원수
        int total = perPerson * count;

        return response;
    }
}
```

### ❌ 금지된 주석
- `/** */` JavaDoc 스타일 금지
- `/* */` 블록 주석 금지
- 영어 주석 금지
- AI가 생성했다는 암시 주석 금지
- 너무 완벽하거나 장황한 주석 금지

## 📏 코드 작성 규칙

### 메서드 규칙
- **최대 20줄** (이상적으로 10줄)
- **단일 책임**: 한 메서드 = 한 가지 일
- **명확한 네이밍**: 동사 + 명사

### 클래스 규칙
- **최대 200줄**
- **단일 책임 원칙**
- **관련 기능만 포함**

### 네이밍 컨벤션
```java
// 클래스: PascalCase
public class TravelService {}

// 메서드: camelCase
public TravelDto findById(Long id) {}

// 상수: UPPER_SNAKE_CASE
private static final int MAX_RETRY_COUNT = 3;

// 패키지: lowercase
package com.compass.travel;
```

## 🔧 Java 17 기능 활용

### 1. var 사용 (타입 명확할 때만)
```java
var travelList = new ArrayList<Travel>();
var response = travelService.findById(id);
```

### 2. Switch Expression
```java
public String getTravelType(String category) {
    return switch (category) {
        case "BUDGET" -> "경제적 여행";
        case "LUXURY" -> "럭셔리 여행";
        default -> "일반 여행";
    };
}
```

### 3. Text Blocks (SQL, JSON)
```java
String sql = """
    SELECT * FROM travel
    WHERE user_id = ?
    AND status = 'ACTIVE'
    """;
```

### 4. 불변 컬렉션
```java
List<String> cities = List.of("서울", "부산", "제주");
```

## 🚫 절대 금지 사항

### 코드 생성 관련
1. **getter/setter 직접 작성 금지** → Lombok 사용
2. **생성자 직접 작성 금지** → @RequiredArgsConstructor, @Builder
3. **한 번에 전체 CRUD 구현 금지** → 점진적 구현
4. **300줄 넘는 코드 생성 금지** → 작은 단위로 분할

### 주석 관련
5. **/* */ /** */ 주석 금지** → // 만 사용
6. **영어 주석 금지** → 한국어만
7. **AI 관련 단어 포함 금지** → Generated, Created by, AI, Claude 등
8. **불필요한 주석 금지** → 코드로 의도 표현

### Git 관련
9. **CLAUDE.md 커밋 금지** → .gitignore에 포함 확인
10. **AI 생성 문서 커밋 금지** → 개발자가 검토 후 수정
11. **완벽한 초기 코드 금지** → 점진적 개선이 자연스러움

## 📝 AI 코드 생성 프로토콜

### 코드 생성 전 필수 체크
1. **코드베이스 전체 분석**
   - 기존 패턴 파악
   - 네이밍 컨벤션 확인
   - 의존성 관계 이해
   - 팀원들의 코딩 스타일 학습

2. **작성 후 필수 설명**
   ```markdown
   ## 작성 코드 정보
   - **위치**: src/main/java/com/compass/...
   - **목적**: [구체적 기능]
   - **의존성**: [사용하는 컴포넌트]
   - **사용처**: [이 코드를 사용할 곳]
   - **영향범위**: [변경 영향]
   ```

## 🔍 코드 생성시 체크리스트

```yaml
통일성 체크:
  ✓ 기존 코드와 동일한 스타일인가?
  ✓ 팀원이 작성한 것처럼 자연스러운가?
  ✓ AI 흔적이 전혀 없는가?

기술 체크:
  ✓ DTO는 Record 사용했는가?
  ✓ Entity는 Lombok 사용했는가?
  ✓ Service는 @RequiredArgsConstructor 사용했는가?

주석 체크:
  ✓ // 주석만 사용했는가?
  ✓ 주석은 한국어로 간결하게 작성했는가?
  ✓ AI 관련 단어가 없는가?

코드 품질:
  ✓ 메서드 20줄 이내인가?
  ✓ 클래스 200줄 이내인가?
  ✓ 생성 코드 300줄 이내인가?
  ✓ 너무 완벽하지 않고 자연스러운가?
```

## Important Notes

1. **Git 작업 금지**: 모든 git 작업은 개발자가 직접 수행
2. **Docker 필수**: 백엔드는 반드시 Docker로 실행
3. **Spring AI 사용**: 직접 API 호출 대신 Spring AI 추상화 사용
4. **통일성 최우선**: 팀 전체 코드 스타일과 완벽히 일치
5. **점진적 개선**: 첫 구현은 단순하게, 이후 개선
6. **AI 흔적 제거**: 절대 AI가 만든 코드임을 드러내지 않음