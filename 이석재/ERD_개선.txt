# ğŸ“ Trip Planning Domain ERD - ì´ì„ì¬

## ğŸ“‹ ë‹´ë‹¹ ë„ë©”ì¸
- Trip Planning Domain: ì—¬í–‰ ê³„íš, ì¼ì • ê´€ë¦¬, AI ê¸°ë°˜ ì—¬í–‰ ìƒì„±

---

## ğŸ“Š Entities

### ì—¬í–‰ ê³„íš
```sql
Trip {
    trip_id: UUID (PK)
    user_id: UUID (FK â†’ User Management Domain)
    title: VARCHAR(255)
    description: TEXT
    start_date: DATE
    end_date: DATE
    destination: VARCHAR(255)
    budget: DECIMAL(10,2)
    travel_style: VARCHAR(100)
    visibility: ENUM('private', 'shared', 'public')
    status: ENUM('draft', 'planned', 'ongoing', 'completed')
    total_likes: INT DEFAULT 0
    total_views: INT DEFAULT 0
    ai_generated: BOOLEAN DEFAULT false
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### ì—¬í–‰ ì¼ì •
```sql
Itinerary {
    itinerary_id: UUID (PK)
    trip_id: UUID (FK â†’ Trip)
    day_number: INT
    date: DATE
    title: VARCHAR(255)
    notes: TEXT
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### ì¼ì • í•­ëª©
```sql
ItineraryItem {
    item_id: UUID (PK)
    itinerary_id: UUID (FK â†’ Itinerary)
    place_id: UUID (FK â†’ Place)
    start_time: TIME
    end_time: TIME
    duration_minutes: INT
    notes: TEXT
    order_index: INT
    transportation_mode: VARCHAR(50)
    transportation_duration: INT
    cost: DECIMAL(10,2)
    created_at: TIMESTAMP
}
```

### ì¥ì†Œ
```sql
Place {
    place_id: UUID (PK)
    google_place_id: VARCHAR(255) (UNIQUE)
    name: VARCHAR(255)
    address: TEXT
    latitude: DECIMAL(10,8)
    longitude: DECIMAL(11,8)
    category: VARCHAR(100)
    phone: VARCHAR(50)
    website: VARCHAR(500)
    opening_hours: JSON
    rating: DECIMAL(2,1)
    price_level: INT
    photo_urls: JSON
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### ì—¬í–‰ í˜‘ì—…ì
```sql
TripCollaborator {
    collaborator_id: UUID (PK)
    trip_id: UUID (FK â†’ Trip)
    user_id: UUID (FK â†’ User Management Domain)
    permission: ENUM('view', 'edit', 'admin')
    invited_at: TIMESTAMP
    accepted_at: TIMESTAMP
}
```

### ì—¬í–‰ ì¢‹ì•„ìš”
```sql
TripLike {
    like_id: UUID (PK)
    trip_id: UUID (FK â†’ Trip)
    user_id: UUID (FK â†’ User Management Domain)
    created_at: TIMESTAMP
}
```

### AI ì—¬í–‰ ìƒì„± ìš”ì²­
```sql
AITripRequest {
    request_id: UUID (PK)
    thread_id: UUID (FK â†’ AI Client Domain)
    user_id: UUID (FK â†’ User Management Domain)
    request_data: JSON
    preferences: JSON
    generated_trip_id: UUID (FK â†’ Trip)
    status: ENUM('pending', 'processing', 'completed', 'failed')
    created_at: TIMESTAMP
    completed_at: TIMESTAMP
}
```

### AI ì¶”ì²œ ì¥ì†Œ
```sql
AISuggestedPlace {
    suggestion_id: UUID (PK)
    trip_id: UUID (FK â†’ Trip)
    place_id: UUID (FK â†’ Place)
    reason: TEXT
    confidence_score: DECIMAL(3,2)
    accepted: BOOLEAN DEFAULT false
    created_at: TIMESTAMP
}
```

### ì—¬í–‰ í…œí”Œë¦¿
```sql
TripTemplate {
    template_id: UUID (PK)
    name: VARCHAR(255)
    description: TEXT
    destination: VARCHAR(255)
    duration_days: INT
    travel_style: VARCHAR(100)
    budget_range: VARCHAR(50)
    template_data: JSON
    usage_count: INT DEFAULT 0
    created_at: TIMESTAMP
}
```

---

## ğŸ”µ External APIs (ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)

### Trip Management
```yaml
GET /api/trips:
  Description: "ì—¬í–‰ ëª©ë¡ ì¡°íšŒ"
  Query: page, size, visibility?, destination?
  Response: TripListResponse
  
GET /api/trips/{tripId}:
  Description: "ì—¬í–‰ ìƒì„¸ ì¡°íšŒ"
  Response: TripDetailResponse
  
POST /api/trips:
  Description: "ì—¬í–‰ ìƒì„±"
  Body: { title, description, start_date, end_date, destination, budget }
  Response: TripResponse
  
PUT /api/trips/{tripId}:
  Description: "ì—¬í–‰ ìˆ˜ì •"
  Body: { title?, description?, dates?, budget? }
  Response: TripResponse
  
DELETE /api/trips/{tripId}:
  Description: "ì—¬í–‰ ì‚­ì œ"
  Response: 204 No Content
  
POST /api/trips/{tripId}/like:
  Description: "ì—¬í–‰ ì¢‹ì•„ìš”"
  Response: { liked: boolean, total_likes: number }
```

### AI Trip Generation (Trip Planning Domain ì±…ì„)
```yaml
POST /api/trips/generate-from-chat:
  Description: "AI ê¸°ë°˜ ì—¬í–‰ ìƒì„±"
  Body: { thread_id, preferences, context }
  Response: GeneratedTripResponse
  
GET /api/trips/ai-suggestions/{tripId}:
  Description: "AI ì¶”ì²œ ì¥ì†Œ ì¡°íšŒ"
  Response: AISuggestedPlacesResponse
  
POST /api/trips/ai-suggestions/{tripId}/accept:
  Description: "AI ì¶”ì²œ ìˆ˜ë½"
  Body: { suggestion_id }
  Response: SuggestionAcceptResponse
```

### Itinerary Management
```yaml
GET /api/trips/{tripId}/itineraries:
  Description: "ì¼ì • ëª©ë¡ ì¡°íšŒ"
  Response: ItineraryListResponse
  
POST /api/trips/{tripId}/itineraries:
  Description: "ì¼ì • ìƒì„±"
  Body: { day_number, date, title }
  Response: ItineraryResponse
  
PUT /api/itineraries/{itineraryId}:
  Description: "ì¼ì • ìˆ˜ì •"
  Body: { title?, notes? }
  Response: ItineraryResponse
  
POST /api/itineraries/{itineraryId}/items:
  Description: "ì¼ì • í•­ëª© ì¶”ê°€"
  Body: { place_id, start_time, end_time, notes }
  Response: ItineraryItemResponse
  
PUT /api/itinerary-items/{itemId}:
  Description: "ì¼ì • í•­ëª© ìˆ˜ì •"
  Body: { start_time?, end_time?, notes? }
  Response: ItineraryItemResponse
  
DELETE /api/itinerary-items/{itemId}:
  Description: "ì¼ì • í•­ëª© ì‚­ì œ"
  Response: 204 No Content
```

### Places
```yaml
GET /api/places:
  Description: "ì¥ì†Œ ëª©ë¡ ì¡°íšŒ"
  Query: category?, location?, radius?
  Response: PlaceListResponse
  
GET /api/places/{placeId}:
  Description: "ì¥ì†Œ ìƒì„¸ ì¡°íšŒ"
  Response: PlaceDetailResponse
  
POST /api/places:
  Description: "ì¥ì†Œ ë“±ë¡"
  Body: { google_place_id, name, address, location }
  Response: PlaceResponse
  
POST /api/places/search:
  Description: "ì¥ì†Œ ê²€ìƒ‰"
  Body: { query, location?, category? }
  Response: PlaceSearchResponse
```

### Collaboration
```yaml
POST /api/trips/{tripId}/collaborators:
  Description: "í˜‘ì—…ì ì´ˆëŒ€"
  Body: { user_id, permission }
  Response: CollaboratorResponse
  
PUT /api/trips/{tripId}/collaborators/{userId}:
  Description: "í˜‘ì—…ì ê¶Œí•œ ìˆ˜ì •"
  Body: { permission }
  Response: CollaboratorResponse
  
DELETE /api/trips/{tripId}/collaborators/{userId}:
  Description: "í˜‘ì—…ì ì œê±°"
  Response: 204 No Content
```

### Templates
```yaml
GET /api/trip-templates:
  Description: "í…œí”Œë¦¿ ëª©ë¡"
  Query: destination?, style?, duration?
  Response: TemplateListResponse
  
POST /api/trips/from-template:
  Description: "í…œí”Œë¦¿ìœ¼ë¡œ ì—¬í–‰ ìƒì„±"
  Body: { template_id, customizations }
  Response: TripResponse
```

---

## ğŸ”´ Internal APIs (ë„ë©”ì¸ ë‚´ë¶€ìš©)

```yaml
POST /api/internal/trips/validate:
  Description: "ì—¬í–‰ ìœ íš¨ì„± ê²€ì¦"
  Body: { trip_id, user_id }
  
POST /api/internal/trips/stats:
  Description: "ì—¬í–‰ í†µê³„ ì—…ë°ì´íŠ¸"
  Body: { trip_id, view_count?, like_count? }
  
GET /api/internal/trips/user/{userId}:
  Description: "ì‚¬ìš©ì ì—¬í–‰ ì¡°íšŒ"
  Response: UserTripsResponse
  
POST /api/internal/places/sync:
  Description: "Google Places ë™ê¸°í™”"
  Body: { google_place_ids[] }
  
POST /api/internal/trips/optimize-route:
  Description: "ê²½ë¡œ ìµœì í™”"
  Body: { itinerary_id }
  
GET /api/internal/trips/chat/{threadId}:
  Description: "ì±„íŒ… ì—°ê´€ ì—¬í–‰ ì¡°íšŒ"
  Response: ChatLinkedTripsResponse
```

---

## ğŸ”— ì™¸ë¶€ ë„ë©”ì¸ ì˜ì¡´ì„±

### í•„ìš”í•œ ì™¸ë¶€ API
```yaml
User Management Domain:
  - GET /api/users/{userId}: "ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"
  - GET /api/internal/users/validate: "ì‚¬ìš©ì ìœ íš¨ì„± ê²€ì¦"
  
AI Client Domain:
  - GET /api/chat/threads/{threadId}/context: "ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ"
  - POST /api/chat/threads/{threadId}/trip-request: "ì—¬í–‰ ìƒì„± ìš”ì²­ ê¸°ë¡"
  
Review System Domain:
  - GET /api/reviews/place/{placeId}: "ì¥ì†Œ ë¦¬ë·° ì¡°íšŒ"
  - GET /api/reviews/trip/{tripId}: "ì—¬í–‰ ë¦¬ë·° ì¡°íšŒ"
  
Media Management Domain:
  - POST /api/media/upload: "ì—¬í–‰ ì‚¬ì§„ ì—…ë¡œë“œ"
  - GET /api/media/trip/{tripId}: "ì—¬í–‰ ë¯¸ë””ì–´ ì¡°íšŒ"
  
Sharing Domain:
  - POST /api/share/trip: "ì—¬í–‰ ê³µìœ "
  - GET /api/share/trip/{tripId}: "ê³µìœ  ì •ë³´ ì¡°íšŒ"
```

---

## ğŸ“ DTO ì •ì˜

### Request DTOs
```typescript
CreateTripRequest {
  title: string
  description?: string
  start_date: string
  end_date: string
  destination: string
  budget?: number
  travel_style?: string
}

GenerateTripFromChatRequest {
  thread_id: string
  preferences: {
    destination?: string
    duration?: number
    budget?: number
    travel_style?: string
    interests?: string[]
  }
  context: object
}

AddItineraryItemRequest {
  place_id: string
  start_time: string
  end_time: string
  notes?: string
  transportation_mode?: string
  cost?: number
}
```

### Response DTOs
```typescript
TripResponse {
  trip_id: string
  title: string
  description: string
  start_date: string
  end_date: string
  destination: string
  budget: number
  visibility: string
  status: string
  total_likes: number
  total_views: number
  ai_generated: boolean
  itineraries?: ItineraryResponse[]
  collaborators?: CollaboratorResponse[]
  created_at: string
}

GeneratedTripResponse {
  trip: TripResponse
  suggestions: AISuggestedPlaceResponse[]
  generation_metadata: {
    thread_id: string
    confidence_score: number
    generation_time_ms: number
  }
}

PlaceResponse {
  place_id: string
  name: string
  address: string
  location: {
    lat: number
    lng: number
  }
  category: string
  rating?: number
  price_level?: number
  opening_hours?: object
  photo_urls?: string[]
}
```

---

## ğŸ’¡ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

1. **AI ì—¬í–‰ ìƒì„± í”Œë¡œìš°**
   - ì±„íŒ… ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì‹  â†’ ì‚¬ìš©ì ì„ í˜¸ë„ ë¶„ì„ â†’ ì¥ì†Œ ì¶”ì²œ ìƒì„± â†’ ì¼ì • ìµœì í™” â†’ ì—¬í–‰ ê³„íš ìƒì„±

2. **ì¼ì • ìµœì í™”**
   - ì¥ì†Œ ê°„ ê±°ë¦¬ ê³„ì‚° â†’ ì´ë™ ì‹œê°„ ì¶”ì • â†’ ì˜ì—…ì‹œê°„ ê³ ë ¤ â†’ ìµœì  ê²½ë¡œ ìƒì„±

3. **í˜‘ì—… ê´€ë¦¬**
   - ì´ˆëŒ€ ë°œì†¡ â†’ ê¶Œí•œ ì„¤ì • â†’ ì‹¤ì‹œê°„ ë™ê¸°í™” â†’ ë³€ê²½ ì•Œë¦¼

4. **í…œí”Œë¦¿ ì‹œìŠ¤í…œ**
   - ì¸ê¸° ì—¬í–‰ ë¶„ì„ â†’ í…œí”Œë¦¿ ìƒì„± â†’ ì‚¬ìš©ì ë§ì¶¤í™” â†’ ì—¬í–‰ ìƒì„±

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- ì—¬í–‰ ê³µê°œ ë²”ìœ„ ì œì–´
- í˜‘ì—…ì ê¶Œí•œ ê´€ë¦¬
- ìœ„ì¹˜ ì •ë³´ í”„ë¼ì´ë²„ì‹œ
- API Rate Limiting
- ë°ì´í„° ì•”í˜¸í™”