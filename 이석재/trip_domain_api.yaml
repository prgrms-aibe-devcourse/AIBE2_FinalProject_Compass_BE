openapi: 3.0.3
info:
  title: Compass Trip System API
  description: |
    # Trip ë„ë©”ì¸ OpenAPI ëª…ì„¸ì„œ

    ## ğŸ“‹ ë„ë©”ì¸ êµ¬ì„± ìš”ì•½
    
    ### Trip ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤
    - **ì—¬í–‰ ê³„íš ê´€ë¦¬**: ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ
    - **ì„¸ë¶€ ì¼ì • ê´€ë¦¬**: ë‚ ì§œë³„ ì•„ì´í…œ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ
    - **ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸**: í•­ëª© ì¶”ê°€, ì²´í¬, ìˆ˜ì •
    - **ì°¸ì—¬ì ê´€ë¦¬**: ì´ˆëŒ€, ì œê±°, ê¶Œí•œ ì„¤ì •
    
    ## ğŸ“Š ë„ë©”ì¸ ê°„ ìƒí˜¸ì‘ìš©
    
    | ë„ë©”ì¸ | Trip â†’ ì™¸ë¶€ (ìš”ì²­) | ì™¸ë¶€ â†’ Trip (í˜¸ì¶œ) | ì£¼ìš” ìš©ë„ |
    |---|---|---|---|
    | **User** | â€¢ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ | - | ì—¬í–‰ ì†Œìœ ì/ì°¸ì—¬ì ì •ë³´ í™•ì¸ |
    | **Place** | â€¢ ì¥ì†Œ ì •ë³´ ê²€ìƒ‰/ì¡°íšŒ | - | ì¼ì •ì— ì¥ì†Œ ì •ë³´ ì—°ê²° |
    | **Weather** | â€¢ ë‚ ì”¨ ì •ë³´ ì¡°íšŒ | - | ì¼ì • ê¸°ë°˜ ë‚ ì”¨ ìš”ì•½ ì œê³µ |
    | **Notification** | â€¢ ì•Œë¦¼ ë°œì†¡ ìš”ì²­ | - | ì°¸ì—¬ì ì´ˆëŒ€, ì¼ì • ë³€ê²½ ë“± ì•Œë¦¼ |

    ## ğŸ”„ ì£¼ìš” ì²˜ë¦¬ íë¦„
    
    ### ì—¬í–‰ ê³„íš ìƒì„±
    1. User Domainì—ì„œ ì‚¬ìš©ì ì¸ì¦ í™•ì¸
    2. ì œëª©, ê¸°ê°„ ë“± ê¸°ë³¸ ì •ë³´ë¡œ Trip ìƒì„±
    3. ìƒì„±ëœ Trip ID ë°˜í™˜
    
    ### ì¼ì •ì— ì¥ì†Œ ì¶”ê°€
    1. Place Domainì—ì„œ ì¥ì†Œ ê²€ìƒ‰
    2. íŠ¹ì • ë‚ ì§œì— ì¥ì†Œ ì •ë³´ì™€ í•¨ê»˜ ScheduleItem ìƒì„±
    3. ì´ë™ ì‹œê°„/ê²½ë¡œ ê³„ì‚° (í•„ìš”ì‹œ)
  version: 1.0.0
servers:
  - url: https://api.compass.com/api
    description: Production Server
  - url: http://localhost:8080/api
    description: Development Server
tags:
  - name: Trip - Core
    description: ì—¬í–‰ ê³„íš ë° ì¼ì • ê´€ë¦¬
  - name: Place - Core
    description: ì¥ì†Œ ê²€ìƒ‰ ë° ìƒì„¸ì •ë³´
  - name: Reservation - Core
    description: ì˜ˆì•½ ê´€ë¦¬
  - name: Weather - Core
    description: ë‚ ì”¨ ì •ë³´ ë° ì•Œë¦¼ ê´€ë¦¬
paths:
  /trips:
    post:
      tags: [Trip - Core]
      summary: ì—¬í–‰ ê³„íš ìƒì„±
      security:
        - bearerAuth: []
      operationId: createTrip
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTripRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /trips/{tripId}:
    patch:
      tags: [Trip - Core]
      summary: ì—¬í–‰ ê³„íš ìˆ˜ì •/ìƒíƒœ ë³€ê²½
      security:
        - bearerAuth: []
      operationId: updateTrip
      parameters:
        - $ref: '#/components/parameters/tripId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTripRequest'
      responses:
        '200': 
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409': 
          $ref: '#/components/responses/ConflictError'

  /trips/{tripId}/schedules:
    post:
      tags: [Trip - Core]
      summary: ì¼ì • ì•„ì´í…œ ì¶”ê°€
      security:
        - bearerAuth: []
      operationId: createSchedule
      parameters:
        - $ref: '#/components/parameters/tripId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScheduleRequest'
      responses:
        '201': 
          description: Created
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /trips/{tripId}/checklist:
    post:
      tags: [Trip - Core]
      summary: ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì¶”ê°€
      security:
        - bearerAuth: []
      operationId: addChecklistItem
      parameters:
        - $ref: '#/components/parameters/tripId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChecklistItemRequest'
      responses:
        '201': 
          description: Created
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /trips/{tripId}/participants:
    post:
      tags: [Trip - Core]
      summary: ì°¸ì—¬ì ì´ˆëŒ€
      security:
        - bearerAuth: []
      operationId: inviteParticipant
      parameters:
        - $ref: '#/components/parameters/tripId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteParticipantRequest'
      responses:
        '200':
          description: ì´ˆëŒ€ ì„±ê³µ
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'

  /trips/{tripId}/participants/{userId}:
    delete:
      tags: [Trip - Core]
      summary: ì°¸ì—¬ì ì œê±°
      security:
        - bearerAuth: []
      operationId: removeParticipant
      parameters:
        - $ref: '#/components/parameters/tripId'
        - $ref: '#/components/parameters/userId'
      responses:
        '204':
          description: ì œê±° ì„±ê³µ (No Content)
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /places/search:
    get:
      tags: [Place - Core]
      summary: ì¥ì†Œ ê²€ìƒ‰
      security:
        - bearerAuth: []
      operationId: searchPlaces
      parameters:
        - name: keyword
          in: query
          schema: { type: string }
        - name: category
          in: query
          schema: { type: string }
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /places/{placeId}:
    get:
      tags: [Place - Core]
      summary: ì¥ì†Œ ìƒì„¸ ì¡°íšŒ
      security:
        - bearerAuth: []
      operationId: getPlaceDetails
      parameters:
        - $ref: '#/components/parameters/placeId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaceResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /trips/{tripId}/reservations:
    post:
      tags: [Reservation - Core]
      summary: ì˜ˆì•½ ì¶”ê°€
      security:
        - bearerAuth: []
      operationId: createReservation
      parameters:
        - $ref: '#/components/parameters/tripId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReservationRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    get:
      tags: [Reservation - Core]
      summary: íŠ¹ì • ì—¬í–‰ì˜ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ
      security:
        - bearerAuth: []
      operationId: getReservationsForTrip
      parameters:
        - $ref: '#/components/parameters/tripId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReservationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /trips/{tripId}/reservations/{reservationId}:
    patch:
      tags: [Reservation - Core]
      summary: ì˜ˆì•½ ìƒíƒœ/ë©”ëª¨ ìˆ˜ì •
      security:
        - bearerAuth: []
      operationId: updateReservation
      parameters:
        - $ref: '#/components/parameters/tripId'
        - $ref: '#/components/parameters/reservationId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateReservationRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /trips/{tripId}/weather/summary:
    get:
      tags: [Weather - Core]
      summary: ì¼ì • ê¸°ë°˜ ë‚ ì”¨ ìš”ì•½ ì¡°íšŒ
      security:
        - bearerAuth: []
      operationId: getWeatherSummary
      parameters:
        - $ref: '#/components/parameters/tripId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeatherSummaryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: ì‚¬ìš©ì ì¸ì¦ìš© JWT í† í°
  parameters:
    tripId:
      name: tripId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    placeId:
      name: placeId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    reservationId:
      name: reservationId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    userId:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  schemas:
    CreateTripRequest:
      type: object
      required: [title, startDate, endDate]
      properties:
        title:
          type: string
        description:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date

    UpdateTripRequest:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        startDate: { type: string, format: date }
        endDate: { type: string, format: date }
        status: { type: string }

    TripResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        description: { type: string }
        startDate: { type: string, format: date }
        endDate: { type: string, format: date }
        status: { type: string }
        budget:
          type: object
          properties:
            currency: { type: string }
            totalMinor: { type: integer }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    CreateScheduleRequest:
      type: object
      required: [date, startTime, endTime, title]
      properties:
        date: { type: string, format: date }
        startTime: { type: string }
        endTime: { type: string }
        title: { type: string }
        memo: { type: string }
        placeId: { type: string, format: uuid }
        costMinor: { type: integer }

    CreateChecklistItemRequest:
      type: object
      required: [text]
      properties:
        text: { type: string }
        checked: { type: boolean }
        sortOrder: { type: integer }

    InviteParticipantRequest:
      type: object
      required: [userId, role]
      properties:
        userId:
          type: string
          format: uuid
          description: "ì´ˆëŒ€í•  ì‚¬ìš©ìì˜ ID"
        role:
          type: string
          enum: [EDITOR, VIEWER]
          description: "ë¶€ì—¬í•  ê¶Œí•œ"

    RemoveParticipantRequest:
      type: object
      required: [userId]
      properties:
        userId:
          type: string
          format: uuid
          description: "ì œê±°í•  ì‚¬ìš©ìì˜ ID"

    PlaceResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        source: { type: string }
        externalId: { type: string }
        name: { type: string }
        location: { type: object }
        detail: { type: object }
        cachedAt: { type: string, format: date-time }

    CreateReservationRequest:
      type: object
      required: [type, vendor, startAt, endAt, amountMinor, currency]
      properties:
        type: { type: string, enum: [hotel, flight, tour, etc] }
        vendor: { type: string }
        refCode: { type: string }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        amountMinor: { type: integer }
        currency: { type: string }
        notes: { type: string }

    UpdateReservationRequest:
      type: object
      properties:
        status: { type: string, enum: [PENDING, CONFIRMED, CANCELED] }
        notes: { type: string }

    ReservationResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        type: { type: string, enum: [hotel, flight, tour, etc] }
        vendor: { type: string }
        refCode: { type: string }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        amountMinor: { type: integer }
        currency: { type: string }
        status: { type: string, enum: [PENDING, CONFIRMED, CANCELED] }
        notes: { type: string }
        updatedAt: { type: string, format: date-time }

    WeatherSummaryResponse:
      type: array
      items:
        type: object
        properties:
          date: { type: string, format: date }
          icon: { type: string, description: "ë‚ ì”¨ ì•„ì´ì½˜ ì½”ë“œ (e.g., '01d')" }
          tips:
            type: array
            items:
              type: string
            description: "ë‚ ì”¨ ê´€ë ¨ íŒ (e.g., 'ìš°ì‚°ì„ ì±™ê¸°ì„¸ìš”')"
          alerts:
            type: array
            items:
              type: string
            description: "ì£¼ì˜ë³´/ê²½ë³´ ë©”ì‹œì§€"

    ErrorResponse:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: string
        timestamp:
          type: string
          format: date-time
  
  responses:
    BadRequestError:
      description: ì˜ëª»ëœ ìš”ì²­ (ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ë“±)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: TRIP_001
            message: "ìš”ì²­ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
            timestamp: "2024-01-25T10:00:00Z"

    UnauthorizedError:
      description: ì¸ì¦ ì‹¤íŒ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: AUTH_001
            message: "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤."
            timestamp: "2024-01-25T10:00:00Z"

    NotFoundError:
      description: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: TRIP_404
            message: "ì—¬í–‰ ê³„íšì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            timestamp: "2024-01-25T10:00:00Z"
            
    ConflictError:
      description: ì¶©ëŒ ë°œìƒ (ìƒíƒœ ì „ì´ ìœ„ë°˜, ì¤‘ë³µ ë“±)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: TRIP_009
            message: "ì´ë¯¸ ì™„ë£Œëœ ì—¬í–‰ì˜ ìƒíƒœëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            timestamp: "2024-01-25T10:00:00Z"
