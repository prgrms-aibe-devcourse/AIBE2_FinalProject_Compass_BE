# ğŸ“ Review, Media & System Monitoring Domains ERD - ì¡°ë¯¼ê·€

## ğŸ“‹ ë‹´ë‹¹ ë„ë©”ì¸
1. Review System Domain: ë¦¬ë·° ê´€ë¦¬, í‰ì , ëŒ“ê¸€
2. Media Management Domain: ì´ë¯¸ì§€/ë™ì˜ìƒ ê´€ë¦¬, ìŠ¤í† ë¦¬ì§€
3. System Monitoring Domain: ë¡œê¹…, ëª¨ë‹ˆí„°ë§, ë¶„ì„

---

# Domain 1: Review System

## ğŸ“Š Entities

### ë¦¬ë·°
```sql
Review {
    review_id: UUID (PK)
    user_id: UUID (FK â†’ User Management Domain)
    reviewable_type: ENUM('trip', 'place', 'restaurant', 'accommodation')
    reviewable_id: UUID
    rating: INT (1-5)
    title: VARCHAR(255)
    content: TEXT
    pros: TEXT
    cons: TEXT
    visit_date: DATE
    helpful_count: INT DEFAULT 0
    report_count: INT DEFAULT 0
    status: ENUM('active', 'hidden', 'deleted')
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### ë¦¬ë·° ì´ë¯¸ì§€
```sql
ReviewImage {
    image_id: UUID (PK)
    review_id: UUID (FK â†’ Review)
    media_id: UUID (FK â†’ Media Management Domain)
    caption: VARCHAR(500)
    order_index: INT
    created_at: TIMESTAMP
}
```

### ë¦¬ë·° í‰ê°€
```sql
ReviewRating {
    rating_id: UUID (PK)
    review_id: UUID (FK â†’ Review)
    user_id: UUID (FK â†’ User Management Domain)
    is_helpful: BOOLEAN
    created_at: TIMESTAMP
    UNIQUE KEY (review_id, user_id)
}
```

### ë¦¬ë·° ëŒ“ê¸€
```sql
ReviewComment {
    comment_id: UUID (PK)
    review_id: UUID (FK â†’ Review)
    user_id: UUID (FK â†’ User Management Domain)
    parent_comment_id: UUID (FK â†’ ReviewComment)
    content: TEXT
    status: ENUM('active', 'hidden', 'deleted')
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### ë¦¬ë·° ì‹ ê³ 
```sql
ReviewReport {
    report_id: UUID (PK)
    review_id: UUID (FK â†’ Review)
    reporter_id: UUID (FK â†’ User Management Domain)
    reason: ENUM('spam', 'inappropriate', 'fake', 'offensive', 'other')
    description: TEXT
    status: ENUM('pending', 'reviewed', 'resolved', 'dismissed')
    reviewed_by: UUID (FK â†’ User Management Domain)
    resolved_at: TIMESTAMP
    created_at: TIMESTAMP
}
```

### ë¦¬ë·° í†µê³„
```sql
ReviewStatistics {
    stat_id: UUID (PK)
    reviewable_type: VARCHAR(50)
    reviewable_id: UUID
    total_reviews: INT DEFAULT 0
    average_rating: DECIMAL(2,1)
    rating_distribution: JSON
    updated_at: TIMESTAMP
}
```

## ğŸ”µ External APIs (Review System Domain)

### Review Management
```yaml
GET /api/reviews:
  Description: "ë¦¬ë·° ëª©ë¡ ì¡°íšŒ"
  Query: page, size, type?, rating?, sort?
  Response: ReviewListResponse
  
GET /api/reviews/{reviewId}:
  Description: "ë¦¬ë·° ìƒì„¸ ì¡°íšŒ"
  Response: ReviewDetailResponse
  
POST /api/reviews:
  Description: "ë¦¬ë·° ì‘ì„±"
  Body: { reviewable_type, reviewable_id, rating, title, content, pros?, cons? }
  Response: ReviewResponse
  
PUT /api/reviews/{reviewId}:
  Description: "ë¦¬ë·° ìˆ˜ì •"
  Body: { rating?, title?, content?, pros?, cons? }
  Response: ReviewResponse
  
DELETE /api/reviews/{reviewId}:
  Description: "ë¦¬ë·° ì‚­ì œ"
  Response: 204 No Content
  
POST /api/reviews/{reviewId}/helpful:
  Description: "ë„ì›€ì´ ë¨ í‘œì‹œ"
  Body: { is_helpful }
  Response: HelpfulResponse
```

### Review Comments
```yaml
GET /api/reviews/{reviewId}/comments:
  Description: "ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ"
  Query: page, size
  Response: CommentListResponse
  
POST /api/reviews/{reviewId}/comments:
  Description: "ëŒ“ê¸€ ì‘ì„±"
  Body: { content, parent_comment_id? }
  Response: CommentResponse
  
PUT /api/comments/{commentId}:
  Description: "ëŒ“ê¸€ ìˆ˜ì •"
  Body: { content }
  Response: CommentResponse
  
DELETE /api/comments/{commentId}:
  Description: "ëŒ“ê¸€ ì‚­ì œ"
  Response: 204 No Content
```

### Review Statistics
```yaml
GET /api/reviews/stats/{type}/{id}:
  Description: "ë¦¬ë·° í†µê³„ ì¡°íšŒ"
  Response: ReviewStatisticsResponse
  
GET /api/reviews/place/{placeId}:
  Description: "ì¥ì†Œ ë¦¬ë·° ì¡°íšŒ"
  Query: page, size, sort?
  Response: PlaceReviewsResponse
  
GET /api/reviews/trip/{tripId}:
  Description: "ì—¬í–‰ ë¦¬ë·° ì¡°íšŒ"
  Query: page, size, sort?
  Response: TripReviewsResponse
  
GET /api/reviews/user/{userId}:
  Description: "ì‚¬ìš©ì ë¦¬ë·° ì¡°íšŒ"
  Query: page, size
  Response: UserReviewsResponse
```

### Review Reporting
```yaml
POST /api/reviews/{reviewId}/report:
  Description: "ë¦¬ë·° ì‹ ê³ "
  Body: { reason, description? }
  Response: ReportResponse
  
GET /api/admin/reports:
  Description: "ì‹ ê³  ëª©ë¡ (ê´€ë¦¬ì)"
  Query: page, size, status?
  Response: ReportListResponse
  
PUT /api/admin/reports/{reportId}:
  Description: "ì‹ ê³  ì²˜ë¦¬ (ê´€ë¦¬ì)"
  Body: { status, resolution? }
  Response: ReportUpdateResponse
```

## ğŸ”´ Internal APIs (Review System Domain)

```yaml
GET /api/internal/reviews/validate:
  Description: "ë¦¬ë·° ìœ íš¨ì„± ê²€ì¦"
  Query: review_id, user_id
  
POST /api/internal/reviews/stats/update:
  Description: "í†µê³„ ì—…ë°ì´íŠ¸"
  Body: { reviewable_type, reviewable_id }
  
GET /api/internal/users/{userId}/rating:
  Description: "ì‚¬ìš©ì í‰ì  ì¡°íšŒ"
  Response: UserRatingResponse
  
POST /api/internal/reviews/cleanup:
  Description: "ì‚­ì œëœ ë¦¬ë·° ì •ë¦¬"
```

---

# Domain 2: Media Management

## ğŸ“Š Entities

### ë¯¸ë””ì–´ íŒŒì¼
```sql
Media {
    media_id: UUID (PK)
    uploaded_by: UUID (FK â†’ User Management Domain)
    file_type: ENUM('image', 'video', 'document')
    mime_type: VARCHAR(100)
    file_name: VARCHAR(255)
    file_size: BIGINT
    storage_path: VARCHAR(500)
    storage_provider: VARCHAR(50)
    cdn_url: VARCHAR(500)
    thumbnail_url: VARCHAR(500)
    width: INT
    height: INT
    duration: INT (for videos)
    metadata: JSON
    is_public: BOOLEAN DEFAULT true
    created_at: TIMESTAMP
}
```

### ë¯¸ë””ì–´ íƒœê·¸
```sql
MediaTag {
    tag_id: UUID (PK)
    media_id: UUID (FK â†’ Media)
    tag_name: VARCHAR(50)
    created_at: TIMESTAMP
}
```

### ë¯¸ë””ì–´ ì²˜ë¦¬ í
```sql
MediaProcessingQueue {
    queue_id: UUID (PK)
    media_id: UUID (FK â†’ Media)
    operation: VARCHAR(50)
    parameters: JSON
    status: ENUM('pending', 'processing', 'completed', 'failed')
    attempts: INT DEFAULT 0
    error_message: TEXT
    created_at: TIMESTAMP
    processed_at: TIMESTAMP
}
```

### ë¯¸ë””ì–´ ë²„ì „
```sql
MediaVersion {
    version_id: UUID (PK)
    original_media_id: UUID (FK â†’ Media)
    version_type: VARCHAR(50)
    file_path: VARCHAR(500)
    cdn_url: VARCHAR(500)
    width: INT
    height: INT
    file_size: BIGINT
    created_at: TIMESTAMP
}
```

### ë¯¸ë””ì–´ ì‚¬ìš© ê¸°ë¡
```sql
MediaUsage {
    usage_id: UUID (PK)
    media_id: UUID (FK â†’ Media)
    used_in_type: VARCHAR(50)
    used_in_id: UUID
    created_at: TIMESTAMP
}
```

## ğŸ”µ External APIs (Media Management Domain)

### Media Upload & Management
```yaml
POST /api/media/upload:
  Description: "ë¯¸ë””ì–´ ì—…ë¡œë“œ"
  Body: MultipartFile
  Response: MediaUploadResponse
  
POST /api/media/upload-multiple:
  Description: "ë‹¤ì¤‘ ë¯¸ë””ì–´ ì—…ë¡œë“œ"
  Body: MultipartFile[]
  Response: MediaUploadMultipleResponse
  
GET /api/media/{mediaId}:
  Description: "ë¯¸ë””ì–´ ì¡°íšŒ"
  Response: MediaResponse
  
PUT /api/media/{mediaId}:
  Description: "ë¯¸ë””ì–´ ë©”íƒ€ë°ì´í„° ìˆ˜ì •"
  Body: { file_name?, tags?, is_public? }
  Response: MediaResponse
  
DELETE /api/media/{mediaId}:
  Description: "ë¯¸ë””ì–´ ì‚­ì œ"
  Response: 204 No Content
```

### Media Processing
```yaml
POST /api/media/{mediaId}/resize:
  Description: "ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•"
  Body: { width?, height?, maintain_ratio? }
  Response: MediaProcessingResponse
  
POST /api/media/{mediaId}/compress:
  Description: "ë¯¸ë””ì–´ ì••ì¶•"
  Body: { quality?, format? }
  Response: MediaProcessingResponse
  
POST /api/media/{mediaId}/thumbnail:
  Description: "ì¸ë„¤ì¼ ìƒì„±"
  Body: { width?, height? }
  Response: ThumbnailResponse
  
GET /api/media/{mediaId}/versions:
  Description: "ë¯¸ë””ì–´ ë²„ì „ ëª©ë¡"
  Response: MediaVersionListResponse
```

### Media Query
```yaml
GET /api/media/user/{userId}:
  Description: "ì‚¬ìš©ì ë¯¸ë””ì–´ ì¡°íšŒ"
  Query: page, size, type?
  Response: UserMediaListResponse
  
GET /api/media/trip/{tripId}:
  Description: "ì—¬í–‰ ë¯¸ë””ì–´ ì¡°íšŒ"
  Query: page, size, type?
  Response: TripMediaListResponse
  
POST /api/media/search:
  Description: "ë¯¸ë””ì–´ ê²€ìƒ‰"
  Body: { tags?, type?, uploaded_after?, uploaded_before? }
  Response: MediaSearchResponse
```

## ğŸ”´ Internal APIs (Media Management Domain)

```yaml
POST /api/internal/media/process:
  Description: "ë¯¸ë””ì–´ ì²˜ë¦¬ ì‘ì—…"
  Body: { media_id, operation, parameters }
  
GET /api/internal/media/storage-stats:
  Description: "ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ í†µê³„"
  Response: StorageStatsResponse
  
POST /api/internal/media/cleanup:
  Description: "ë¯¸ì‚¬ìš© ë¯¸ë””ì–´ ì •ë¦¬"
  Body: { older_than_days }
  
POST /api/internal/media/cdn-sync:
  Description: "CDN ë™ê¸°í™”"
  Body: { media_ids[] }
```

---

# Domain 3: System Monitoring

## ğŸ“Š Entities

### ì‹œìŠ¤í…œ ë¡œê·¸
```sql
SystemLog {
    log_id: UUID (PK)
    service_name: VARCHAR(100)
    log_level: ENUM('DEBUG', 'INFO', 'WARN', 'ERROR', 'CRITICAL')
    message: TEXT
    context: JSON
    stack_trace: TEXT
    created_at: TIMESTAMP (with index)
}
```

### API ë©”íŠ¸ë¦­
```sql
APIMetric {
    metric_id: UUID (PK)
    endpoint: VARCHAR(500)
    method: VARCHAR(10)
    response_time: INT
    status_code: INT
    user_id: UUID
    ip_address: VARCHAR(50)
    user_agent: VARCHAR(500)
    created_at: TIMESTAMP (with index)
}
```

### ì—ëŸ¬ ì¶”ì 
```sql
ErrorTracking {
    error_id: UUID (PK)
    error_type: VARCHAR(255)
    error_message: TEXT
    stack_trace: TEXT
    service_name: VARCHAR(100)
    environment: VARCHAR(50)
    occurrence_count: INT DEFAULT 1
    first_seen: TIMESTAMP
    last_seen: TIMESTAMP
    resolved: BOOLEAN DEFAULT false
}
```

### ì‹œìŠ¤í…œ ìƒíƒœ
```sql
SystemHealth {
    health_id: UUID (PK)
    service_name: VARCHAR(100)
    status: ENUM('healthy', 'degraded', 'unhealthy')
    cpu_usage: DECIMAL(5,2)
    memory_usage: DECIMAL(5,2)
    disk_usage: DECIMAL(5,2)
    response_time_avg: INT
    error_rate: DECIMAL(5,2)
    checked_at: TIMESTAMP
}
```

### ì‚¬ìš©ì í™œë™ ë¡œê·¸
```sql
ActivityLog {
    activity_id: UUID (PK)
    user_id: UUID
    action: VARCHAR(100)
    resource_type: VARCHAR(50)
    resource_id: VARCHAR(255)
    metadata: JSON
    ip_address: VARCHAR(50)
    created_at: TIMESTAMP (with index)
}
```

### ì•Œë¦¼ ì„¤ì •
```sql
AlertConfiguration {
    alert_id: UUID (PK)
    alert_type: VARCHAR(50)
    threshold: JSON
    notification_channels: JSON
    is_active: BOOLEAN DEFAULT true
    created_at: TIMESTAMP
}
```

## ğŸ”µ External APIs (System Monitoring Domain)

### Monitoring & Health
```yaml
GET /api/monitoring/health:
  Description: "ì‹œìŠ¤í…œ ìƒíƒœ ì¡°íšŒ"
  Response: SystemHealthResponse
  
GET /api/monitoring/metrics:
  Description: "ë©”íŠ¸ë¦­ ì¡°íšŒ"
  Query: service?, period?, metric_type?
  Response: MetricsResponse
  
GET /api/monitoring/services:
  Description: "ì„œë¹„ìŠ¤ ìƒíƒœ ëª©ë¡"
  Response: ServiceStatusListResponse
```

### Logging & Analytics
```yaml
POST /api/logs/query:
  Description: "ë¡œê·¸ ê²€ìƒ‰"
  Body: { service?, level?, start_time?, end_time?, search? }
  Response: LogQueryResponse
  
GET /api/analytics/dashboard:
  Description: "ë¶„ì„ ëŒ€ì‹œë³´ë“œ"
  Query: period?
  Response: DashboardResponse
  
GET /api/analytics/activity:
  Description: "í™œë™ ë¶„ì„"
  Query: user_id?, resource_type?, period?
  Response: ActivityAnalyticsResponse
```

### Error Management
```yaml
GET /api/errors:
  Description: "ì—ëŸ¬ ëª©ë¡"
  Query: page, size, resolved?, service?
  Response: ErrorListResponse
  
GET /api/errors/{errorId}:
  Description: "ì—ëŸ¬ ìƒì„¸"
  Response: ErrorDetailResponse
  
PUT /api/errors/{errorId}/resolve:
  Description: "ì—ëŸ¬ í•´ê²° ì²˜ë¦¬"
  Response: ErrorResolveResponse
```

### Alert Management
```yaml
GET /api/alerts/configurations:
  Description: "ì•Œë¦¼ ì„¤ì • ëª©ë¡"
  Response: AlertConfigurationListResponse
  
POST /api/alerts/configure:
  Description: "ì•Œë¦¼ ì„¤ì • ìƒì„±"
  Body: { alert_type, threshold, notification_channels }
  Response: AlertConfigurationResponse
  
PUT /api/alerts/{alertId}:
  Description: "ì•Œë¦¼ ì„¤ì • ìˆ˜ì •"
  Body: { threshold?, notification_channels?, is_active? }
  Response: AlertConfigurationResponse
```

## ğŸ”´ Internal APIs (System Monitoring Domain)

```yaml
POST /api/internal/logs/ingest:
  Description: "ë¡œê·¸ ìˆ˜ì§‘"
  Body: { service_name, level, message, context }
  
POST /api/internal/metrics/record:
  Description: "ë©”íŠ¸ë¦­ ê¸°ë¡"
  Body: { endpoint, method, response_time, status_code }
  
POST /api/internal/activity/track:
  Description: "í™œë™ ì¶”ì "
  Body: { user_id, action, resource_type, resource_id }
  
POST /api/internal/health/check:
  Description: "í—¬ìŠ¤ ì²´í¬"
  Body: { service_name }
  
POST /api/internal/alerts/trigger:
  Description: "ì•Œë¦¼ íŠ¸ë¦¬ê±°"
  Body: { alert_type, data }
```

---

## ğŸ”— ì™¸ë¶€ ë„ë©”ì¸ ì˜ì¡´ì„±

### í•„ìš”í•œ ì™¸ë¶€ API
```yaml
User Management Domain:
  - GET /api/users/{userId}: "ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"
  - GET /api/internal/users/validate: "ì‚¬ìš©ì ìœ íš¨ì„± ê²€ì¦"
  
Trip Planning Domain:
  - GET /api/trips/{tripId}: "ì—¬í–‰ ì •ë³´ ì¡°íšŒ"
  - GET /api/places/{placeId}: "ì¥ì†Œ ì •ë³´ ì¡°íšŒ"
  
AI Client Domain:
  - GET /api/chat/usage: "AI ì‚¬ìš©ëŸ‰ ì¡°íšŒ"
  
All Domains:
  - POST /api/internal/logs/ingest: "ë¡œê·¸ ìˆ˜ì§‘ (ëª¨ë“  ë„ë©”ì¸ì—ì„œ í˜¸ì¶œ)"
  - POST /api/internal/metrics/record: "ë©”íŠ¸ë¦­ ê¸°ë¡ (ëª¨ë“  ë„ë©”ì¸ì—ì„œ í˜¸ì¶œ)"
```

---

## ğŸ’¡ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### Review System Domain
1. **ë¦¬ë·° ì‘ì„± í”Œë¡œìš°**: ìœ íš¨ì„± ê²€ì¦ â†’ ë¦¬ë·° ì €ì¥ â†’ í‰ì  ê³„ì‚° â†’ í†µê³„ ì—…ë°ì´íŠ¸
2. **ë„ì›€ì´ ë¨ ì‹œìŠ¤í…œ**: íˆ¬í‘œ ìˆ˜ì§‘ â†’ ê°€ì¤‘ì¹˜ ê³„ì‚° â†’ ì •ë ¬ ë°˜ì˜
3. **ì‹ ê³  ì²˜ë¦¬**: ì‹ ê³  ì ‘ìˆ˜ â†’ ê´€ë¦¬ì ê²€í†  â†’ ì¡°ì¹˜ ê²°ì • â†’ ìƒíƒœ ì—…ë°ì´íŠ¸

### Media Management Domain
1. **ì—…ë¡œë“œ í”Œë¡œìš°**: íŒŒì¼ ê²€ì¦ â†’ ìŠ¤í† ë¦¬ì§€ ì €ì¥ â†’ CDN ì—…ë¡œë“œ â†’ ì¸ë„¤ì¼ ìƒì„±
2. **ì´ë¯¸ì§€ ì²˜ë¦¬**: í ë“±ë¡ â†’ ë¹„ë™ê¸° ì²˜ë¦¬ â†’ ë²„ì „ ìƒì„± â†’ CDN ë™ê¸°í™”
3. **ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬**: ì‚¬ìš©ëŸ‰ ì¶”ì  â†’ ë¯¸ì‚¬ìš© íŒŒì¼ íƒì§€ â†’ ìë™ ì •ë¦¬

### System Monitoring Domain
1. **ë¡œê·¸ ìˆ˜ì§‘**: ì„œë¹„ìŠ¤ ë¡œê·¸ â†’ ì¤‘ì•™ ì§‘ì¤‘í™” â†’ ì¸ë±ì‹± â†’ ë¶„ì„
2. **ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: API í˜¸ì¶œ â†’ ì‘ë‹µ ì‹œê°„ ì¸¡ì • â†’ í†µê³„ ì§‘ê³„ â†’ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
3. **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ì„ê³„ì¹˜ ëª¨ë‹ˆí„°ë§ â†’ ì¡°ê±´ ì¶©ì¡± â†’ ì•Œë¦¼ ë°œì†¡ â†’ ì—ìŠ¤ì»¬ë ˆì´ì…˜
4. **í—¬ìŠ¤ ì²´í¬**: ì •ê¸°ì  ìƒíƒœ í™•ì¸ â†’ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ â†’ ì´ìƒ ê°ì§€ â†’ ìë™ ë³µêµ¬

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- ë¦¬ë·° ì‘ì„±ì ê²€ì¦
- ë¯¸ë””ì–´ ì—…ë¡œë“œ íŒŒì¼ ê²€ì¦
- CDN ì ‘ê·¼ ì œì–´
- ë¡œê·¸ ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹
- API Rate Limiting
- XSS/SQL Injection ë°©ì–´
- íŒŒì¼ ì—…ë¡œë“œ í¬ê¸° ì œí•œ
- ì•…ì„± íŒŒì¼ ìŠ¤ìº”