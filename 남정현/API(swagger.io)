openapi: 3.0.3
info:
  title: "AI ì—¬í–‰ í”Œë˜ë„ˆ API (BE-3 íŒŒíŠ¸)"
  description: |
    BE-3 íŒŒíŠ¸ì—ì„œ ë‹´ë‹¹í•˜ëŠ” ê²°ì œ, ê³µìœ , ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥ì— ëŒ€í•œ API ëª…ì„¸ì„œì…ë‹ˆë‹¤.
    
    **ì¸ì¦**: ëª¨ë“  APIëŠ” Bearer Token (JWT) ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. 
    ìš”ì²­ í—¤ë”ì— `Authorization: Bearer {token}`ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

    **ì‹¤ì‹œê°„ ì•Œë¦¼ (WebSocket)**:
    - **Endpoint**: `wss://api.yourdomain.com/ws`
    - **í”„ë¡œí† ì½œ**: STOMP over WebSocket
    - **êµ¬ë… ê²½ë¡œ**: `/user/queue/notifications`
    - **ì„¤ëª…**: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í›„ WebSocketì— ì—°ê²°í•˜ê³  ìœ„ ê²½ë¡œë¥¼ êµ¬ë…í•˜ë©´, ìƒˆë¡œìš´ ì•Œë¦¼ ë°œìƒ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
  version: "1.0.0"

servers:
  - url: "https://api.yourdomain.com/v1"
    description: "Production Server"

tags:
  - name: "ğŸ’³ Payment & Credit"
    description: "ê²°ì œ ë° í¬ë ˆë”§ ê´€ë ¨ API"
  - name: "ğŸ”— Sharing"
    description: "ì—¬í–‰ ê³„íš ê³µìœ  ê´€ë ¨ API"
  - name: "ğŸ”” Notifications"
    description: "ì‚¬ìš©ì ì•Œë¦¼ ê´€ë ¨ API"

paths:
  # =================== Payment & Credit ===================
  /credits/products:
    get:
      tags:
        - "ğŸ’³ Payment & Credit"
      summary: "í¬ë ˆë”§ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ"
      description: "ì‚¬ìš©ìê°€ êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“  í™œì„±í™”ëœ í¬ë ˆë”§ ìƒí’ˆ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤."
      security:
        - BearerAuth: []
      responses:
        '200':
          description: "ì„±ê³µì ìœ¼ë¡œ ìƒí’ˆ ëª©ë¡ì„ ì¡°íšŒí•¨"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CreditProduct'

  /payments/prepare:
    post:
      tags:
        - "ğŸ’³ Payment & Credit"
      summary: "ê²°ì œ ì¤€ë¹„ (ì¹´ì¹´ì˜¤í˜ì´)"
      description: "ì„ íƒí•œ ìƒí’ˆì— ëŒ€í•œ ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œë¥¼ ì¤€ë¹„í•˜ê³ , ê²°ì œ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜í•  URLì„ ë°›ìŠµë‹ˆë‹¤."
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                product_id:
                  type: string
                  format: uuid
                  example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
      responses:
        '200':
          description: "ê²°ì œ ì¤€ë¹„ ì„±ê³µ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  redirect_url:
                    type: string
                    format: uri
                    example: "https://pg-web.kakao.com/v/..."

  /payments/history:
    get:
      tags:
        - "ğŸ’³ Payment & Credit"
      summary: "ë‚´ ê²°ì œ ë‚´ì—­ ì¡°íšŒ"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: "ê²°ì œ ë‚´ì—­ ì¡°íšŒ ì„±ê³µ"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Payment'

  /credits/transactions:
    get:
      tags:
        - "ğŸ’³ Payment & Credit"
      summary: "ë‚´ í¬ë ˆë”§ ì‚¬ìš©/ì¶©ì „ ë‚´ì—­ ì¡°íšŒ"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: "í¬ë ˆë”§ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ ì„±ê³µ"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CreditTransaction'

  # =================== Sharing ===================
  /share/links:
    post:
      tags:
        - "ğŸ”— Sharing"
      summary: "ì—¬í–‰ ê³„íš ê³µìœ  ë§í¬ ìƒì„±"
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                plan_id:
                  type: string
                  format: uuid
                  description: "ê³µìœ í•  ì—¬í–‰ ê³„íšì˜ ID"
                expires_at:
                  type: string
                  format: date-time
                  description: "ë§Œë£Œì¼ (ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ì˜êµ¬)"
      responses:
        '201':
          description: "ê³µìœ  ë§í¬ ìƒì„± ì„±ê³µ"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShareLink'

  /share/links/{link_id}:
    delete:
      tags:
        - "ğŸ”— Sharing"
      summary: "ê³µìœ  ë§í¬ ë¹„í™œì„±í™”"
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: link_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: "ì„±ê³µì ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨"

  # =================== Notifications ===================
  /notifications:
    get:
      tags:
        - "ğŸ”” Notifications"
      summary: "ë‚´ ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: "ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ ì„±ê³µ"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'

  /notifications/settings:
    put:
      tags:
        - "ğŸ”” Notifications"
      summary: "ì•Œë¦¼ ì„¤ì • ìˆ˜ì •"
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email_enabled:
                  type: boolean
                push_enabled:
                  type: boolean
      responses:
        '200':
          description: "ì„¤ì • ë³€ê²½ ì„±ê³µ"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CreditProduct:
      type: object
      properties:
        product_id:
          type: string
          format: uuid
        product_name:
          type: string
        price:
          type: number
        credit_amount:
          type: integer

    Payment:
      type: object
      properties:
        payment_id:
          type: string
          format: uuid
        product_name:
          type: string
        amount:
          type: number
        status:
          type: string
          enum: [completed, failed, pending]
        created_at:
          type: string
          format: date-time

    CreditTransaction:
      type: object
      properties:
        transaction_id:
          type: string
          format: uuid
        transaction_type:
          type: string
          enum: [charge, usage]
        amount:
          type: integer
        description:
          type: string
        created_at:
          type: string
          format: date-time

    ShareLink:
      type: object
      properties:
        link_id:
          type: string
          format: uuid
        plan_id:
          type: string
          format: uuid
        share_token:
          type: string
          description: "ì‹¤ì œ ê³µìœ ì— ì‚¬ìš©ë  ê³ ìœ  í† í° ê°’"
        share_url:
          type: string
          format: uri
          description: "ì™„ì„±ëœ ê³µìœ  URL"
        is_active:
          type: boolean
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    Notification:
      type: object
      properties:
        notification_id:
          type: string
          format: uuid
        type:
          type: string
          example: "weather_alert"
        content:
          type: string
        is_read:
          type: boolean
        created_at:
          type: string
          format: date-time
