# 프로젝트 코드 컨벤션 전체 가이드

## 🎯 핵심 철학
- **AI 코딩 흔적 제거**: 인간이 작성한 것처럼 자연스럽고 점진적인 코드
- **일관성 유지**: 팀 전체가 동일한 스타일로 작성
- **클린코드 원칙**: 읽기 쉽고, 수정하기 쉽고, 테스트하기 쉬운 코드

## 📋 요구사항 세분화 규칙

### 계층 구조
```
Epic (2-4주) → Feature (3-5일) → User Story (1-2일) → Task (2-4시간) → Sub-task (30분-2시간)
```

### PR 규칙
- **최대 300줄**: 실제 로직 ~150줄 + 테스트 ~100줄 + 설정/문서 ~50줄
- **단일 책임**: 한 PR = 한 가지 기능/수정
- **독립성**: 개별 테스트 및 롤백 가능

### SMART 원칙
- **S**pecific: 구체적이고 명확한 정의
- **M**easurable: 완료 기준이 측정 가능
- **A**chievable: 현실적으로 달성 가능
- **R**elevant: 프로젝트 목표와 연관
- **T**ime-bound: 시간 제한 존재

## ✅ Java 17 & Lombok 필수 사용

### 1. DTO → Record 사용
```java
// DTO는 무조건 Record
public record TravelRequest(
    String destination,
    LocalDate startDate,
    LocalDate endDate,
    Integer budget
) {}

// 검증 로직 포함 가능
public record TravelInfoDto(
    String destination,
    LocalDate startDate,
    LocalDate endDate
) {
    public TravelInfoDto {
        if (startDate.isAfter(endDate)) {
            throw new IllegalArgumentException("시작일이 종료일보다 늦음");
        }
    }
}
```

### 2. Entity → Lombok 사용
```java
@Entity
@Table(name = "travels")
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Travel {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String destination;

    private LocalDate startDate;
    private LocalDate endDate;
    private Integer budget;

    @Enumerated(EnumType.STRING)
    private TravelStatus status;
}
```

### 3. Service → @RequiredArgsConstructor
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class TravelService {

    private final TravelRepository travelRepository;
    private final TravelValidator validator;

    // 여행 생성
    public TravelResponse createTravel(TravelRequest request) {
        validator.validate(request);

        var travel = Travel.builder()
            .destination(request.destination())
            .startDate(request.startDate())
            .endDate(request.endDate())
            .budget(request.budget())
            .status(TravelStatus.PLANNED)
            .build();

        var saved = travelRepository.save(travel);
        return toResponse(saved);
    }
}
```

### 4. Controller 구조
```java
@RestController
@RequestMapping("/api/travels")
@RequiredArgsConstructor
@Slf4j
public class TravelController {

    private final TravelService travelService;

    @PostMapping
    public ResponseEntity<TravelResponse> createTravel(
            @RequestBody @Valid TravelRequest request) {
        var response = travelService.createTravel(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }
}
```

## 📝 주석 스타일 가이드

### ✅ // 주석만 사용 (한국어, 간결)
```java
// 여행 서비스
@Service
public class TravelService {

    // 여행 정보 처리
    public TravelResponse processTravel(TravelRequest request) {
        // 요청 검증
        validateRequest(request);

        // 날짜 체크
        if (request.startDate().isAfter(request.endDate())) {
            throw new InvalidDateException("시작일이 종료일보다 늦음");
        }

        // 예산 계산: 1인당 * 인원수
        int total = perPerson * count;

        return response;
    }

    // 메서드명이 명확하면 주석 생략
    public String getDestination() {
        return destination;
    }
}
```

### ❌ 금지된 주석 스타일
```java
/**
 * JavaDoc 스타일 금지
 */
/* 블록 주석 금지 */
// This is prohibited (영어 주석 금지)
// 불필요하게 긴 설명 주석 금지
```

## 🔧 Java 17 기능 활용

### 1. var 사용 (타입 명확할 때만)
```java
// ✅ 좋은 예
var travelList = new ArrayList<Travel>();
var response = travelService.findById(id);

// ❌ 나쁜 예
var data = process();  // 타입 불명확
```

### 2. Switch Expression
```java
public String getTravelType(String category) {
    return switch (category) {
        case "BUDGET" -> "경제적 여행";
        case "LUXURY" -> "럭셔리 여행";
        default -> "일반 여행";
    };
}
```

### 3. Text Blocks (SQL, JSON)
```java
String sql = """
    SELECT * FROM travel
    WHERE user_id = ?
    AND status = 'ACTIVE'
    """;
```

### 4. 불변 컬렉션
```java
List<String> cities = List.of("서울", "부산", "제주");
Map<String, Integer> prices = Map.of(
    "서울", 100000,
    "부산", 150000
);
```

## 📏 코드 작성 규칙

### 메서드 규칙
- **최대 20줄** (이상적으로 10줄)
- **단일 책임**: 한 메서드 = 한 가지 일
- **명확한 네이밍**: 동사 + 명사

### 클래스 규칙
- **최대 200줄**
- **단일 책임 원칙**
- **관련 기능만 포함**

### 네이밍 컨벤션
```java
// 클래스: PascalCase
public class TravelService {}

// 메서드: camelCase
public TravelDto findById(Long id) {}

// 상수: UPPER_SNAKE_CASE
private static final int MAX_RETRY_COUNT = 3;

// 패키지: lowercase
package com.compass.travel;
```

## 🚫 금지 사항
1. **getter/setter 직접 작성 금지** → Lombok 사용
2. **생성자 직접 작성 금지** → @RequiredArgsConstructor, @Builder
3. **한 번에 전체 CRUD 구현 금지** → 점진적 구현
4. **/* */ /** */ 주석 금지** → // 만 사용
5. **영어 주석 금지** → 한국어만
6. **불필요한 주석 금지** → 코드로 의도 표현
7. **300줄 넘는 PR 금지** → 작은 단위로 분할
8. **TODO 남발 금지** → 필요시만 최소한

## 📝 AI 코드 생성 프로토콜

### 생성 전 필수 체크
1. **코드베이스 전체 분석**
   - 기존 패턴 파악
   - 네이밍 컨벤션 확인
   - 의존성 관계 이해

2. **작성 단위**
   - 한 번에 150-200줄
   - 단일 기능만 구현

3. **필수 설명**
   ```markdown
   ## 작성 코드 정보
   - **위치**: src/main/java/com/compass/...
   - **목적**: [구체적 기능]
   - **의존성**: [사용하는 컴포넌트]
   - **사용처**: [이 코드를 사용할 곳]
   - **영향범위**: [변경 영향]
   ```

## 🔍 최종 체크리스트

```yaml
Java 17 & Lombok:
  ✓ DTO는 Record 사용
  ✓ Entity는 Lombok 사용
  ✓ Service는 @RequiredArgsConstructor
  ✓ var는 타입 명확할 때만
  ✓ Switch Expression 활용
  ✓ Text Block 활용 (SQL, JSON)

코드 품질:
  ✓ 메서드 20줄 이내
  ✓ 클래스 200줄 이내
  ✓ PR 300줄 이내
  ✓ 단일 책임 원칙
  ✓ Optional 활용

주석 규칙:
  ✓ // 주석만 사용
  ✓ 한국어로 간결하게
  ✓ 불필요한 주석 제거
  ✓ 코드가 명확하면 주석 생략

일관성:
  ✓ 기존 코드 패턴 준수
  ✓ 팀 네이밍 컨벤션 준수
  ✓ 점진적 개선 (완벽한 첫 구현 X)
```

## 💡 핵심 기억사항
- **인간적인 코드**: AI가 생성했다는 흔적이 없는 자연스러운 코드
- **작은 단위 작업**: 한 번에 하나씩, 명확한 목적
- **팀 일관성**: 모든 팀원이 동일한 스타일
- **지속적 개선**: 첫 구현은 단순하게, 점진적으로 개선

## 실제 적용 예시

```
Epic: 여행 계획 추천 시스템
├── Feature: 사용자 정보 수집
│   ├── User Story: 여행 목적지 입력
│   │   ├── PR #1: Domain 모델 구현 (~150줄)
│   │   │   ├── TravelDestination Entity
│   │   │   └── 도메인 검증 로직
│   │   ├── PR #2: Service 계층 (~200줄)
│   │   │   ├── DestinationService
│   │   │   └── 비즈니스 로직 + 테스트
│   │   └── PR #3: API 엔드포인트 (~250줄)
│   │       ├── Controller
│   │       ├── DTO (Record)
│   │       └── 통합 테스트
│   └── User Story: 여행 일정 선택
└── Feature: AI 추천 생성
```