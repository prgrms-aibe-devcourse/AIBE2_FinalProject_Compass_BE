openapi: 3.0.3
info:
  title: Recommendation & Admin Domain API - Compass Travel
  description: |
    # Recommendation & Admin ë„ë©”ì¸ API ëª…ì„¸ì„œ (v2.0)
    
    ## ğŸ“‹ ë„ë©”ì¸ êµ¬ì„± ìš”ì•½
    
    ### ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤
    - **í•µì‹¬ API (Core)**: ì¶”ì²œ, íŠ¸ë Œë“œ, íë ˆì´ì…˜ ë° ê´€ë¦¬ ê¸°ëŠ¥ ì œê³µ
    - **ì›¹í›… (Webhooks)**: ì™¸ë¶€ ë°ì´í„° íŒŒì´í”„ë¼ì¸ìœ¼ë¡œë¶€í„° ì´ë²¤íŠ¸ ìˆ˜ì‹ 
    
    ## ğŸ“Š ë„ë©”ì¸ ê°„ ìƒí˜¸ì‘ìš©
    
    | ë„ë©”ì¸ | Reco/Admin â†’ ì™¸ë¶€ (ìš”ì²­) | ì™¸ë¶€ â†’ Reco/Admin (í˜¸ì¶œ) | ì£¼ìš” ìš©ë„ |
    |---|---|---|---|
    | **User** | â€¢ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ | - | ê°œì¸í™” ì¶”ì²œ, ê´€ë¦¬ì ê°ì‚¬ ë¡œê·¸ |
    | **Data Pipeline** | - | â€¢ ì‚¬ìš©ì í™œë™ ì—…ë°ì´íŠ¸ ì›¹í›… | ì¶”ì²œ ëª¨ë¸ ë°ì´í„° ìµœì‹ í™” |
  version: 2.0.0

servers:
  - url: https://api.compass.com/v1
    description: Production Server
  - url: http://localhost:8081/v1
    description: Development Server

tags:
  - name: Recommendation - Core
    description: ì¶”ì²œ ë° íë ˆì´ì…˜ API (ì‚¬ìš©ì ëŒ€ìƒ)
  - name: Admin - Core
    description: ê´€ë¦¬ ê¸°ëŠ¥ API (ê´€ë¦¬ì ëŒ€ìƒ)
  - name: RecoAdmin - Webhooks
    description: ì™¸ë¶€ ì‹œìŠ¤í…œìœ¼ë¡œë¶€í„° í˜¸ì¶œë°›ëŠ” Webhook
  - name: External - User Domain
    description: User ë„ë©”ì¸ ì˜ì¡´ì„±

paths:
  # ============================================
  # == 1. Core APIs
  # ============================================
  /recommendations/personalized:
    get:
      tags: [Recommendation - Core]
      summary: ê°œì¸í™” ì¶”ì²œ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-RECO-001
        - **ì™¸ë¶€ ì˜ì¡´ì„±**: User Domain (ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ)
      operationId: getPersonalizedRecommendations
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonalizedRecsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /trends:
    get:
      tags: [Recommendation - Core]
      summary: íŠ¸ë Œë“œ ë¶„ì„ ì •ë³´ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-RECO-003
      operationId: getTrends
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrendsResponse'

  /curations:
    get:
      tags: [Recommendation - Core]
      summary: íë ˆì´ì…˜ íŒ¨í‚¤ì§€ ëª©ë¡ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-RECO-004
      operationId: getCurationPackages
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CurationPackageResponse'

  /curations/{packageId}:
    get:
      tags: [Recommendation - Core]
      summary: íë ˆì´ì…˜ íŒ¨í‚¤ì§€ ìƒì„¸ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-RECO-004
      operationId: getCurationPackageById
      parameters:
        - $ref: '#/components/parameters/packageId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurationPackageDetailResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /admin/dashboard:
    get:
      tags: [Admin - Core]
      summary: ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-RECO-006
      operationId: getAdminDashboard
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /admin/users/{userId}/role:
    put:
      tags: [Admin - Core]
      summary: ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-USER-006
      operationId: updateUserRoleByAdmin
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/userId'
      requestBody:
        $ref: '#/components/requestBodies/UpdateRoleRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /admin/content/pending:
    get:
      tags: [Admin - Core]
      summary: í†µí•© ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ ì¡°íšŒ
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-USER-010
      operationId: getPendingContentList
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PendingContent'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /admin/content/{contentType}/{contentId}/status:
    put:
      tags: [Admin - Core]
      summary: í†µí•© ì½˜í…ì¸  ìŠ¹ì¸/ë°˜ë ¤
      description: |
        - **ìš”êµ¬ì‚¬í•­ ID**: REJ-USER-010
      operationId: updateContentStatus
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/contentType'
        - $ref: '#/components/parameters/contentId'
      requestBody:
        $ref: '#/components/requestBodies/UpdateStatusRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateStatusResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ============================================
  # == 2. Webhooks
  # ============================================
  /webhooks/user-activity-updated:
    post:
      tags: [RecoAdmin - Webhooks]
      summary: ì‚¬ìš©ì í™œë™ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ 
      description: ë°ì´í„° íŒŒì´í”„ë¼ì¸ì—ì„œ ì‚¬ìš©ì í™œë™ ë°ì´í„° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë©´ ì¶”ì²œ ì‹œìŠ¤í…œì— ì•Œë¦¬ê¸° ìœ„í•´ í˜¸ì¶œë©ë‹ˆë‹¤.
      operationId: userActivityWebhook
      security:
        - internalApiKey: []
      requestBody:
        content:
          application/json:
            schema:
              properties:
                userId: { type: string, format: uuid }
                hasNewActivity: { type: boolean }
      responses:
        '202':
          description: Accepted

  # ============================================
  # == 3. External Dependencies
  # ============================================
  /internal/users/{userId}:
    get:
      tags: [External - User Domain]
      summary: "[User Domain] ë‚´ë¶€ìš© ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"
      description: "âš ï¸ User ë„ë©”ì¸ì´ ì œê³µí•´ì•¼ í•˜ëŠ” API. ê°œì¸í™” ì¶”ì²œ, ê´€ë¦¬ì ê¸°ëŠ¥ ë“±ì—ì„œ ì‚¬ìš©."
      operationId: getUserInfoExternal
      x-external-api: true
      x-provided-by: User Domain
      parameters:
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalUserProfileResponse'

components:
  securitySchemes:
    bearerAuth: { type: http, scheme: bearer, bearerFormat: JWT }
    internalApiKey: { type: apiKey, in: header, name: X-Internal-API-Key }
  parameters:
    packageId: { name: packageId, in: path, required: true, schema: { type: string, format: uuid } }
    userId: { name: userId, in: path, required: true, schema: { type: string, format: uuid } }
    contentType: { name: contentType, in: path, required: true, schema: { type: string, enum: [reviews, photos, trip-plans] } }
    contentId: { name: contentId, in: path, required: true, schema: { type: string, format: uuid } }
  schemas:
    # --- Request DTOs ---
    UpdateRoleRequest: { type: object, required: [role], properties: { role: { type: string, enum: [USER, ADMIN] } } }
    UpdateStatusRequest: { type: object, required: [status], properties: { status: { type: string, enum: [APPROVED, REJECTED] }, reason: { type: string } } }
    # --- Response DTOs ---
    PersonalizedRecsResponse: { type: object, properties: { places: { type: array, items: { type: object, description: "Place ë„ë©”ì¸ì—ì„œ ì •ì˜ëœ Place ìš”ì•½ ì •ë³´" } }, curations: { type: array, items: { $ref: '#/components/schemas/CurationPackageResponse' } } } }
    TrendsResponse: { type: object, properties: { popularPlaces: { type: array, items: { type: object, description: "Place ë„ë©”ì¸ì—ì„œ ì •ì˜ëœ Place ìš”ì•½ ì •ë³´" } }, seasonalTrends: { type: object, properties: { season: { type: string, example: "SUMMER" }, keywords: { type: array, items: { type: string } } } } } }
    CurationPackageResponse: { type: object, properties: { packageId: { type: string, format: uuid }, title: { type: string }, theme: { type: string } } }
    CurationPackageDetailResponse: { type: object, properties: { packageId: { type: string, format: uuid }, title: { type: string }, description: { type: string }, theme: { type: string }, places: { type: array, items: { type: object, description: "Place ë„ë©”ì¸ì—ì„œ ì •ì˜ëœ Place ìš”ì•½ ì •ë³´" } } } }
    DashboardResponse: { type: object, properties: { newUserCount: { type: integer }, totalUserCount: { type: integer }, pendingContentCount: { type: integer } } }
    PendingContent: { type: object, properties: { contentType: { type: string }, contentId: { type: string, format: uuid }, author: { type: string, description: "ì½˜í…ì¸  ì‘ì„±ì ë‹‰ë„¤ì„" }, snippet: { type: string, description: "ì½˜í…ì¸  ë‚´ìš© ì¼ë¶€ ë˜ëŠ” URL" }, createdAt: { type: string, format: date-time } } }
    UpdateStatusResponse: { type: object, properties: { status: { type: string, enum: [APPROVED, REJECTED] }, contentId: { type: string, format: uuid }, contentType: { type: string } } }
    UserResponse: { type: object, description: "User ë„ë©”ì¸ì˜ User ì •ë³´ (ê¶Œí•œ ë³€ê²½ í›„ ì‘ë‹µìš©)", properties: { id: { type: string, format: uuid }, email: { type: string, format: email }, nickname: { type: string }, role: { type: string, enum: [USER, ADMIN] }, createdAt: { type: string, format: date-time } } }
    # --- External Schemas ---
    ExternalUserProfileResponse: { type: object, description: "User ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” ì‚¬ìš©ì ì •ë³´", properties: { id: { type: string, format: uuid }, nickname: { type: string }, preferredRegion: { type: string, nullable: true }, role: { type: string, enum: [USER, ADMIN] } } }
    ErrorResponse: { type: object, properties: { code: { type: string }, message: { type: string }, timestamp: { type: string, format: date-time } } }
  requestBodies:
    UpdateRoleRequest: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdateRoleRequest' } } } }
    UpdateStatusRequest: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdateStatusRequest' } } } }
  responses:
    UnauthorizedError: { description: ì¸ì¦ ì‹¤íŒ¨, content: { application/json: { schema: { $ref: '#/components/schemas/ErrorResponse' }, example: { code: "AUTH_001", message: "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤." } } } }
    ForbiddenError: { description: ê¶Œí•œ ì—†ìŒ, content: { application/json: { schema: { $ref: '#/components/schemas/ErrorResponse' }, example: { code: "AUTH_003", message: "ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." } } } }
    NotFoundError: { description: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, content: { application/json: { schema: { $ref: '#/components/schemas/ErrorResponse' }, example: { code: "RECO_404", message: "ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." } } } }