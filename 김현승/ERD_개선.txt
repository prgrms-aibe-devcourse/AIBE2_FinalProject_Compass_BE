# ğŸ‘¤ User Management & Recommendation Domains ERD - ê¹€í˜„ìŠ¹

## ğŸ“‹ ë‹´ë‹¹ ë„ë©”ì¸
1. User Management Domain: ì‚¬ìš©ì ê´€ë¦¬, ì¸ì¦, í”„ë¡œí•„
2. Recommendation Domain: ì¶”ì²œ, íë ˆì´ì…˜, íŠ¸ë Œë“œ

---

# Domain 1: User Management

## ğŸ“Š Entities

### ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
```sql
User {
    id: UUID (PK)
    email: VARCHAR(255) (UNIQUE)
    password_hash: VARCHAR(255)
    nickname: VARCHAR(100) (UNIQUE)
    profile_image_url: VARCHAR(500)
    bio: TEXT
    preferred_region: VARCHAR(100)
    provider: ENUM('LOCAL', 'GOOGLE', 'KAKAO')
    role: ENUM('USER', 'ADMIN')
    status: ENUM('ACTIVE', 'BLOCKED', 'WITHDRAWN')
    is_2fa_enabled: BOOLEAN
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### í”„ë¡œí•„
```sql
Profile {
    profile_id: UUID (PK)
    user_id: UUID (FK â†’ User, UNIQUE)
    travel_style: TEXT
    preferences: TEXT
    budget_level: VARCHAR(50)
    updated_at: TIMESTAMP
}
```

### í”„ë¡œí•„ ì´ë¯¸ì§€
```sql
ProfileImage {
    image_id: UUID (PK)
    profile_id: UUID (FK â†’ Profile)
    image_url: VARCHAR(500)
    upload_order: INT
    created_at: TIMESTAMP
}
```

### ë¡œê·¸ì¸ ê¸°ë¡
```sql
LoginHistory {
    id: UUID (PK)
    user_id: UUID (FK â†’ User)
    ip_address: VARCHAR(50)
    device_info: TEXT
    login_at: TIMESTAMP
}
```

### ì‚¬ìš©ì í™œë™ ì¶”ì 
```sql
UserActivity {
    id: BIGSERIAL (PK)
    user_id: UUID (FK â†’ User)
    activity_type: VARCHAR(50)
    target_id: VARCHAR(255)
    ab_test_group: VARCHAR(50)
    created_at: TIMESTAMP
}
```

### ê´€ë¦¬ì
```sql
AdminUser {
    id: UUID (PK)
    username: VARCHAR(100) (UNIQUE)
    password: VARCHAR(255)
    email: VARCHAR(255) (UNIQUE)
    role: ENUM('SUPER_ADMIN', 'ADMIN', 'MODERATOR')
    created_at: TIMESTAMP
    last_login_at: TIMESTAMP
}
```

### ê´€ë¦¬ ëŒ€ìƒ ì‚¬ìš©ì
```sql
ManagedUser {
    id: UUID (PK)
    user_id: UUID (FK â†’ User)
    action: ENUM('BLOCK', 'UNBLOCK', 'WARNING')
    reason: TEXT
    admin_id: UUID (FK â†’ AdminUser)
    created_at: TIMESTAMP
    expires_at: TIMESTAMP
}
```

## ğŸ”µ External APIs (User Management)

### Authentication
```yaml
POST /api/auth/login:
  Description: "ë¡œê·¸ì¸"
  Body: { email, password }
  Response: { access_token, refresh_token, user }
  
POST /api/auth/logout:
  Description: "ë¡œê·¸ì•„ì›ƒ"
  Response: 204 No Content
  
POST /api/auth/refresh:
  Description: "í† í° ê°±ì‹ "
  Body: { refresh_token }
  Response: { access_token, refresh_token }
  
GET /api/auth/verify:
  Description: "í† í° ê²€ì¦"
  Headers: Authorization: Bearer {token}
  Response: { valid, user_id }
  
GET /api/auth/social/{provider}:
  Description: "ì†Œì…œ ë¡œê·¸ì¸"
  Redirect: OAuth Provider â†’ Callback
```

### User Profile
```yaml
GET /api/users/{userId}:
  Description: "ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"
  Response: UserProfileResponse
  
GET /api/users/me:
  Description: "í˜„ì¬ ì‚¬ìš©ì ì •ë³´"
  Response: CurrentUserResponse
  
PUT /api/users/me:
  Description: "í”„ë¡œí•„ ìˆ˜ì •"
  Body: { nickname?, bio?, preferred_region?, profile_image_url? }
  Response: UserProfileResponse
  
POST /api/users/signup:
  Description: "íšŒì›ê°€ì…"
  Body: { email, password, nickname }
  Response: { user, access_token }
  
DELETE /api/users/me:
  Description: "íšŒì› íƒˆí‡´"
  Body: { password, reason? }
  Response: 204 No Content
  
POST /api/users/password/reset-request:
  Description: "ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­"
  Body: { email }
  Response: { message }
  
PUT /api/users/password/reset:
  Description: "ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •"
  Body: { token, new_password }
  Response: { message }
```

### Admin
```yaml
GET /api/admin/dashboard:
  Description: "ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ"
  Response: DashboardResponse
  
GET /api/admin/users:
  Description: "ì‚¬ìš©ì ëª©ë¡"
  Query: page, size, status?, search?
  Response: UserListResponse
  
PUT /api/admin/users/{userId}/role:
  Description: "ì—­í•  ë³€ê²½"
  Body: { role }
  Response: UserResponse
  
PUT /api/admin/users/{userId}/status:
  Description: "ìƒíƒœ ë³€ê²½"
  Body: { status, reason? }
  Response: UserResponse
  
PUT /api/admin/content/{contentType}/{contentId}/status:
  Description: "ì½˜í…ì¸  ìŠ¹ì¸/ë°˜ë ¤"
  Body: { status, reason? }
  Response: ContentStatusResponse
```

## ğŸ”´ Internal APIs (User Management)
```yaml
POST /api/internal/users/activity:
  Description: "í™œë™ ë¡œê·¸ ê¸°ë¡"
  Body: { user_id, activity_type, target_id }
  
GET /api/internal/users/{userId}/permissions:
  Description: "ê¶Œí•œ ì¡°íšŒ"
  Response: { permissions[] }
  
PUT /api/internal/users/{userId}/trust-score:
  Description: "ì‹ ë¢°ë„ ì ìˆ˜ ì—…ë°ì´íŠ¸"
  Body: { trust_score, reason }
  
GET /api/internal/users/validate:
  Description: "ì‚¬ìš©ì ìœ íš¨ì„± ê²€ì¦"
  Query: user_id
  Response: { valid, status }
```

---

# Domain 2: Recommendation

## ğŸ“Š Entities

### íë ˆì´ì…˜ íŒ¨í‚¤ì§€
```sql
CurationPackage {
    id: UUID (PK)
    created_by: UUID (FK â†’ User, ê´€ë¦¬ì)
    title: VARCHAR(255)
    description: TEXT
    theme: VARCHAR(100)
    image_url: VARCHAR(500)
    view_count: INT DEFAULT 0
    is_featured: BOOLEAN DEFAULT false
    created_at: TIMESTAMP
    updated_at: TIMESTAMP
}
```

### íë ˆì´ì…˜ ì•„ì´í…œ
```sql
CurationPackageItem {
    id: UUID (PK)
    package_id: UUID (FK â†’ CurationPackage)
    place_id: UUID (FK â†’ Place from Trip Domain)
    visit_order: INTEGER
    description: TEXT
    tips: TEXT
}
```

### ì¶”ì²œ ì´ë ¥
```sql
RecommendationHistory {
    id: UUID (PK)
    user_id: UUID (FK â†’ User)
    recommendation_type: VARCHAR(50)
    recommended_items: JSON
    clicked_items: JSON
    conversion_rate: DECIMAL(3,2)
    created_at: TIMESTAMP
}
```

### íŠ¸ë Œë“œ ë°ì´í„°
```sql
TrendData {
    id: UUID (PK)
    trend_type: VARCHAR(50)
    location: VARCHAR(100)
    season: VARCHAR(20)
    data: JSON
    score: DECIMAL(5,2)
    calculated_at: TIMESTAMP
}
```

### ì‚¬ìš©ì ì„ í˜¸ë„
```sql
UserPreference {
    id: UUID (PK)
    user_id: UUID (FK â†’ User)
    preference_type: VARCHAR(50)
    preference_value: JSON
    confidence: DECIMAL(3,2)
    updated_at: TIMESTAMP
}
```

## ğŸ”µ External APIs (Recommendation)

### Recommendations
```yaml
GET /api/recommendations/personalized:
  Description: "ê°œì¸í™” ì¶”ì²œ"
  Query: limit?, category?
  Response: PersonalizedRecommendationResponse
  
GET /api/recommendations/similar-users:
  Description: "ìœ ì‚¬ ì‚¬ìš©ì ê¸°ë°˜ ì¶”ì²œ"
  Query: user_id, limit?
  Response: SimilarUserRecommendationResponse
  
GET /api/recommendations/popular:
  Description: "ì¸ê¸° ì¶”ì²œ"
  Query: period?, location?, limit?
  Response: PopularRecommendationResponse
  
GET /api/recommendations/places:
  Description: "ì¥ì†Œ ì¶”ì²œ"
  Query: location, preferences?, budget?
  Response: PlaceRecommendationResponse
```

### Curations
```yaml
GET /api/curations:
  Description: "íë ˆì´ì…˜ ëª©ë¡"
  Query: page, size, theme?, featured?
  Response: CurationListResponse
  
GET /api/curations/{packageId}:
  Description: "íë ˆì´ì…˜ ìƒì„¸"
  Response: CurationDetailResponse
  
POST /api/curations:
  Description: "íë ˆì´ì…˜ ìƒì„± (ê´€ë¦¬ì)"
  Body: { title, description, theme, items[] }
  Response: CurationPackageResponse
  
PUT /api/curations/{packageId}:
  Description: "íë ˆì´ì…˜ ìˆ˜ì • (ê´€ë¦¬ì)"
  Body: { title?, description?, items[]? }
  Response: CurationPackageResponse
  
DELETE /api/curations/{packageId}:
  Description: "íë ˆì´ì…˜ ì‚­ì œ (ê´€ë¦¬ì)"
  Response: 204 No Content
```

### Trends
```yaml
GET /api/trends:
  Description: "íŠ¸ë Œë“œ ë¶„ì„ ì¡°íšŒ"
  Query: type?, limit?
  Response: TrendAnalysisResponse
  
GET /api/trends/seasonal:
  Description: "ì‹œì¦Œë³„ íŠ¸ë Œë“œ"
  Query: season?, year?
  Response: SeasonalTrendResponse
  
GET /api/trends/regions:
  Description: "ì§€ì—­ë³„ íŠ¸ë Œë“œ"
  Query: region?, period?
  Response: RegionalTrendResponse
```

## ğŸ”´ Internal APIs (Recommendation)
```yaml
POST /api/internal/recommendations/log:
  Description: "ì¶”ì²œ ë¡œê·¸ ê¸°ë¡"
  Body: { user_id, recommendation_type, items, clicked }
  
POST /api/internal/trends/calculate:
  Description: "íŠ¸ë Œë“œ ê³„ì‚°"
  Body: { trend_type, data_source }
  
GET /api/internal/recommendations/ab-test:
  Description: "A/B í…ŒìŠ¤íŠ¸ ê·¸ë£¹ ì¡°íšŒ"
  Query: user_id
  Response: { test_group, variant }
  
POST /api/internal/preferences/update:
  Description: "ì‚¬ìš©ì ì„ í˜¸ë„ ì—…ë°ì´íŠ¸"
  Body: { user_id, preferences }
```

---

## ğŸ”— ì™¸ë¶€ ë„ë©”ì¸ ì˜ì¡´ì„±

### í•„ìš”í•œ ì™¸ë¶€ API
```yaml
Trip Planning Domain:
  - GET /api/places/{placeId}: "ì¥ì†Œ ì •ë³´ ì¡°íšŒ"
  - GET /api/trips/user/{userId}: "ì‚¬ìš©ì ì—¬í–‰ ì´ë ¥"
  
Review System Domain:
  - GET /api/reviews/user/{userId}: "ì‚¬ìš©ì ë¦¬ë·° ì¡°íšŒ"
  - GET /api/internal/users/{userId}/rating: "í‰ì  ì¡°íšŒ"
  
Media Management Domain:
  - POST /api/media/upload: "í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ"
  - GET /api/media/{mediaId}: "ë¯¸ë””ì–´ ì¡°íšŒ"
```

---

## ğŸ’¡ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### User Management
1. **ì¸ì¦ í”Œë¡œìš°**: ë¡œê·¸ì¸ â†’ JWT ë°œê¸‰ â†’ í† í° ê²€ì¦ â†’ ê¶Œí•œ í™•ì¸
2. **ì†Œì…œ ë¡œê·¸ì¸**: OAuth 2.0 â†’ í”„ë¡œí•„ ì—°ë™ â†’ ìë™ íšŒì›ê°€ì…
3. **ê¶Œí•œ ê´€ë¦¬**: RBAC ê¸°ë°˜ ì—­í• ë³„ ì ‘ê·¼ ì œì–´

### Recommendation
1. **ê°œì¸í™” ì¶”ì²œ**: ì‚¬ìš©ì í™œë™ ë¶„ì„ â†’ ì„ í˜¸ë„ ê³„ì‚° â†’ í˜‘ì—… í•„í„°ë§ â†’ ì¶”ì²œ ìƒì„±
2. **íŠ¸ë Œë“œ ë¶„ì„**: ë°ì´í„° ìˆ˜ì§‘ â†’ ì‹œê³„ì—´ ë¶„ì„ â†’ ìŠ¤ì½”ì–´ë§ â†’ íŠ¸ë Œë“œ ë„ì¶œ
3. **íë ˆì´ì…˜**: ì „ë¬¸ê°€ ì„ ì • â†’ í…Œë§ˆë³„ êµ¬ì„± â†’ ìˆœì„œ ìµœì í™” â†’ íŒ¨í‚¤ì§€ ìƒì„±

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- JWT í† í° ë³´ì•ˆ (RS256)
- ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (bcrypt)
- 2FA ì¸ì¦
- OAuth 2.0 ì†Œì…œ ë¡œê·¸ì¸
- Rate Limiting
- SQL Injection ë°©ì–´
- XSS ë°©ì–´