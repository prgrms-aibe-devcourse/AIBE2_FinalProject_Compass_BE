# ========================================================================
# OpenAPI/Swagger 3.0 ëª…ì„¸ì„œ êµ¬ì¡° ì„¤ëª…
# ========================================================================
# 
# openapi: OpenAPI ëª…ì„¸ì„œ ë²„ì „ (3.0.3ì€ í˜„ì¬ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë²„ì „)
# info: APIì˜ ê¸°ë³¸ ì •ë³´ (ì œëª©, ì„¤ëª…, ë²„ì „, ì—°ë½ì²˜ ë“±)
# servers: APIê°€ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì„œë²„ ëª©ë¡ (ê°œë°œ, ìŠ¤í…Œì´ì§•, í”„ë¡œë•ì…˜)
# tags: API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê·¸ë£¹í™”í•˜ëŠ” ë¼ë²¨ (ë¬¸ì„œ ì •ë¦¬ìš©)
# paths: ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ë“¤ì˜ ì •ì˜
# components: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤í‚¤ë§ˆ, ì‘ë‹µ, íŒŒë¼ë¯¸í„° ë“±ì˜ ì •ì˜
# security: ì¸ì¦/ì¸ê°€ ë°©ì‹ ì •ì˜
# 
# ê° ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡°:
# - tags: ì´ ì—”ë“œí¬ì¸íŠ¸ê°€ ì†í•œ ê·¸ë£¹ (ìœ„ì— ì •ì˜í•œ tags ì¤‘ í•˜ë‚˜)
# - summary: ì—”ë“œí¬ì¸íŠ¸ì˜ ì§§ì€ ì„¤ëª… (1ì¤„)
# - description: ì—”ë“œí¬ì¸íŠ¸ì˜ ìƒì„¸ ì„¤ëª… (ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥)
# - operationId: í”„ë¡œê·¸ë˜ë°ì—ì„œ ì‚¬ìš©í•  ê³ ìœ  ì‹ë³„ì (ì¤‘ë³µ ë¶ˆê°€)
# - security: ì´ ì—”ë“œí¬ì¸íŠ¸ì— í•„ìš”í•œ ì¸ì¦ ë°©ì‹
# - parameters: URL ê²½ë¡œë‚˜ ì¿¼ë¦¬ì— ì „ë‹¬ë˜ëŠ” íŒŒë¼ë¯¸í„°
# - requestBody: POST/PUT/PATCH ë“±ì—ì„œ ë°”ë””ë¡œ ì „ë‹¬ë˜ëŠ” ë°ì´í„°
# - responses: ê°€ëŠ¥í•œ ì‘ë‹µ ì½”ë“œì™€ ê°ê°ì˜ ì‘ë‹µ í˜•ì‹
# 
# x-ë¡œ ì‹œì‘í•˜ëŠ” ì†ì„±ë“¤: OpenAPI í™•ì¥ ì†ì„± (ì»¤ìŠ¤í…€ ë©”íƒ€ë°ì´í„°)
# - x-domain-dependencies: ë„ë©”ì¸ ê°„ ì˜ì¡´ì„± ê´€ê³„
# - x-events-published: ë°œí–‰í•˜ëŠ” ì´ë²¤íŠ¸ ëª©ë¡
# - x-external-api: ì™¸ë¶€ ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” API í‘œì‹œ
# - x-provided-by: APIë¥¼ ì œê³µí•˜ëŠ” ë„ë©”ì¸ ëª…ì‹œ
# ========================================================================

openapi: 3.0.3
info:
  title: Compass Chat Domain API
  description: |
    # Chat ë„ë©”ì¸ API ëª…ì„¸ì„œ
    
    ## ğŸ“‹ ë„ë©”ì¸ êµ¬ì„± ìš”ì•½
    
    ### Chat ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤
    - **ì±„íŒ… ìŠ¤ë ˆë“œ ê´€ë¦¬**: ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ
    - **ë©”ì‹œì§€ ì²˜ë¦¬**: í…ìŠ¤íŠ¸, ë¯¸ë””ì–´, ìœ„ì¹˜ ë©”ì‹œì§€
    - **AI í†µí•©**: ì‘ë‹µ ìƒì„±, ì¬ìƒì„±
    - **ì—¬í–‰ ê³„íš ì—°ë™**: Trip ë„ë©”ì¸ê³¼ í†µí•©
    - **ë‚´ë¶€ API**: ë‹¤ë¥¸ ë„ë©”ì¸ì„ ìœ„í•œ ì „ìš© API
    - **Webhook**: ë¹„ë™ê¸° ì²˜ë¦¬ ì½œë°±
    
    ## ğŸ“Š ë„ë©”ì¸ ê°„ ìƒí˜¸ì‘ìš©
    
    | ë„ë©”ì¸ | Chat â†’ ì™¸ë¶€ (ìš”ì²­) | ì™¸ë¶€ â†’ Chat (í˜¸ì¶œ) | ì£¼ìš” ìš©ë„ |
    |--------|-------------------|-------------------|-----------|
    | **User** | â€¢ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ<br>â€¢ í† í° ê²€ì¦ | - | ì¸ì¦/ì¸ê°€ |
    | **Credit** | â€¢ ì”ì•¡ ì¡°íšŒ<br>â€¢ í¬ë ˆë”§ ì°¨ê°<br>â€¢ ì‚¬ìš© ë‚´ì—­ | â€¢ í¬ë ˆë”§ ì°¨ê° ì™„ë£Œ ì›¹í›… | ê²°ì œ/ê³¼ê¸ˆ |
    | **Trip** | â€¢ ì—¬í–‰ ê³„íš ìƒì„±<br>â€¢ ê³„íš ì¡°íšŒ | â€¢ ê³„íš ìƒì„± ì™„ë£Œ ì›¹í›…<br>â€¢ ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ | ì—¬í–‰ ê³„íš |
    | **Media** | â€¢ íŒŒì¼ ì—…ë¡œë“œ<br>â€¢ ë¯¸ë””ì–´ ì¡°íšŒ<br>â€¢ ì‚­ì œ | - | íŒŒì¼ ê´€ë¦¬ |
    | **AI Service** | â€¢ ì‘ë‹µ ìƒì„±<br>â€¢ ëŒ€í™” ìš”ì•½ | - | AI ì²˜ë¦¬ |
    
    ## ğŸ”„ ì£¼ìš” ì²˜ë¦¬ íë¦„
    
    ### ë©”ì‹œì§€ ì „ì†¡
    1. User Domainì—ì„œ ì¸ì¦ í™•ì¸
    2. Credit Domainì—ì„œ ì”ì•¡ í™•ì¸
    3. AI Serviceë¡œ ì‘ë‹µ ìƒì„±
    4. Credit Domainì—ì„œ í¬ë ˆë”§ ì°¨ê°
    5. ì‚¬ìš©ìì—ê²Œ ì‘ë‹µ ë°˜í™˜
    
    ### ë¯¸ë””ì–´ ë©”ì‹œì§€
    1. Media Domainì— íŒŒì¼ ì—…ë¡œë“œ
    2. Credit Domainì—ì„œ í¬ë ˆë”§ ì°¨ê°
    3. AI Serviceë¡œ ì´ë¯¸ì§€ ë¶„ì„ (í•„ìš”ì‹œ)
    4. ì‚¬ìš©ìì—ê²Œ ì‘ë‹µ ë°˜í™˜
    
    ### ì—¬í–‰ ê³„íš ìƒì„±
    1. Trip Domainì— ê³„íš ìƒì„± ìš”ì²­
    2. Credit Domainì—ì„œ í¬ë ˆë”§ ì°¨ê°
    3. Trip Domainì´ ì™„ë£Œ í›„ Webhook í˜¸ì¶œ
    4. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
    
    ## ğŸ“Œ API ë¶„ë¥˜
    
    | ë¶„ë¥˜ | ì„¤ëª… | íƒœê·¸ |
    |-----|------|------|
    | **Chat Core** | ì‚¬ìš©ìê°€ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” í•µì‹¬ API | Chat - Core |
    | **Chat Internal** | ë‹¤ë¥¸ ë„ë©”ì¸ì´ í˜¸ì¶œí•˜ëŠ” ë‚´ë¶€ API | Chat - Internal |
    | **Chat Webhooks** | ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± API | Chat - Webhooks |
    | **External APIs** | Chatì´ ì˜ì¡´í•˜ëŠ” ì™¸ë¶€ ë„ë©”ì¸ API | External - * |
  version: 2.0.0
  contact:
    name: Chat Domain Team
    email: chat-team@compass.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

# servers: API ì„œë²„ ëª©ë¡ - í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ëŠ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¼ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤
# ê°œë°œ/ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ URLì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
servers:
  - url: https://api.compass.com/v1
    description: Production server
  - url: https://staging-api.compass.com/v1
    description: Staging server
  - url: http://localhost:8080/v1
    description: Development server

# tags: APIë¥¼ ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜í•˜ëŠ” íƒœê·¸ ì •ì˜
# - name: íƒœê·¸ì˜ ê³ ìœ  ì´ë¦„ (pathsì—ì„œ ì´ ì´ë¦„ì„ ì°¸ì¡°)
# - description: ì´ íƒœê·¸ ê·¸ë£¹ì— ëŒ€í•œ ì„¤ëª…
# íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ë©´ Swagger UIì—ì„œ APIê°€ ê·¸ë£¹ë³„ë¡œ ì •ë¦¬ë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤
tags:
  - name: Chat - Core
    description: Chat ë„ë©”ì¸ í•µì‹¬ ê¸°ëŠ¥ (ì‚¬ìš©ì ëŒ€ìƒ)
  - name: Chat - Internal
    description: Chat ë„ë©”ì¸ ë‚´ë¶€ API (ë‹¤ë¥¸ ë„ë©”ì¸ ëŒ€ìƒ)
  - name: Chat - Webhooks
    description: Chat ë„ë©”ì¸ Webhook ì—”ë“œí¬ì¸íŠ¸
  - name: External - User Domain
    description: User ë„ë©”ì¸ ì˜ì¡´ì„±
  - name: External - Trip Domain
    description: Trip ë„ë©”ì¸ ì˜ì¡´ì„±
  - name: External - Credit Domain
    description: Credit ë„ë©”ì¸ ì˜ì¡´ì„±
  - name: External - Media Domain
    description: Media ë„ë©”ì¸ ì˜ì¡´ì„±
  - name: External - AI Service
    description: AI Service ì˜ì¡´ì„±

# x-domain-dependencies: ì»¤ìŠ¤í…€ í™•ì¥ - ë„ë©”ì¸ ê°„ ì˜ì¡´ì„± ê´€ê³„ë¥¼ ë¬¸ì„œí™”
# provides: ì´ ë„ë©”ì¸ì´ ë‹¤ë¥¸ ë„ë©”ì¸ì—ê²Œ ì œê³µí•˜ëŠ” API/ì„œë¹„ìŠ¤
# consumes: ì´ ë„ë©”ì¸ì´ ì˜ì¡´í•˜ëŠ” ì™¸ë¶€ ë„ë©”ì¸ì˜ API/ì„œë¹„ìŠ¤
x-domain-dependencies:
  provides:
    - Chat Thread Management API
    - Message Query API
    - AI Context API
    - Trip Generation Events
  consumes:
    - User Domain (Authentication & User Info)
    - Trip Domain (Trip Planning)
    - Credit Domain (Credit Management)
    - Media Domain (Media Upload/Storage)
    - AI Service (Response Generation)

# x-events-published: ì»¤ìŠ¤í…€ í™•ì¥ - ì´ ë„ë©”ì¸ì´ ë°œí–‰í•˜ëŠ” ì´ë²¤íŠ¸ ëª©ë¡
# ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ì—ì„œ ë‹¤ë¥¸ ë„ë©”ì¸ì´ êµ¬ë…í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì •ì˜
x-events-published:
  TripPlanGenerationRequested:
    description: ì—¬í–‰ ê³„íš ìƒì„± ìš”ì²­ ì´ë²¤íŠ¸
    consumers: [Trip Domain]
    payload:
      eventId: uuid
      threadId: uuid
      userId: uuid
      preferences: object
      constraints: object
      timestamp: datetime
  ChatSessionEnded:
    description: ì±„íŒ… ì„¸ì…˜ ì¢…ë£Œ ì´ë²¤íŠ¸
    consumers: [Analytics Domain, Credit Domain]
    payload:
      eventId: uuid
      threadId: uuid
      userId: uuid
      totalMessages: integer
      totalTokensUsed: integer
      sessionDuration: integer
      timestamp: datetime
  MessageSent:
    description: ë©”ì‹œì§€ ì „ì†¡ ì´ë²¤íŠ¸
    consumers: [Analytics Domain]
    payload:
      messageId: uuid
      threadId: uuid
      userId: uuid
      senderType: string
      timestamp: datetime

# security: ì „ì—­ ë³´ì•ˆ ì„¤ì • (ì—¬ê¸°ì„œëŠ” ì œê±°ë¨)
# ê° ì—”ë“œí¬ì¸íŠ¸ë§ˆë‹¤ í•„ìš”í•œ ë³´ì•ˆ ë°©ì‹ì„ ê°œë³„ì ìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê²ƒì´ ë” ëª…í™•í•©ë‹ˆë‹¤
# - bearerAuth: JWT í† í° ì¸ì¦ (ì‚¬ìš©ì API)
# - internalApiKey: ë‚´ë¶€ API í‚¤ ì¸ì¦ (ë„ë©”ì¸ ê°„ í†µì‹ )

# paths: ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ ì •ì˜ ì„¹ì…˜
# ê° ê²½ë¡œëŠ” HTTP ë©”ì†Œë“œ(get, post, put, delete ë“±)ì™€ í•¨ê»˜ ì •ì˜ë©ë‹ˆë‹¤
paths:
  # ============================================
  # Chat ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” API (Core Features)
  # ============================================
  
  # ê²½ë¡œ ì •ì˜ ì˜ˆì‹œ: /api/chat/threads
  /api/chat/threads:
    # HTTP ë©”ì†Œë“œ: GET
    get:
      # tags: ì´ ì—”ë“œí¬ì¸íŠ¸ê°€ ì†í•œ ê·¸ë£¹ (ìœ„ì—ì„œ ì •ì˜í•œ íƒœê·¸ ì¤‘ ì„ íƒ)
      tags:
        - Chat - Core
      # summary: APIì˜ ê°„ë‹¨í•œ í•œ ì¤„ ì„¤ëª… (Swagger UI ëª©ë¡ì— í‘œì‹œë¨)
      summary: ì±„íŒ… ìŠ¤ë ˆë“œ ëª©ë¡ ì¡°íšŒ
      # security: ì´ ì—”ë“œí¬ì¸íŠ¸ì— í•„ìš”í•œ ì¸ì¦ ë°©ì‹
      # bearerAuth: JWT í† í°ì´ í•„ìš”í•¨ì„ ì˜ë¯¸
      security:
        - bearerAuth: []
      # description: APIì˜ ìƒì„¸ ì„¤ëª… (ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥, ë§ˆí¬ë‹¤ìš´ ì§€ì›)
      description: |
        í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ëª¨ë“  ì±„íŒ… ìŠ¤ë ˆë“œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
        - REQ-CHAT-002: ì±„íŒ… ìŠ¤ë ˆë“œ ëª©ë¡ ì¡°íšŒ
        - REQ-CHAT-013: ì´ì „ ì±„íŒ… íˆìŠ¤í† ë¦¬ ì¡°íšŒ
      # operationId: í”„ë¡œê·¸ë˜ë°ì—ì„œ ì‚¬ìš©í•  ê³ ìœ  ì‹ë³„ì (ì¤‘ë³µ ë¶ˆê°€)
      # í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ìƒì„± ë„êµ¬ì—ì„œ ì´ ì´ë¦„ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      operationId: getChatThreads
      # parameters: URL ê²½ë¡œ, ì¿¼ë¦¬ ìŠ¤íŠ¸ë§, í—¤ë”ì— ì „ë‹¬ë˜ëŠ” íŒŒë¼ë¯¸í„°
      parameters:
        # íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
        - name: page          # íŒŒë¼ë¯¸í„° ì´ë¦„
          in: query           # íŒŒë¼ë¯¸í„° ìœ„ì¹˜ (query, path, header, cookie)
          schema:             # íŒŒë¼ë¯¸í„°ì˜ ë°ì´í„° íƒ€ì… ì •ì˜
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: sort
          in: query
          schema:
            type: string
            default: lastMessageAt,desc
        - name: status
          in: query
          schema:
            type: string
            enum: [active, archived, deleted]  # ê°€ëŠ¥í•œ ê°’ë“¤ì˜ ëª©ë¡
      # responses: ê°€ëŠ¥í•œ HTTP ì‘ë‹µ ì½”ë“œì™€ ê°ê°ì˜ ì‘ë‹µ í˜•ì‹
      responses:
        '200':  # HTTP 200 OK - ì„±ê³µì ì¸ ì‘ë‹µ
          description: ì±„íŒ… ëª©ë¡ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatThreadListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    # ê°™ì€ ê²½ë¡œì— ë‹¤ë¥¸ HTTP ë©”ì†Œë“œ: POST
    post:
      tags:
        - Chat - Core
      summary: ìƒˆ ì±„íŒ… ìŠ¤ë ˆë“œ ìƒì„±
      security:
        - bearerAuth: []
      description: |
        ìƒˆë¡œìš´ ì±„íŒ… ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        - REQ-CHAT-003: ìƒˆë¡œìš´ ì±„íŒ… ìŠ¤ë ˆë“œ ìƒì„±
        - REQ-CHAT-014: ìƒˆ ì±„íŒ… ì‹œì‘
        
        ì™¸ë¶€ ì˜ì¡´ì„±:
        - User Domain: ì‚¬ìš©ì ê²€ì¦
      operationId: createChatThread
      # requestBody: POST/PUT/PATCHì—ì„œ ë°”ë””ë¡œ ì „ë‹¬ë˜ëŠ” ë°ì´í„°
      requestBody:
        required: true        # í•„ìˆ˜ ì—¬ë¶€
        content:             # ì»¨í…ì¸  íƒ€ì…ë³„ ìŠ¤í‚¤ë§ˆ ì •ì˜
          application/json:   # Content-Type: application/json
            schema:
              # $ref: ë‹¤ë¥¸ ê³³ì— ì •ì˜ëœ ìŠ¤í‚¤ë§ˆë¥¼ ì°¸ì¡° (components/schemas ì„¹ì…˜)
              $ref: '#/components/schemas/CreateChatThreadRequest'
      responses:
        '201':  # HTTP 201 Created - ë¦¬ì†ŒìŠ¤ ìƒì„± ì„±ê³µ
          description: ì±„íŒ… ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatThreadResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'

  # ê²½ë¡œ íŒŒë¼ë¯¸í„° ì˜ˆì‹œ: {threadId}ëŠ” ë™ì  ê°’
  /api/chat/threads/{threadId}:
    get:
      tags:
        - Chat - Core
      summary: íŠ¹ì • ì±„íŒ… ìŠ¤ë ˆë“œ ì¡°íšŒ
      security:
        - bearerAuth: []
      description: íŠ¹ì • ì±„íŒ… ìŠ¤ë ˆë“œì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
      operationId: getChatThread
      parameters:
        # $ref: ê³µí†µ íŒŒë¼ë¯¸í„°ë¥¼ ì°¸ì¡° (components/parameters ì„¹ì…˜)
        - $ref: '#/components/parameters/threadId'
      responses:
        '200':
          description: ì±„íŒ… ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatThreadDetailResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Chat - Core
      summary: ì±„íŒ… ì œëª© ìˆ˜ì •
      security:
        - bearerAuth: []
      description: |
        ì±„íŒ… ìŠ¤ë ˆë“œì˜ ì œëª©ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
        - REQ-CHAT-017: ì±„íŒ… ì œëª© ìˆ˜ì •
      operationId: updateChatThread
      parameters:
        - $ref: '#/components/parameters/threadId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChatThreadRequest'
      responses:
        '200':
          description: ìˆ˜ì • ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatThreadResponse'

    delete:
      tags:
        - Chat - Core
      summary: ì±„íŒ… ìŠ¤ë ˆë“œ ì‚­ì œ
      security:
        - bearerAuth: []
      description: |
        ì±„íŒ… ìŠ¤ë ˆë“œë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
        - REQ-CHAT-016: ì±„íŒ… ìŠ¤ë ˆë“œ ì‚­ì œ
        
        ì™¸ë¶€ ì˜ì¡´ì„±:
        - Media Domain: ê´€ë ¨ ì´ë¯¸ì§€ ì‚­ì œ
      operationId: deleteChatThread
      parameters:
        - $ref: '#/components/parameters/threadId'
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ

  /api/chat/threads/{threadId}/messages:
    get:
      tags:
        - Chat - Core
      summary: ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ
      security:
        - bearerAuth: []
      description: ì±„íŒ… ìŠ¤ë ˆë“œì˜ ë©”ì‹œì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
      operationId: getMessages
      parameters:
        - $ref: '#/components/parameters/threadId'
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 50
            maximum: 200
        - name: lastMessageId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ë©”ì‹œì§€ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageListResponse'

    post:
      tags:
        - Chat - Core
      summary: ë©”ì‹œì§€ ì „ì†¡
      security:
        - bearerAuth: []
      description: |
        ì±„íŒ… ìŠ¤ë ˆë“œì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
        - REQ-CHAT-004: ì±„íŒ… ë©”ì‹œì§€ ì†¡ìˆ˜ì‹ 
        
        ì™¸ë¶€ ì˜ì¡´ì„±:
        - Credit Domain: í¬ë ˆë”§ ì°¨ê°
        - AI Service: AI ì‘ë‹µ ìƒì„±
      operationId: sendMessage
      parameters:
        - $ref: '#/components/parameters/threadId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageRequest'
      responses:
        '201':
          description: ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '402':
          description: í¬ë ˆë”§ ë¶€ì¡±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/chat/threads/{threadId}/messages/with-media:
    post:
      tags:
        - Chat - Core
      summary: ë¯¸ë””ì–´ ì²¨ë¶€ ë©”ì‹œì§€ ì „ì†¡
      security:
        - bearerAuth: []
      description: |
        ì´ë¯¸ì§€ë‚˜ íŒŒì¼ì„ ì²¨ë¶€í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
        - REQ-CHAT-010: ì±„íŒ…ì— ì´ë¯¸ì§€ ì²¨ë¶€
        
        **ì²˜ë¦¬ íë¦„:**
        1. Chatì´ ë¯¸ë””ì–´ íŒŒì¼ ìˆ˜ì‹ 
        2. Media ë„ë©”ì¸ `/api/media/upload` í˜¸ì¶œí•˜ì—¬ íŒŒì¼ ì €ì¥
        3. Media ë„ë©”ì¸ì—ì„œ mediaIdì™€ URL ë°˜í™˜
        4. Message ì—”í‹°í‹°ì— mediaUrl ì €ì¥
        5. Credit ë„ë©”ì¸ í˜¸ì¶œí•˜ì—¬ í¬ë ˆë”§ ì°¨ê°
        6. AI Service í˜¸ì¶œ (ì´ë¯¸ì§€ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°)
        
        **ì™¸ë¶€ API í˜¸ì¶œ:**
        - Media ë„ë©”ì¸: POST /api/media/upload
        - Credit ë„ë©”ì¸: POST /api/credits/deduct
        - AI Service: POST /api/ai/generate-response (ì´ë¯¸ì§€ ë¶„ì„ ì‹œ)
      operationId: sendMessageWithMedia
      parameters:
        - $ref: '#/components/parameters/threadId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - message
              properties:
                file:
                  type: string
                  format: binary
                  description: ì—…ë¡œë“œí•  ì´ë¯¸ì§€/íŒŒì¼ (ìµœëŒ€ 10MB)
                message:
                  type: string
                  description: ë©”ì‹œì§€ ë‚´ìš©
                metadata:
                  type: object
                  description: ì¶”ê°€ ë©”íƒ€ë°ì´í„° (JSON ë¬¸ìì—´)
                  properties:
                    fileType:
                      type: string
                      enum: [image, document, video]
                    description:
                      type: string
      responses:
        '201':
          description: ë¯¸ë””ì–´ ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/MessageResponse'
                  - type: object
                    properties:
                      mediaInfo:
                        type: object
                        description: Media ë„ë©”ì¸ì—ì„œ ë°˜í™˜ëœ ì •ë³´
                        properties:
                          mediaId:
                            type: string
                            format: uuid
                          url:
                            type: string
                            description: ë¯¸ë””ì–´ íŒŒì¼ URL
                          thumbnailUrl:
                            type: string
                            description: ì¸ë„¤ì¼ URL (ì´ë¯¸ì§€ì¸ ê²½ìš°)
                          size:
                            type: integer
                            description: íŒŒì¼ í¬ê¸° (bytes)
                          mimeType:
                            type: string
                            description: MIME íƒ€ì…
        '413':
          description: íŒŒì¼ í¬ê¸° ì´ˆê³¼ (Media ë„ë©”ì¸ ì—ëŸ¬)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '415':
          description: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ (Media ë„ë©”ì¸ ì—ëŸ¬)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '507':
          description: Media ë„ë©”ì¸ ì €ì¥ ê³µê°„ ë¶€ì¡±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/chat/threads/{threadId}/messages/with-location:
    post:
      tags:
        - Chat - Core
      summary: ìœ„ì¹˜ ê³µìœ  ë©”ì‹œì§€ ì „ì†¡
      security:
        - bearerAuth: []
      description: |
        í˜„ì¬ ìœ„ì¹˜ë¥¼ ê³µìœ í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
        - REQ-CHAT-011: í˜„ì¬ ìœ„ì¹˜ ê³µìœ 
      operationId: sendMessageWithLocation
      parameters:
        - $ref: '#/components/parameters/threadId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageWithLocationRequest'
      responses:
        '201':
          description: ìœ„ì¹˜ ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'

  /api/chat/threads/{threadId}/generate-trip:
    post:
      tags:
        - Chat - Core
      summary: ì—¬í–‰ ê³„íš ìƒì„± ìš”ì²­
      security:
        - bearerAuth: []
      description: |
        AI ëŒ€í™”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬í–‰ ê³„íšì„ ìƒì„±í•©ë‹ˆë‹¤.
        - REQ-CHAT-001: AI ëŒ€í™” ê¸°ë°˜ ì—¬í–‰ ê³„íš
        - REQ-CHAT-005: AI ì±„íŒ…ì—ì„œ ì—¬í–‰ ê³„íš ìƒì„±
        
        ì™¸ë¶€ ì˜ì¡´ì„±:
        - Trip Domain: ì—¬í–‰ ê³„íš ìƒì„±
        - Credit Domain: í¬ë ˆë”§ ì°¨ê°
      operationId: generateTripPlan
      parameters:
        - $ref: '#/components/parameters/threadId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateTripPlanRequest'
      responses:
        '202':
          description: ì—¬í–‰ ê³„íš ìƒì„± ìš”ì²­ ì ‘ìˆ˜
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [processing]
                  message:
                    type: string

  # ============================================
  # Chat ë„ë©”ì¸ì´ ì œê³µí•˜ëŠ” API (Internal APIs)
  # ============================================

  /api/chat/internal/threads/{threadId}/trip-association:
    get:
      tags:
        - Chat - Internal
      summary: ì±„íŒ…-ì—¬í–‰ ì—°ê²° ì •ë³´ ì¡°íšŒ
      description: |
        ì±„íŒ… ìŠ¤ë ˆë“œì™€ ì—°ê²°ëœ ì—¬í–‰ ê³„íš ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        Consumer: Trip Domain
      operationId: getTripAssociation
      security:
        - internalApiKey: []
      parameters:
        - $ref: '#/components/parameters/threadId'
      responses:
        '200':
          description: ì—°ê²° ì •ë³´ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  threadId:
                    type: string
                    format: uuid
                  tripIds:
                    type: array
                    items:
                      type: string
                      format: uuid
                  generatedAt:
                    type: string
                    format: date-time

  /api/chat/internal/threads/{threadId}/context:
    get:
      tags:
        - Chat - Internal
      summary: AI ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ì œê³µ
      description: |
        AI ëŒ€í™”ì˜ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        Consumer: Trip Domain
      operationId: getChatContext
      security:
        - internalApiKey: []
      parameters:
        - $ref: '#/components/parameters/threadId'
      responses:
        '200':
          description: ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatContextResponse'

  /api/chat/internal/threads/by-user/{userId}:
    get:
      tags:
        - Chat - Internal
      summary: ì‚¬ìš©ìë³„ ì±„íŒ… ìŠ¤ë ˆë“œ ì¡°íšŒ
      description: |
        íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë“  ì±„íŒ… ìŠ¤ë ˆë“œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
        Consumer: Trip Domain, Admin Domain
      operationId: getChatThreadsByUser
      security:
        - internalApiKey: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatThreadListResponse'

  # ============================================
  # Chat ë„ë©”ì¸ Webhook Endpoints
  # ============================================

  /api/chat/webhooks/trip-plan-completed:
    post:
      tags:
        - Chat - Webhooks
      summary: ì—¬í–‰ ê³„íš ìƒì„± ì™„ë£Œ ì½œë°±
      description: |
        Trip ë„ë©”ì¸ì—ì„œ ì—¬í–‰ ê³„íš ìƒì„±ì´ ì™„ë£Œë˜ë©´ í˜¸ì¶œë©ë‹ˆë‹¤.
        Provider: Trip Domain (í˜¸ì¶œí•˜ëŠ” ìª½)
        Consumer: Chat Domain (ë°›ëŠ” ìª½)
      operationId: tripPlanCompletedWebhook
      security:
        - internalApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - threadId
                - tripId
                - status
              properties:
                threadId:
                  type: string
                  format: uuid
                tripId:
                  type: string
                  format: uuid
                status:
                  type: string
                  enum: [success, failed]
                message:
                  type: string
                errorCode:
                  type: string
      responses:
        '200':
          description: ì›¹í›… ì²˜ë¦¬ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  acknowledged:
                    type: boolean

  # ============================================
  # ì™¸ë¶€ ë„ë©”ì¸ API ëª…ì„¸ (Chatì´ í˜¸ì¶œí•˜ëŠ” API)
  # ì£¼ì˜: ì´ APIë“¤ì€ ë‹¤ë¥¸ ë„ë©”ì¸ì´ ì œê³µí•´ì•¼ í•˜ëŠ” APIì…ë‹ˆë‹¤
  # Chat ë„ë©”ì¸ì€ ì´ APIë“¤ì„ í˜¸ì¶œí•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì…ë‹ˆë‹¤
  # ============================================

  # User Domain APIs
  /api/users/{userId}:
    get:
      tags:
        - External - User Domain
      summary: '[User Domain] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ'
      description: |
        Chat ë„ë©”ì¸ì´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        Provider: User Domain
        Purpose: ì±„íŒ… ìŠ¤ë ˆë“œ ìƒì„± ì‹œ ì‚¬ìš©ì ê²€ì¦
      operationId: getUserInfoExternal
      x-external-api: true
      x-provided-by: User Domain
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfoResponse'
        '404':
          description: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ

  /api/users/verify-token:
    post:
      tags:
        - External - User Domain
      summary: '[User Domain] í† í° ê²€ì¦'
      description: |
        JWT í† í°ì„ ê²€ì¦í•˜ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        Provider: User Domain
        Purpose: ëª¨ë“  API í˜¸ì¶œ ì‹œ ì¸ì¦
      operationId: verifyUserTokenExternal
      x-external-api: true
      x-provided-by: User Domain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
      responses:
        '200':
          description: í† í° ê²€ì¦ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  userId:
                    type: string
                    format: uuid
                  permissions:
                    type: array
                    items:
                      type: string

  # Trip Domain APIs
  /api/trips/create-from-chat:
    post:
      tags:
        - External - Trip Domain
      summary: '[Trip Domain] ì±„íŒ… ê¸°ë°˜ ì—¬í–‰ ê³„íš ìƒì„±'
      description: |
        ì±„íŒ… ëŒ€í™”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬í–‰ ê³„íšì„ ìƒì„±í•©ë‹ˆë‹¤.
        Provider: Trip Domain
        Purpose: AI ëŒ€í™” ì™„ë£Œ í›„ ì—¬í–‰ ê³„íš ìƒì„±
      operationId: createTripFromChatExternal
      x-external-api: true
      x-provided-by: Trip Domain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTripFromChatRequest'
      responses:
        '201':
          description: ì—¬í–‰ ê³„íš ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  tripId:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [created, processing, failed]
                  message:
                    type: string

  /api/trips/{tripId}:
    get:
      tags:
        - External - Trip Domain
      summary: '[Trip Domain] ì—¬í–‰ ê³„íš ì¡°íšŒ'
      description: |
        ìƒì„±ëœ ì—¬í–‰ ê³„íšì„ ì¡°íšŒí•©ë‹ˆë‹¤.
        Provider: Trip Domain
        Purpose: ì±„íŒ…ì—ì„œ ìƒì„±ëœ ì—¬í–‰ ê³„íš í‘œì‹œ
      operationId: getTripPlanExternal
      x-external-api: true
      x-provided-by: Trip Domain
      parameters:
        - name: tripId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì—¬í–‰ ê³„íš ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripPlanResponse'

  # Credit Domain APIs
  /api/credits/users/{userId}/balance:
    get:
      tags:
        - External - Credit Domain
      summary: '[Credit Domain] í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ'
      description: |
        ì‚¬ìš©ìì˜ í¬ë ˆë”§ ì”ì•¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
        Provider: Credit Domain
        Purpose: ë©”ì‹œì§€ ì „ì†¡ ì „ ì”ì•¡ í™•ì¸
      operationId: getCreditBalanceExternal
      x-external-api: true
      x-provided-by: Credit Domain
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ì”ì•¡ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                    format: uuid
                  balance:
                    type: number
                    format: decimal
                  currency:
                    type: string
                  lastUpdated:
                    type: string
                    format: date-time

  /api/credits/deduct:
    post:
      tags:
        - External - Credit Domain
      summary: '[Credit Domain] í¬ë ˆë”§ ì°¨ê°'
      description: |
        AI ì‘ë‹µ ìƒì„± í›„ í¬ë ˆë”§ì„ ì°¨ê°í•©ë‹ˆë‹¤.
        Provider: Credit Domain
        Purpose: ë©”ì‹œì§€ ì „ì†¡ ì‹œ í¬ë ˆë”§ ì†Œë¹„
      operationId: requestCreditDeduction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - amount
                - reason
                - referenceId
                - referenceType
              properties:
                userId:
                  type: string
                  format: uuid
                amount:
                  type: number
                  format: decimal
                reason:
                  type: string
                referenceId:
                  type: string
                  format: uuid
                referenceType:
                  type: string
                  enum: [chat_message, trip_generation]
      responses:
        '200':
          description: í¬ë ˆë”§ ì°¨ê° ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  transactionId:
                    type: string
                    format: uuid
                  remainingBalance:
                    type: number
                    format: decimal
                  status:
                    type: string
                    enum: [success, insufficient_funds]

  # Media Domain APIs (ì´ì „ Image Domain)
  /api/media/upload:
    post:
      tags:
        - External - Media Domain
      summary: '[Media Domain] ë¯¸ë””ì–´ ì—…ë¡œë“œ'
      description: |
        ì´ë¯¸ì§€ë‚˜ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
        Provider: Media Domain
        Purpose: ì±„íŒ… ë©”ì‹œì§€ ë¯¸ë””ì–´ ì²¨ë¶€
      operationId: uploadMediaExternal
      x-external-api: true
      x-provided-by: Media Domain
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                metadata:
                  type: object
                  description: ì„ íƒì  ë©”íƒ€ë°ì´í„°
                  properties:
                    userId:
                      type: string
                      format: uuid
                    context:
                      type: string
                      enum: [chat_message, profile]
                    mimeType:
                      type: string
      responses:
        '201':
          description: ì—…ë¡œë“œ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  mediaId:
                    type: string
                    format: uuid
                  url:
                    type: string
                  thumbnailUrl:
                    type: string
                  size:
                    type: integer
                  mimeType:
                    type: string

  /api/media/{mediaId}:
    get:
      tags:
        - External - Media Domain
      summary: '[Media Domain] ë¯¸ë””ì–´ ì¡°íšŒ'
      description: |
        ì €ì¥ëœ ë¯¸ë””ì–´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
        Provider: Media Domain
        Purpose: ì±„íŒ… ë©”ì‹œì§€ì˜ ë¯¸ë””ì–´ í‘œì‹œ
      operationId: getMediaExternal
      x-external-api: true
      x-provided-by: Media Domain
      parameters:
        - name: mediaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ë¯¸ë””ì–´ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  mediaId:
                    type: string
                    format: uuid
                  url:
                    type: string
                  metadata:
                    type: object
                  createdAt:
                    type: string
                    format: date-time

    delete:
      tags:
        - External - Media Domain
      summary: '[Media Domain] ë¯¸ë””ì–´ ì‚­ì œ'
      description: |
        ë¯¸ë””ì–´ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
        Provider: Media Domain
        Purpose: ì±„íŒ… ì‚­ì œ ì‹œ ê´€ë ¨ ë¯¸ë””ì–´ ì •ë¦¬
      operationId: deleteMediaExternal
      x-external-api: true
      x-provided-by: Media Domain
      parameters:
        - name: mediaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: ì‚­ì œ ì„±ê³µ

  # AI Service APIs
  /api/ai/generate-response:
    post:
      tags:
        - External - AI Service
      summary: '[AI Service] AI ì‘ë‹µ ìƒì„±'
      description: |
        ì‚¬ìš©ì ë©”ì‹œì§€ì— ëŒ€í•œ AI ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.
        Provider: AI Service (OpenAI/Claude)
        Purpose: ì±„íŒ… ë©”ì‹œì§€ AI ì‘ë‹µ
      operationId: generateAIResponseExternal
      x-external-api: true
      x-provided-by: AI Service
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - messages
                - model
              properties:
                messages:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                        enum: [system, user, assistant]
                      content:
                        type: string
                model:
                  type: string
                temperature:
                  type: number
                  format: float
                maxTokens:
                  type: integer
      responses:
        '200':
          description: AI ì‘ë‹µ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
                  tokensUsed:
                    type: integer
                  finishReason:
                    type: string

# components: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸ ì •ì˜ ì„¹ì…˜
# ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìŠ¤í‚¤ë§ˆ, íŒŒë¼ë¯¸í„°, ì‘ë‹µ ë“±ì„ ì •ì˜í•©ë‹ˆë‹¤
components:
  # securitySchemes: ë³´ì•ˆ/ì¸ì¦ ë°©ì‹ ì •ì˜
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: ì‚¬ìš©ì ì¸ì¦ìš© JWT í† í°
    internalApiKey:
      type: apiKey
      in: header
      name: X-Internal-API-Key
      description: ë„ë©”ì¸ ê°„ ë‚´ë¶€ í†µì‹ ìš© API Key

  # parameters: ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” íŒŒë¼ë¯¸í„° ì •ì˜
  parameters:
    # ê²½ë¡œ íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
    threadId:
      name: threadId          # íŒŒë¼ë¯¸í„° ì´ë¦„
      in: path               # URL ê²½ë¡œì— í¬í•¨
      required: true         # í•„ìˆ˜ íŒŒë¼ë¯¸í„°
      schema:
        type: string
        format: uuid         # UUID í˜•ì‹

  # schemas: ë°ì´í„° ëª¨ë¸/ìŠ¤í‚¤ë§ˆ ì •ì˜
  # Request/Response DTO(Data Transfer Object) ì •ì˜
  schemas:
    # Request Schemas - ìš”ì²­ ì‹œ ì „ë‹¬ë˜ëŠ” ë°ì´í„° êµ¬ì¡°
    CreateChatThreadRequest:
      type: object           # ê°ì²´ íƒ€ì…
      properties:            # ê°ì²´ì˜ ì†ì„±ë“¤
        title:
          type: string
          maxLength: 255
        modeId:
          type: integer
        initialMessage:
          type: string
      required:
        - modeId

    UpdateChatThreadRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
      required:
        - title

    SendMessageRequest:
      type: object
      properties:
        content:
          type: string
          minLength: 1
        parentMessageId:
          type: string
          format: uuid
          description: AI ì‘ë‹µ ì¬ìƒì„± ì‹œ ë¶€ëª¨ ë©”ì‹œì§€ ID
      required:
        - content

    MessageWithLocationRequest:
      type: object
      properties:
        content:
          type: string
        location:
          type: object
          properties:
            lat:
              type: number
              format: double
            lng:
              type: number
              format: double
            address:
              type: string
          required:
            - lat
            - lng
      required:
        - content
        - location

    GenerateTripPlanRequest:
      type: object
      properties:
        preferences:
          type: object
          properties:
            budget:
              type: number
              format: decimal
            duration:
              type: integer
            travelStyle:
              type: string
            interests:
              type: array
              items:
                type: string
        constraints:
          type: object
          properties:
            startDate:
              type: string
              format: date
            endDate:
              type: string
              format: date
            startLocation:
              type: string

    CreateTripFromChatRequest:
      type: object
      required:
        - threadId
        - userId
        - planData
      properties:
        threadId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        planData:
          type: object
          properties:
            title:
              type: string
            description:
              type: string
            itinerary:
              type: array
              items:
                type: object
            preferences:
              type: object

    # Response Schemas - ì‘ë‹µìœ¼ë¡œ ë°˜í™˜ë˜ëŠ” ë°ì´í„° êµ¬ì¡°
    ChatThreadResponse:
      type: object
      properties:
        threadId:
          type: string
          format: uuid
        title:
          type: string
        mode:
          type: object
          properties:
            modeId:
              type: integer
            name:
              type: string
        status:
          type: string
          enum: [active, archived, deleted]
        lastMessageAt:
          type: string
          format: date-time
        messageCount:
          type: integer
        createdAt:
          type: string
          format: date-time

    ChatThreadListResponse:
      type: object
      properties:
        threads:
          type: array
          items:
            $ref: '#/components/schemas/ChatThreadResponse'
        pagination:
          $ref: '#/components/schemas/PaginationDto'

    ChatThreadDetailResponse:
      allOf:
        - $ref: '#/components/schemas/ChatThreadResponse'
        - type: object
          properties:
            userId:
              type: string
              format: uuid
            updatedAt:
              type: string
              format: date-time

    MessageResponse:
      type: object
      properties:
        messageId:
          type: string
          format: uuid
        threadId:
          type: string
          format: uuid
        senderType:
          type: string
          enum: [user, ai]
        content:
          type: string
        mediaUrl:
          type: string
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number
        tokensUsed:
          type: integer
        parentMessageId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    MessageListResponse:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/MessageResponse'
        hasMore:
          type: boolean
        nextCursor:
          type: string

    ChatContextResponse:
      type: object
      properties:
        preferences:
          type: object
          properties:
            budget:
              type: number
            duration:
              type: integer
            interests:
              type: array
              items:
                type: string
        constraints:
          type: object
          properties:
            startDate:
              type: string
              format: date
            endDate:
              type: string
              format: date
            location:
              type: string
        conversationSummary:
          type: string

    UserInfoResponse:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
        profileImage:
          type: string
        preferences:
          type: object
        status:
          type: string
          enum: [active, suspended]

    TripPlanResponse:
      type: object
      properties:
        tripId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        itinerary:
          type: array
          items:
            type: object
        status:
          type: string
        createdAt:
          type: string
          format: date-time

    PaginationDto:
      type: object
      properties:
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        hasNext:
          type: boolean
        hasPrevious:
          type: boolean

    ErrorResponse:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: string
        timestamp:
          type: string
          format: date-time

  # responses: ê³µí†µ ì‘ë‹µ ì •ì˜ (ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì¬ì‚¬ìš©)
  responses:
    BadRequestError:
      description: ì˜ëª»ëœ ìš”ì²­
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: CHAT_006
            message: ì˜ëª»ëœ ì±„íŒ… ëª¨ë“œì…ë‹ˆë‹¤
            timestamp: "2024-01-25T10:00:00Z"

    UnauthorizedError:
      description: ì¸ì¦ ì‹¤íŒ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: AUTH_001
            message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤
            timestamp: "2024-01-25T10:00:00Z"

    NotFoundError:
      description: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: CHAT_001
            message: ì±„íŒ… ìŠ¤ë ˆë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
            timestamp: "2024-01-25T10:00:00Z"

